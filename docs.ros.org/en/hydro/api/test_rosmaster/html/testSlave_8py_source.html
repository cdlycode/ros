<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>test_rosmaster: testSlave.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">


<link rel="canonical" href="http://docs.ros.org/hydro/api/test_rosmaster/html/testSlave_8py_source.html" />
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">testSlave.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="http://docs.ros.org/en/hydro/api/test_rosmaster/html/testSlave_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacetest_1_1testSlave.html">00001</a> <span class="comment"># Software License Agreement (BSD License)</span>
<a name="l00002"></a>00002 <span class="comment">#</span>
<a name="l00003"></a>00003 <span class="comment"># Copyright (c) 2008, Willow Garage, Inc.</span>
<a name="l00004"></a>00004 <span class="comment"># All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment">#</span>
<a name="l00006"></a>00006 <span class="comment"># Redistribution and use in source and binary forms, with or without</span>
<a name="l00007"></a>00007 <span class="comment"># modification, are permitted provided that the following conditions</span>
<a name="l00008"></a>00008 <span class="comment"># are met:</span>
<a name="l00009"></a>00009 <span class="comment">#</span>
<a name="l00010"></a>00010 <span class="comment">#  * Redistributions of source code must retain the above copyright</span>
<a name="l00011"></a>00011 <span class="comment">#    notice, this list of conditions and the following disclaimer.</span>
<a name="l00012"></a>00012 <span class="comment">#  * Redistributions in binary form must reproduce the above</span>
<a name="l00013"></a>00013 <span class="comment">#    copyright notice, this list of conditions and the following</span>
<a name="l00014"></a>00014 <span class="comment">#    disclaimer in the documentation and/or other materials provided</span>
<a name="l00015"></a>00015 <span class="comment">#    with the distribution.</span>
<a name="l00016"></a>00016 <span class="comment">#  * Neither the name of Willow Garage, Inc. nor the names of its</span>
<a name="l00017"></a>00017 <span class="comment">#    contributors may be used to endorse or promote products derived</span>
<a name="l00018"></a>00018 <span class="comment">#    from this software without specific prior written permission.</span>
<a name="l00019"></a>00019 <span class="comment">#</span>
<a name="l00020"></a>00020 <span class="comment"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00021"></a>00021 <span class="comment"># &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00022"></a>00022 <span class="comment"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS</span>
<a name="l00023"></a>00023 <span class="comment"># FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE</span>
<a name="l00024"></a>00024 <span class="comment"># COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</span>
<a name="l00025"></a>00025 <span class="comment"># INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</span>
<a name="l00026"></a>00026 <span class="comment"># BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<a name="l00027"></a>00027 <span class="comment"># LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<a name="l00028"></a>00028 <span class="comment"># CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<a name="l00029"></a>00029 <span class="comment"># LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN</span>
<a name="l00030"></a>00030 <span class="comment"># ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<a name="l00031"></a>00031 <span class="comment"># POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00032"></a>00032 <span class="comment">#</span>
<a name="l00033"></a>00033 <span class="comment"># Revision $Id$</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="keyword">import</span> os
<a name="l00036"></a>00036 <span class="keyword">import</span> sys
<a name="l00037"></a>00037 <span class="keyword">import</span> string
<a name="l00038"></a>00038 <span class="keyword">import</span> xmlrpclib
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="keyword">import</span> rospy
<a name="l00041"></a>00041 <span class="keyword">from</span> rostest <span class="keyword">import</span> *
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="namespacetest_1_1testSlave.html#a65179de5277dbe9976e0e6fccd4b6581">00043</a> singletest = <span class="keywordtype">None</span>
<a name="l00044"></a>00044 <span class="comment">#singletest = &#39;testSourceKillFlow&#39;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="comment">#TODO: test single source to multiple sinks</span>
<a name="l00047"></a>00047 <span class="comment">#TODO: test multiple sources to single sink</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="comment"># test_string_in</span>
<a name="l00050"></a>00050 <span class="comment"># test_string_out</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment"># test_primitives_in</span>
<a name="l00053"></a>00053 <span class="comment"># test_primitives_out</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment"># test_arrays_in</span>
<a name="l00056"></a>00056 <span class="comment"># test_arrays_out</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="comment"># test_header_in</span>
<a name="l00059"></a>00059 <span class="comment"># test_header_out</span>
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="namespacetest_1_1testSlave.html#aa6b6dc793fa2ecba2c046e729b5bf0b0">00061</a> _required_publications  = <span class="stringliteral">&#39;test_string_out&#39;</span>, <span class="stringliteral">&#39;test_primitives_out&#39;</span>, <span class="stringliteral">&#39;test_arrays_out&#39;</span>, <span class="stringliteral">&#39;test_header_out&#39;</span>
<a name="l00062"></a><a class="code" href="namespacetest_1_1testSlave.html#a6ab6f1097475cecee92f2171420db1eb">00062</a> _required_subscriptions = <span class="stringliteral">&#39;test_string_in&#39;</span>, <span class="stringliteral">&#39;test_primitives_in&#39;</span>, <span class="stringliteral">&#39;test_arrays_in&#39;</span>, <span class="stringliteral">&#39;test_header_in&#39;</span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="comment">## Expects a single test node to be running with name &#39;test_node&#39; and subscribed to &#39;test_string&#39;</span>
<a name="l00065"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html">00065</a> <span class="keyword">class </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html" title="Expects a single test node to be running with name &#39;test_node&#39; and subscribed to &#39;test_string&#39;.">SlaveTestCase</a>(TestRosClient):
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a92562cb29d2ebf8861d24b5d68de8a9f">00067</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a92562cb29d2ebf8861d24b5d68de8a9f">setUp</a>(self):
<a name="l00068"></a>00068         super(SlaveTestCase, self).<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a92562cb29d2ebf8861d24b5d68de8a9f">setUp</a>()
<a name="l00069"></a>00069         <span class="comment"># retrieve handle on node</span>
<a name="l00070"></a>00070         self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a4ed4caa6e2d96ae0729bc5e9e9aad0fd">caller_id</a> = rospy.get_caller_id()
<a name="l00071"></a>00071         self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a64ade7ad47657141ace9cf9bf29d4243">node_api</a> = self.apiSuccess(self.master.lookupNode(self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a4ed4caa6e2d96ae0729bc5e9e9aad0fd">caller_id</a>, <span class="stringliteral">&#39;test_node&#39;</span>))
<a name="l00072"></a>00072         self.assert_(self.node_api.startswith(<span class="stringliteral">&#39;http&#39;</span>))
<a name="l00073"></a>00073         self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a45b8e21f880338bf9783a7d12d98da26">node</a> = xmlrpclib.ServerProxy(self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a64ade7ad47657141ace9cf9bf29d4243">node_api</a>)
<a name="l00074"></a>00074         
<a name="l00075"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#ac18f075accb7ed8d7c53888d1771e756">00075</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#ac18f075accb7ed8d7c53888d1771e756">testGetPid</a>(self):
<a name="l00076"></a>00076         pid = self.apiSuccess(self.node.getPid(self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a4ed4caa6e2d96ae0729bc5e9e9aad0fd">caller_id</a>))
<a name="l00077"></a>00077         self.assert_(pid &gt; 0)
<a name="l00078"></a>00078         
<a name="l00079"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#ab3b83a85b8ddbbfa111ec7e089443ed1">00079</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#ab3b83a85b8ddbbfa111ec7e089443ed1">testGetPublications</a>(self):
<a name="l00080"></a>00080         publications = self.apiSuccess(self.node.getPublications(self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a4ed4caa6e2d96ae0729bc5e9e9aad0fd">caller_id</a>))
<a name="l00081"></a>00081         self.assert_(publications <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>)
<a name="l00082"></a>00082         expected = [rospy.resolve_name(t) <span class="keywordflow">for</span> t <span class="keywordflow">in</span> _required_publications]
<a name="l00083"></a>00083         missing = set(expected) - set(publications) 
<a name="l00084"></a>00084         self.failIf(len(missing), <span class="stringliteral">&#39;missing required topics: %s&#39;</span>%(<span class="stringliteral">&#39;,&#39;</span>.join(missing)))
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a8915131d8746ea0cbe8851fe3dea6ae5">00086</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a8915131d8746ea0cbe8851fe3dea6ae5">_subTestSourceRequestFlow</a>(self, testName, protocols, testEval):
<a name="l00087"></a>00087         master = self.master
<a name="l00088"></a>00088         tests = [
<a name="l00089"></a>00089             [[<span class="stringliteral">&#39;testSourceRequestFlow-%s-nodeA&#39;</span>,<span class="stringliteral">&#39;testSourceRequestFlow-%s-nodeB&#39;</span>,],
<a name="l00090"></a>00090              [<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;testSourceRequestFlow-%s-nodeA.out&#39;</span>, <span class="stringliteral">&#39;testSourceRequestFlow-%s-nodeB.in&#39;</span>]],
<a name="l00091"></a>00091             [[<span class="stringliteral">&#39;g1.testSourceRequestFlow-%s-nodeA&#39;</span>,<span class="stringliteral">&#39;g1.testSourceRequestFlow-%s-nodeB&#39;</span>,],
<a name="l00092"></a>00092              [<span class="stringliteral">&#39;g1.node&#39;</span>, <span class="stringliteral">&#39;testSourceRequestFlow-%s-nodeA.out&#39;</span>, <span class="stringliteral">&#39;testSourceRequestFlow-%s-nodeB.in&#39;</span>]],
<a name="l00093"></a>00093             [[<span class="stringliteral">&#39;g1.g2.g3.testSourceRequestFlow-%s-nodeA&#39;</span>,<span class="stringliteral">&#39;g1.g2.testSourceRequestFlow-%s-nodeB&#39;</span>,],
<a name="l00094"></a>00094              [<span class="stringliteral">&#39;g1.g2.node&#39;</span>, <span class="stringliteral">&#39;g3.testSourceRequestFlow-%s-nodeA.out&#39;</span>, <span class="stringliteral">&#39;testSourceRequestFlow-%s-nodeB.in&#39;</span>]],
<a name="l00095"></a>00095             [[<span class="stringliteral">&#39;g1.g2.testSourceRequestFlow-%s-nodeA&#39;</span>,<span class="stringliteral">&#39;g1.g2.g3.testSourceRequestFlow-%s-nodeB&#39;</span>,],
<a name="l00096"></a>00096              [<span class="stringliteral">&#39;g1.g2.node&#39;</span>, <span class="stringliteral">&#39;testSourceRequestFlow-%s-nodeA.out&#39;</span>, <span class="stringliteral">&#39;g3.testSourceRequestFlow-%s-nodeB.in&#39;</span>]],
<a name="l00097"></a>00097             ]
<a name="l00098"></a>00098         sources = {}
<a name="l00099"></a>00099         <span class="comment">#start the nodes</span>
<a name="l00100"></a>00100         <span class="comment"># - save the source as we will be making calls on it</span>
<a name="l00101"></a>00101         pkg, node = testNode
<a name="l00102"></a>00102         <span class="keywordflow">for</span> test <span class="keywordflow">in</span> tests:
<a name="l00103"></a>00103             sourceName, sinkName = [val%testName <span class="keywordflow">for</span> val <span class="keywordflow">in</span> test[0]]
<a name="l00104"></a>00104             port = apiSuccess(master.addNode(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, sourceName, pkg, node, TEST_MACHINE, 0))
<a name="l00105"></a>00105             apiSuccess(master.addNode(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, sinkName, pkg, node, TEST_MACHINE, 0))
<a name="l00106"></a>00106             sourceUri = <span class="stringliteral">&#39;http://%s:%s/&#39;</span>%(testNodeAddr[0], port)
<a name="l00107"></a>00107             sources[sourceName] = xmlrpclib.ServerProxy(sourceUri)
<a name="l00108"></a>00108 
<a name="l00109"></a>00109         <span class="keywordflow">for</span> test <span class="keywordflow">in</span> tests:
<a name="l00110"></a>00110             sourceName, sinkName = [val%testName <span class="keywordflow">for</span> val <span class="keywordflow">in</span> test[0]]
<a name="l00111"></a>00111             source = sources[sourceName]
<a name="l00112"></a>00112             callerId = test[1][0]
<a name="l00113"></a>00113             sourceLocator, sinkLocator = [val%testName <span class="keywordflow">for</span> val <span class="keywordflow">in</span> test[1][1:]]
<a name="l00114"></a>00114             args = source.sourceRequestFlow(callerId, sourceLocator, sinkLocator, protocols)
<a name="l00115"></a>00115             testEval(args)
<a name="l00116"></a>00116         <span class="comment">#TODO: test locator name resolution            </span>
<a name="l00117"></a>00117     
<a name="l00118"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#aa0a39820501a7d5d2baa6409150fde3c">00118</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#aa0a39820501a7d5d2baa6409150fde3c">testSourceRequestFlow_TCPROS1</a>(self):
<a name="l00119"></a>00119         <span class="keyword">def </span>testEval(args):
<a name="l00120"></a>00120             protocol = apiSuccess(args)
<a name="l00121"></a>00121             <span class="keyword">assert</span> type(protocol) == list
<a name="l00122"></a>00122             <span class="keyword">assert</span> string.upper(protocol[0]) == <span class="stringliteral">&#39;TCPROS&#39;</span>, <span class="stringliteral">&quot;source should have returned TCPROS as the desired protocol&quot;</span>
<a name="l00123"></a>00123             <span class="keyword">assert</span> len(protocol) == 3, <span class="stringliteral">&quot;TCPROS parameter spec should be length 3&quot;</span>
<a name="l00124"></a>00124         protocols = [[<span class="stringliteral">&#39;TCPROS&#39;</span>]]
<a name="l00125"></a>00125         self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a8915131d8746ea0cbe8851fe3dea6ae5">_subTestSourceRequestFlow</a>(<span class="stringliteral">&#39;TCPROS1&#39;</span>, protocols, testEval)
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a4937e90e821e25c574e958d484ba9346">00127</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a4937e90e821e25c574e958d484ba9346">testSourceRequestFlow_TCPROS2</a>(self):
<a name="l00128"></a>00128         <span class="keyword">def </span>testEval(args):
<a name="l00129"></a>00129             protocol = apiSuccess(args)
<a name="l00130"></a>00130             <span class="keyword">assert</span> type(protocol) == list            
<a name="l00131"></a>00131             <span class="keyword">assert</span> string.upper(protocol[0]) == <span class="stringliteral">&#39;TCPROS&#39;</span>, <span class="stringliteral">&quot;source should have returned TCPROS as the desired protocol&quot;</span>
<a name="l00132"></a>00132             <span class="keyword">assert</span> len(protocol) == 3, <span class="stringliteral">&quot;TCPROS parameter spec should be length 3&quot;</span>
<a name="l00133"></a>00133         protocols = [[<span class="stringliteral">&#39;Fake1&#39;</span>, 123, 132], [<span class="stringliteral">&#39;Fake2&#39;</span>, 1.0], [<span class="stringliteral">&#39;Fake3&#39;</span>], [<span class="stringliteral">&#39;Fake4&#39;</span>, <span class="stringliteral">&#39;string&#39;</span>], [<span class="stringliteral">&#39;Fake5&#39;</span>, [<span class="stringliteral">&#39;a&#39;</span>, <span class="stringliteral">&#39;list&#39;</span>], [<span class="stringliteral">&#39;a&#39;</span>, <span class="stringliteral">&#39;nother&#39;</span>, <span class="stringliteral">&#39;list&#39;</span>]], [<span class="stringliteral">&#39;TCPROS&#39;</span>], [<span class="stringliteral">&#39;Fakelast&#39;</span>, <span class="stringliteral">&#39;fake&#39;</span>] ]
<a name="l00134"></a>00134         self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a8915131d8746ea0cbe8851fe3dea6ae5">_subTestSourceRequestFlow</a>(<span class="stringliteral">&#39;TCPROS2&#39;</span>, protocols, testEval)
<a name="l00135"></a>00135 
<a name="l00136"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a0812955c401b1453fceb511962fc5dff">00136</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a0812955c401b1453fceb511962fc5dff">testSourceRequestFlow_Fail</a>(self):
<a name="l00137"></a>00137         protocols = [[<span class="stringliteral">&#39;Fake1&#39;</span>, 123, 132], [<span class="stringliteral">&#39;Fake2&#39;</span>, 1.0], [<span class="stringliteral">&#39;Fake3&#39;</span>], [<span class="stringliteral">&#39;Fake4&#39;</span>, <span class="stringliteral">&#39;string&#39;</span>], [<span class="stringliteral">&#39;Fake5&#39;</span>, [<span class="stringliteral">&#39;a&#39;</span>, <span class="stringliteral">&#39;list&#39;</span>], [<span class="stringliteral">&#39;a&#39;</span>, <span class="stringliteral">&#39;nother&#39;</span>, <span class="stringliteral">&#39;list&#39;</span>]], [<span class="stringliteral">&#39;Fakelast&#39;</span>, <span class="stringliteral">&#39;fake&#39;</span>] ]
<a name="l00138"></a>00138         self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a8915131d8746ea0cbe8851fe3dea6ae5">_subTestSourceRequestFlow</a>(<span class="stringliteral">&#39;Fail&#39;</span>, protocols, apiFail)
<a name="l00139"></a>00139 
<a name="l00140"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#ae59e8bc097276a5d27c5f36729a28df8">00140</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#ae59e8bc097276a5d27c5f36729a28df8">testSourceRequestFlow_Errors</a>(self):
<a name="l00141"></a>00141         slave = self.slave
<a name="l00142"></a>00142         master = self.master
<a name="l00143"></a>00143         <span class="comment">#test that malformed locators return error codes</span>
<a name="l00144"></a>00144         apiError(slave.sourceRequestFlow(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00145"></a>00145         apiError(slave.sourceRequestFlow(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;good.locator&#39;</span>, <span class="stringliteral">&#39;badlocator&#39;</span>))
<a name="l00146"></a>00146         apiError(slave.sourceRequestFlow(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;badlocator&#39;</span>, <span class="stringliteral">&#39;good.locator&#39;</span>))
<a name="l00147"></a>00147                 
<a name="l00148"></a>00148 <span class="comment"># sourceKillFlow(callerId, sourceLocator, sinkLocator)</span>
<a name="l00149"></a>00149 <span class="comment">#</span>
<a name="l00150"></a>00150 <span class="comment"># * called by master</span>
<a name="l00151"></a>00151 <span class="comment"># * returns int</span>
<a name="l00152"></a>00152 
<a name="l00153"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a212007eb71180f955ce7485e1e710d72">00153</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a212007eb71180f955ce7485e1e710d72">testSourceKillFlow</a>(self):
<a name="l00154"></a>00154         slave = self.slave
<a name="l00155"></a>00155         master = self.master
<a name="l00156"></a>00156         <span class="comment">#test that malformed locators return error codes</span>
<a name="l00157"></a>00157         apiError(slave.sourceKillFlow(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00158"></a>00158         apiError(slave.sourceKillFlow(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;good.locator&#39;</span>, <span class="stringliteral">&#39;badlocator&#39;</span>))
<a name="l00159"></a>00159         apiError(slave.sourceKillFlow(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;badlocator&#39;</span>, <span class="stringliteral">&#39;good.locator&#39;</span>))
<a name="l00160"></a>00160         
<a name="l00161"></a>00161         tests = [
<a name="l00162"></a>00162             [[<span class="stringliteral">&#39;testSourceKillFlow-nodeA&#39;</span>,<span class="stringliteral">&#39;testSourceKillFlow-nodeB&#39;</span>,],
<a name="l00163"></a>00163              [<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;testSourceKillFlow-nodeA.out&#39;</span>, <span class="stringliteral">&#39;testSourceKillFlow-nodeB.in&#39;</span>]],
<a name="l00164"></a>00164             [[<span class="stringliteral">&#39;g1.testSourceKillFlow-nodeA&#39;</span>,<span class="stringliteral">&#39;g1.testSourceKillFlow-nodeB&#39;</span>,],
<a name="l00165"></a>00165              [<span class="stringliteral">&#39;g1.node&#39;</span>, <span class="stringliteral">&#39;testSourceKillFlow-nodeA.out&#39;</span>, <span class="stringliteral">&#39;testSourceKillFlow-nodeB.in&#39;</span>]],
<a name="l00166"></a>00166             [[<span class="stringliteral">&#39;g1.g2.g3.testSourceKillFlow-nodeA&#39;</span>,<span class="stringliteral">&#39;g1.g2.g3.testSourceKillFlow-nodeB&#39;</span>,],
<a name="l00167"></a>00167              [<span class="stringliteral">&#39;g1.g2.node&#39;</span>, <span class="stringliteral">&#39;g3.testSourceKillFlow-nodeA.out&#39;</span>, <span class="stringliteral">&#39;g3.testSourceKillFlow-nodeB.in&#39;</span>]],
<a name="l00168"></a>00168             [[<span class="stringliteral">&#39;g1.g2.testSourceKillFlow-nodeA&#39;</span>,<span class="stringliteral">&#39;g1.g2.testSourceKillFlow-nodeB&#39;</span>,],
<a name="l00169"></a>00169              [<span class="stringliteral">&#39;g1.g2.node&#39;</span>, <span class="stringliteral">&#39;testSourceKillFlow-nodeA.out&#39;</span>, <span class="stringliteral">&#39;testSourceKillFlow-nodeB.in&#39;</span>]],
<a name="l00170"></a>00170             [[<span class="stringliteral">&#39;a1.g2.g3.testSourceKillFlow-nodeA&#39;</span>,<span class="stringliteral">&#39;a1.g2.testSourceKillFlow-nodeB&#39;</span>,],
<a name="l00171"></a>00171              [<span class="stringliteral">&#39;a1.node&#39;</span>, <span class="stringliteral">&#39;g2.g3.testSourceKillFlow-nodeA.out&#39;</span>, <span class="stringliteral">&#39;g2.testSourceKillFlow-nodeB.in&#39;</span>]],
<a name="l00172"></a>00172             [[<span class="stringliteral">&#39;a1.g2.testSourceKillFlow-nodeA&#39;</span>,<span class="stringliteral">&#39;a1.g2.g3.testSourceKillFlow-nodeB&#39;</span>,],
<a name="l00173"></a>00173              [<span class="stringliteral">&#39;a1.node&#39;</span>, <span class="stringliteral">&#39;g2.testSourceKillFlow-nodeA.out&#39;</span>, <span class="stringliteral">&#39;g2.g3.testSourceKillFlow-nodeB.in&#39;</span>]],
<a name="l00174"></a>00174 
<a name="l00175"></a>00175             ]
<a name="l00176"></a>00176         sources = {}
<a name="l00177"></a>00177         <span class="comment">#start the flows</span>
<a name="l00178"></a>00178         <span class="comment"># - save the source as we will be making calls on it</span>
<a name="l00179"></a>00179         pkg, node = testNode
<a name="l00180"></a>00180         <span class="keywordflow">for</span> test <span class="keywordflow">in</span> tests:
<a name="l00181"></a>00181             sourceName, sinkName = test[0]
<a name="l00182"></a>00182             <span class="comment"># - start the source/sink nodes</span>
<a name="l00183"></a>00183             port = apiSuccess(master.addNode(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, sourceName, pkg, node, TEST_MACHINE, 0))
<a name="l00184"></a>00184             apiSuccess(master.addNode(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, sinkName, pkg, node, TEST_MACHINE, 0))
<a name="l00185"></a>00185             sourceUri = <span class="stringliteral">&#39;http://%s:%s/&#39;</span>%(testNodeAddr[0], port)
<a name="l00186"></a>00186             sources[sourceName] = xmlrpclib.ServerProxy(sourceUri)
<a name="l00187"></a>00187             <span class="comment"># - start the flow</span>
<a name="l00188"></a>00188             callerId, sourceLocator, sinkLocator = test[1]
<a name="l00189"></a>00189             apiSuccess(master.connectFlow(callerId, sourceLocator, sinkLocator, 1))
<a name="l00190"></a>00190             
<a name="l00191"></a>00191         <span class="comment">#attempt to kill flow with 1 wrong endpoint</span>
<a name="l00192"></a>00192         <span class="keywordflow">for</span> test <span class="keywordflow">in</span> tests:
<a name="l00193"></a>00193             source = sources[test[0][0]]
<a name="l00194"></a>00194             callerId, sourceLocator, sinkLocator = test[1]
<a name="l00195"></a>00195             <span class="comment">#sourceKill flow does a silent succeed if there is no flow to sink, but returns</span>
<a name="l00196"></a>00196             <span class="comment">#0 flows killed</span>
<a name="l00197"></a>00197             val = apiSuccess(source.sourceKillFlow(callerId, sourceLocator, <span class="stringliteral">&#39;fake.sink&#39;</span>))
<a name="l00198"></a>00198             <span class="keyword">assert</span> val == 0, <span class="stringliteral">&quot;flowsKilled should be 0 for non-existent flow [fakesink]&quot;</span>
<a name="l00199"></a>00199             <span class="comment">#sourceKill flow fails if source param does not refer to it</span>
<a name="l00200"></a>00200             apiError(source.sourceKillFlow(callerId, <span class="stringliteral">&#39;fake.source&#39;</span>, sinkLocator))
<a name="l00201"></a>00201             
<a name="l00202"></a>00202         <span class="comment">#attempt to kill flow with wrong context</span>
<a name="l00203"></a>00203         <span class="keywordflow">for</span> test <span class="keywordflow">in</span> tests:
<a name="l00204"></a>00204             source = sources[test[0][0]]
<a name="l00205"></a>00205             callerId, sourceL, sinkL = test[1]
<a name="l00206"></a>00206             <span class="keywordflow">for</span> sub_test <span class="keywordflow">in</span> tests:
<a name="l00207"></a>00207                 sub_callerId, sub_source, sub_sink = test[1]
<a name="l00208"></a>00208                 <span class="keywordflow">if</span> sub_callerId == callerId <span class="keywordflow">and</span> sub_source == sourceL <span class="keywordflow">and</span> sub_sink == sinkL:
<a name="l00209"></a>00209                     <span class="keywordflow">continue</span>
<a name="l00210"></a>00210                 val = apiSuccess(source.sourceKillFlow(sub_callerId, sub_source, sub_sink))
<a name="l00211"></a>00211                 <span class="keyword">assert</span> val == 0, <span class="stringliteral">&quot;flowsKilled should be 0 for non-existent flow [different context: %s,%s,%s on %s,%s,%s]&quot;</span>%(sub_callerId, sub_source, sub_sink, callerId, sourceL, sinkL)
<a name="l00212"></a>00212                 
<a name="l00213"></a>00213         <span class="comment"># try to kill all flows on the source that we started</span>
<a name="l00214"></a>00214         <span class="keywordflow">for</span> test <span class="keywordflow">in</span> tests:
<a name="l00215"></a>00215             source = sources[test[0][0]]
<a name="l00216"></a>00216             callerId, sourceLocator, sinkLocator = test[1]
<a name="l00217"></a>00217             val = apiSuccess(source.sourceKillFlow(callerId, sourceLocator, sinkLocator))
<a name="l00218"></a>00218             <span class="keyword">assert</span> type(val) == int
<a name="l00219"></a>00219             <span class="keyword">assert</span> val == 1, <span class="stringliteral">&quot;Source did not report 1 flow killed: %s, %s&quot;</span>%(val, getLastMsg())
<a name="l00220"></a>00220         <span class="comment">#TODO: test locator name resolution            </span>
<a name="l00221"></a>00221     
<a name="l00222"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a1e71182509413a4044f04a0982f6fef6">00222</a>     sinkTests = [
<a name="l00223"></a>00223         [[<span class="stringliteral">&#39;testSinkConnectFlow-nodeA&#39;</span>,<span class="stringliteral">&#39;testSinkConnectFlow-nodeB&#39;</span>,],
<a name="l00224"></a>00224          [<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;testSinkConnectFlow-nodeA.out&#39;</span>, <span class="stringliteral">&#39;testSinkConnectFlow-nodeB.in&#39;</span>]],
<a name="l00225"></a>00225         [[<span class="stringliteral">&#39;g1.testSinkConnectFlow-nodeA&#39;</span>,<span class="stringliteral">&#39;g1.testSinkConnectFlow-nodeB&#39;</span>,],
<a name="l00226"></a>00226          [<span class="stringliteral">&#39;g1.node&#39;</span>, <span class="stringliteral">&#39;testSinkConnectFlow-nodeA.out&#39;</span>, <span class="stringliteral">&#39;testSinkConnectFlow-nodeB.in&#39;</span>]],
<a name="l00227"></a>00227         [[<span class="stringliteral">&#39;g1.g2.g3.testSinkConnectFlow-nodeA&#39;</span>,<span class="stringliteral">&#39;g1.g2.testSinkConnectFlow-nodeB&#39;</span>,],
<a name="l00228"></a>00228          [<span class="stringliteral">&#39;g1.g2.node&#39;</span>, <span class="stringliteral">&#39;g3.testSinkConnectFlow-nodeA.out&#39;</span>, <span class="stringliteral">&#39;testSinkConnectFlow-nodeB.in&#39;</span>]],
<a name="l00229"></a>00229         [[<span class="stringliteral">&#39;g1.g2.testSinkConnectFlow-nodeA&#39;</span>,<span class="stringliteral">&#39;g1.g2.g3.testSinkConnectFlow-nodeB&#39;</span>,],
<a name="l00230"></a>00230          [<span class="stringliteral">&#39;g1.g2.node&#39;</span>, <span class="stringliteral">&#39;testSinkConnectFlow-nodeA.out&#39;</span>, <span class="stringliteral">&#39;g3.testSinkConnectFlow-nodeB.in&#39;</span>]],
<a name="l00231"></a>00231         <span class="comment">#separate subgraphs</span>
<a name="l00232"></a>00232         [[<span class="stringliteral">&#39;a1.a2.testSinkConnectFlow-nodeA&#39;</span>,<span class="stringliteral">&#39;b1.b2.testSinkConnectFlow-nodeB&#39;</span>,],
<a name="l00233"></a>00233          [<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;a1.a2.testSinkConnectFlow-nodeA.out&#39;</span>, <span class="stringliteral">&#39;b1.b2.testSinkConnectFlow-nodeB.in&#39;</span>]],
<a name="l00234"></a>00234         <span class="comment"># &#39;.locator&#39; resolution</span>
<a name="l00235"></a>00235         [[<span class="stringliteral">&#39;c1.node.testSinkConnectFlow-nodeA&#39;</span>,<span class="stringliteral">&#39;c1.node2.testSinkConnectFlow-nodeB&#39;</span>,],
<a name="l00236"></a>00236          [<span class="stringliteral">&#39;c1.node2&#39;</span>, <span class="stringliteral">&#39;node.testSinkConnectFlow-nodeA.out&#39;</span>, <span class="stringliteral">&#39;.testSinkConnectFlow-nodeB.in&#39;</span>]],
<a name="l00237"></a>00237 
<a name="l00238"></a>00238         ]
<a name="l00239"></a>00239 
<a name="l00240"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a4a1b4f02ad9b944c959bf8545b8c1d3c">00240</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a4a1b4f02ad9b944c959bf8545b8c1d3c">_sink_StartNodes</a>(self, tests):
<a name="l00241"></a>00241         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00242"></a>00242 <span class="stringliteral">        Test subroutine to startup all the nodes specified in the tests</span>
<a name="l00243"></a>00243 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00244"></a>00244         master = self.master
<a name="l00245"></a>00245         sourceUris = {}
<a name="l00246"></a>00246         sinks = {}
<a name="l00247"></a>00247         <span class="comment">#start the nodes</span>
<a name="l00248"></a>00248         <span class="comment"># - save the sink as we will be making calls on it</span>
<a name="l00249"></a>00249         pkg, node = testNode
<a name="l00250"></a>00250         <span class="keywordflow">for</span> test <span class="keywordflow">in</span> tests:
<a name="l00251"></a>00251             sourceName, sinkName = test[0]
<a name="l00252"></a>00252             sourcePort = apiSuccess(master.addNode(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, sourceName, pkg, node, TEST_MACHINE, 0))
<a name="l00253"></a>00253             sinkPort = apiSuccess(master.addNode(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, sinkName, pkg, node, TEST_MACHINE, 0))
<a name="l00254"></a>00254             sourceUri = <span class="stringliteral">&#39;http://%s:%s/&#39;</span>%(testNodeAddr[0], sourcePort)
<a name="l00255"></a>00255             sinkUri = <span class="stringliteral">&#39;http://%s:%s/&#39;</span>%(testNodeAddr[0], sinkPort)
<a name="l00256"></a>00256             sourceUris[sourceName] = sourceUri
<a name="l00257"></a>00257             sinks[sinkName] = xmlrpclib.ServerProxy(sinkUri)
<a name="l00258"></a>00258         <span class="keywordflow">return</span> sourceUris, sinks
<a name="l00259"></a>00259 
<a name="l00260"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a1f3a19113ffa58a8322f31b79b656d2d">00260</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a1f3a19113ffa58a8322f31b79b656d2d">_sink_StartFlows</a>(self, tests, sourceUris, sinks):
<a name="l00261"></a>00261         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00262"></a>00262 <span class="stringliteral">        subroutine to connect the flows specified in the tests, purely</span>
<a name="l00263"></a>00263 <span class="stringliteral">        using the sink API.</span>
<a name="l00264"></a>00264 <span class="stringliteral"></span>
<a name="l00265"></a>00265 <span class="stringliteral">        In the future it would be nice to verify that the flow truly</span>
<a name="l00266"></a>00266 <span class="stringliteral">        exists, but for now trust what the sink says</span>
<a name="l00267"></a>00267 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00268"></a>00268         reliable = 1 <span class="comment">#don&#39;t have UDP yet</span>
<a name="l00269"></a>00269         <span class="keywordflow">for</span> test <span class="keywordflow">in</span> tests:
<a name="l00270"></a>00270             sourceName, sinkName = test[0]
<a name="l00271"></a>00271             sourceUri = sourceUris[sourceName]
<a name="l00272"></a>00272             sink = sinks[sinkName]
<a name="l00273"></a>00273             callerId, sourceLocator, sinkLocator = test[1]
<a name="l00274"></a>00274             <span class="keywordflow">print</span> <span class="stringliteral">&quot;Testing&quot;</span>, test
<a name="l00275"></a>00275             val = apiSuccess(sink.sinkConnectFlow(callerId, sourceLocator, sinkLocator, sourceUri, reliable))
<a name="l00276"></a>00276             <span class="keyword">assert</span> type(val) == int
<a name="l00277"></a>00277 
<a name="l00278"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a43b5edaaa01dcac9374713bd3de48f0e">00278</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a43b5edaaa01dcac9374713bd3de48f0e">_sink_KillFlows</a>(self, tests, sinks):
<a name="l00279"></a>00279         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00280"></a>00280 <span class="stringliteral">        subroutine to kill the flows specified in the tests, purely</span>
<a name="l00281"></a>00281 <span class="stringliteral">        using the sink API (i.e. source will still be running)</span>
<a name="l00282"></a>00282 <span class="stringliteral"></span>
<a name="l00283"></a>00283 <span class="stringliteral">        In the future it would be nice to verify that the flow was</span>
<a name="l00284"></a>00284 <span class="stringliteral">        killed, but for now trust what the sink says&quot;&quot;&quot;</span>
<a name="l00285"></a>00285         reliable = 1 <span class="comment">#don&#39;t have UDP yet</span>
<a name="l00286"></a>00286         <span class="keywordflow">for</span> test <span class="keywordflow">in</span> tests:
<a name="l00287"></a>00287             sourceName, sinkName = test[0]
<a name="l00288"></a>00288             sink = sinks[sinkName]
<a name="l00289"></a>00289             callerId, sourceLocator, sinkLocator = test[1]
<a name="l00290"></a>00290             <span class="keywordflow">print</span> <span class="stringliteral">&quot;Testing&quot;</span>, test
<a name="l00291"></a>00291             <span class="keyword">assert</span> 1 == apiSuccess(sink.sinkKillFlow(callerId, sourceLocator, sinkLocator)),\
<a name="l00292"></a>00292                    <span class="stringliteral">&quot;sink did not report 1 flow killed: %s, %s&quot;</span>%(getLastVal(), getLastMsg())
<a name="l00293"></a>00293     
<a name="l00294"></a>00294     <span class="comment">#sinkConnectFlow(sourceLocator, sinkLocator, sourceXmlRpcURI, reliable)</span>
<a name="l00295"></a>00295     <span class="comment"># * API call on the sink of a flow. Called by master.</span>
<a name="l00296"></a>00296     <span class="comment"># * master requests that sink negotiate with the source to establish the flow</span>
<a name="l00297"></a>00297     <span class="comment"># * returns meaningless int</span>
<a name="l00298"></a>00298     <span class="comment"># * synchronous call, blocks until success/fail</span>
<a name="l00299"></a>00299 
<a name="l00300"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a81a6a5d9028df54689791c10beaf61ae">00300</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a81a6a5d9028df54689791c10beaf61ae">testSinkConnectFlow</a>(self):
<a name="l00301"></a>00301         master = self.master
<a name="l00302"></a>00302         sourceUris, sinks = self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a4a1b4f02ad9b944c959bf8545b8c1d3c">_sink_StartNodes</a>(self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a1e71182509413a4044f04a0982f6fef6">sinkTests</a>)
<a name="l00303"></a>00303         self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a1f3a19113ffa58a8322f31b79b656d2d">_sink_StartFlows</a>(self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a1e71182509413a4044f04a0982f6fef6">sinkTests</a>, sourceUris, sinks)
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 <span class="comment"># sinkKillFlow(sourceLocator, sinkLocator)</span>
<a name="l00306"></a>00306 <span class="comment"># * called by master</span>
<a name="l00307"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a0a0fac61c027b7d089889dede019e82e">00307</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a0a0fac61c027b7d089889dede019e82e">testSinkKillFlow</a>(self):
<a name="l00308"></a>00308         slave = self.slave
<a name="l00309"></a>00309         master = self.master
<a name="l00310"></a>00310         apiError(slave.sinkKillFlow(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00311"></a>00311         
<a name="l00312"></a>00312         <span class="comment">#startup the standard sink tests</span>
<a name="l00313"></a>00313         sourceUris, sinks = self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a4a1b4f02ad9b944c959bf8545b8c1d3c">_sink_StartNodes</a>(self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a1e71182509413a4044f04a0982f6fef6">sinkTests</a>)
<a name="l00314"></a>00314         self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a1f3a19113ffa58a8322f31b79b656d2d">_sink_StartFlows</a>(self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a1e71182509413a4044f04a0982f6fef6">sinkTests</a>, sourceUris, sinks)
<a name="l00315"></a>00315         self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a43b5edaaa01dcac9374713bd3de48f0e">_sink_KillFlows</a>(self.<a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#a1e71182509413a4044f04a0982f6fef6">sinkTests</a>, sinks)        
<a name="l00316"></a>00316     
<a name="l00317"></a><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#ac2cf699daead6b31d1bf7dbc7b09931c">00317</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testSlave_1_1SlaveTestCase.html#ac2cf699daead6b31d1bf7dbc7b09931c">testMisc</a>(self):
<a name="l00318"></a>00318         slave = self.slave
<a name="l00319"></a>00319         <span class="keyword">assert</span> slave <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>, <span class="stringliteral">&quot;slave is None&quot;</span>
<a name="l00320"></a>00320         <span class="comment">#getMasterUri</span>
<a name="l00321"></a>00321         masterUri = apiSuccess(slave.getMasterUri(<span class="stringliteral">&#39;&#39;</span>))
<a name="l00322"></a>00322         <span class="keyword">assert</span> getMasterUri() == masterUri <span class="keywordflow">or</span> getMasterUriAlt() == masterUri, masterUri
<a name="l00323"></a>00323         <span class="keyword">assert</span> masterUri == apiSuccess(slave.getMasterUri(<span class="stringliteral">&#39;a.different.id&#39;</span>))
<a name="l00324"></a>00324         <span class="comment">#getPid</span>
<a name="l00325"></a>00325         pid = apiSuccess(slave.getPid(<span class="stringliteral">&#39;&#39;</span>))
<a name="l00326"></a>00326         <span class="keyword">assert</span> pid == apiSuccess(slave.getPid(<span class="stringliteral">&#39;a.different.id&#39;</span>))
<a name="l00327"></a>00327         <span class="comment">#callerId must be string</span>
<a name="l00328"></a>00328         apiError(slave.getPid(0))
<a name="l00329"></a>00329         apiError(slave.getMasterUri(0))        
<a name="l00330"></a>00330         <span class="keywordflow">try</span>:
<a name="l00331"></a>00331             slave.shutdown(<span class="stringliteral">&#39;some.id&#39;</span>)
<a name="l00332"></a>00332         <span class="keywordflow">except</span>:
<a name="l00333"></a>00333             <span class="keywordflow">pass</span>
<a name="l00334"></a>00334         time.sleep(0.1)
<a name="l00335"></a>00335         <span class="keywordflow">try</span>:
<a name="l00336"></a>00336             code, status, val = slave.getPid(<span class="stringliteral">&#39;&#39;</span>)
<a name="l00337"></a>00337             <span class="keyword">assert</span> code &lt; 1, <span class="stringliteral">&quot;Slave is still running after shutdown&quot;</span>
<a name="l00338"></a>00338         <span class="keywordflow">except</span>:
<a name="l00339"></a>00339             <span class="keywordflow">pass</span>
<a name="l00340"></a>00340             
</pre></div></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/test_rosmaster">test_rosmaster</a><br />
Author(s): Ken Conley</br />
<small>autogenerated on Fri Aug 28 2015 12:33:45</small>
</div>
</body>
</html>
