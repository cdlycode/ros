<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>test_rosmaster: testMaster.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">


<link rel="canonical" href="http://docs.ros.org/hydro/api/test_rosmaster/html/testMaster_8py_source.html" />
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">testMaster.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="http://docs.ros.org/en/hydro/api/test_rosmaster/html/testMaster_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacetest_1_1testMaster.html">00001</a> <span class="comment"># Software License Agreement (BSD License)</span>
<a name="l00002"></a>00002 <span class="comment">#</span>
<a name="l00003"></a>00003 <span class="comment"># Copyright (c) 2008, Willow Garage, Inc.</span>
<a name="l00004"></a>00004 <span class="comment"># All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment">#</span>
<a name="l00006"></a>00006 <span class="comment"># Redistribution and use in source and binary forms, with or without</span>
<a name="l00007"></a>00007 <span class="comment"># modification, are permitted provided that the following conditions</span>
<a name="l00008"></a>00008 <span class="comment"># are met:</span>
<a name="l00009"></a>00009 <span class="comment">#</span>
<a name="l00010"></a>00010 <span class="comment">#  * Redistributions of source code must retain the above copyright</span>
<a name="l00011"></a>00011 <span class="comment">#    notice, this list of conditions and the following disclaimer.</span>
<a name="l00012"></a>00012 <span class="comment">#  * Redistributions in binary form must reproduce the above</span>
<a name="l00013"></a>00013 <span class="comment">#    copyright notice, this list of conditions and the following</span>
<a name="l00014"></a>00014 <span class="comment">#    disclaimer in the documentation and/or other materials provided</span>
<a name="l00015"></a>00015 <span class="comment">#    with the distribution.</span>
<a name="l00016"></a>00016 <span class="comment">#  * Neither the name of Willow Garage, Inc. nor the names of its</span>
<a name="l00017"></a>00017 <span class="comment">#    contributors may be used to endorse or promote products derived</span>
<a name="l00018"></a>00018 <span class="comment">#    from this software without specific prior written permission.</span>
<a name="l00019"></a>00019 <span class="comment">#</span>
<a name="l00020"></a>00020 <span class="comment"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00021"></a>00021 <span class="comment"># &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00022"></a>00022 <span class="comment"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS</span>
<a name="l00023"></a>00023 <span class="comment"># FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE</span>
<a name="l00024"></a>00024 <span class="comment"># COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</span>
<a name="l00025"></a>00025 <span class="comment"># INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</span>
<a name="l00026"></a>00026 <span class="comment"># BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<a name="l00027"></a>00027 <span class="comment"># LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<a name="l00028"></a>00028 <span class="comment"># CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<a name="l00029"></a>00029 <span class="comment"># LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN</span>
<a name="l00030"></a>00030 <span class="comment"># ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<a name="l00031"></a>00031 <span class="comment"># POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00032"></a>00032 <span class="comment">#</span>
<a name="l00033"></a>00033 <span class="comment"># Revision $Id$</span>
<a name="l00034"></a>00034 <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00035"></a>00035 <span class="stringliteral">testMaster: ROS integration test cases for master XML-RPC API</span>
<a name="l00036"></a>00036 <span class="stringliteral"></span>
<a name="l00037"></a>00037 <span class="stringliteral">To run, invoke nodes/testMaster</span>
<a name="l00038"></a>00038 <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="keyword">import</span> os, sys, getopt, traceback, logging, socket
<a name="l00041"></a>00041 <span class="keyword">import</span> datetime, xmlrpclib, math, random
<a name="l00042"></a>00042 <span class="keyword">import</span> unittest
<a name="l00043"></a>00043 <span class="keyword">import</span> rospy
<a name="l00044"></a>00044 <span class="keyword">from</span> rostest <span class="keyword">import</span> *
<a name="l00045"></a>00045 <span class="keyword">from</span> testSlave <span class="keyword">import</span> msMain
<a name="l00046"></a>00046 
<a name="l00047"></a><a class="code" href="namespacetest_1_1testMaster.html#aa3359e5bb301643b156b8e60993fc0f5">00047</a> MYPKG = <span class="stringliteral">&#39;test_rosmaster&#39;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="namespacetest_1_1testMaster.html#a610049fc67c3f17a017af9b441abead1">00049</a> HAS_PARAM = <span class="keyword">True</span>
<a name="l00050"></a>00050 
<a name="l00051"></a><a class="code" href="namespacetest_1_1testMaster.html#a7ae7de3c6a49368d0fbd7f9ff25113ec">00051</a> singletest = <span class="stringliteral">&#39;testGetFlowNames&#39;</span>
<a name="l00052"></a>00052 singletest = <span class="keywordtype">None</span>
<a name="l00053"></a>00053 <span class="comment">#singletest = &#39;testDotLocalNames&#39;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a><a class="code" href="namespacetest_1_1testMaster.html#aca320cc1080a5e92d25935cd502e4008">00055</a> <span class="keyword">def </span><a class="code" href="namespacetest_1_1testMaster.html#aca320cc1080a5e92d25935cd502e4008">verifyNodeAddress</a>(master, callerId, name, machine, addr, port):
<a name="l00056"></a>00056     <span class="keywordflow">if</span> <span class="keywordflow">not</span> name:
<a name="l00057"></a>00057         <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&quot;name is None&quot;</span>)
<a name="l00058"></a>00058     rmachine, raddr, rport = apiSuccess(master.getNodeAddress(callerId, name))
<a name="l00059"></a>00059     <span class="keywordflow">if</span> machine:
<a name="l00060"></a>00060         <span class="keyword">assert</span> rmachine == machine, <span class="stringliteral">&quot;Node [%s] is running on &#39;%s&#39; instead of &#39;%s&#39;&quot;</span>%(name, rmachine, machine)
<a name="l00061"></a>00061     <span class="keywordflow">if</span> port:
<a name="l00062"></a>00062         <span class="keyword">assert</span> rport == port, <span class="stringliteral">&quot;Node [%s] is running on &#39;%s&#39; instead of &#39;%s&#39;&quot;</span>%(name, rport, port)
<a name="l00063"></a>00063     <span class="keywordflow">else</span>:
<a name="l00064"></a>00064         <span class="keyword">assert</span> rport, <span class="stringliteral">&quot;Node [%s] does not have a registered port&quot;</span>%name
<a name="l00065"></a>00065     <span class="keywordflow">if</span> addr:
<a name="l00066"></a>00066         <span class="keywordflow">if</span> addr == <span class="stringliteral">&#39;localhost&#39;</span>:
<a name="l00067"></a>00067             addr = socket.gethostname()
<a name="l00068"></a>00068         <span class="keywordflow">if</span> raddr == <span class="stringliteral">&#39;localhost&#39;</span>:
<a name="l00069"></a>00069             raddr = socket.gethostname()
<a name="l00070"></a>00070         addrinfo = socket.getaddrinfo(addr, 0, 0, 0, socket.SOL_TCP)
<a name="l00071"></a>00071         raddrinfo = socket.getaddrinfo(raddr, 0, 0, 0, socket.SOL_TCP)
<a name="l00072"></a>00072         <span class="keyword">assert</span> raddrinfo == addrinfo, <span class="stringliteral">&quot;%s!=%s&quot;</span> % (raddrinfo, addrinfo)
<a name="l00073"></a>00073     <span class="comment">#ping the node</span>
<a name="l00074"></a>00074     apiSuccess(xmlrpclib.ServerProxy(<span class="stringliteral">&quot;http://%s:%s/&quot;</span>%(raddr, rport)).getPid(<span class="stringliteral">&#39;&#39;</span>))
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="namespacetest_1_1testMaster.html#a89b54e8c6edb3f125f6e2c87d180123c">00076</a> <span class="keyword">def </span><a class="code" href="namespacetest_1_1testMaster.html#a89b54e8c6edb3f125f6e2c87d180123c">testGraphState</a>(master, graphNodes, graphFlows):
<a name="l00077"></a>00077     graph = apiSuccess(master.getGraph(<span class="stringliteral">&#39;&#39;</span>))
<a name="l00078"></a>00078     diff = set(graph[0]) ^ set(graphNodes)
<a name="l00079"></a>00079     <span class="keyword">assert</span> <span class="keywordflow">not</span> diff, <span class="stringliteral">&quot;Graph nodes %s does not match expected %s: %s&quot;</span>%(graph[0], graphNodes, diff)
<a name="l00080"></a>00080     <span class="comment"># stringify for comparison</span>
<a name="l00081"></a>00081     expectedFlows = [<span class="stringliteral">&quot;%s:%s:1&quot;</span>%f <span class="keywordflow">for</span> f <span class="keywordflow">in</span> graphFlows] <span class="comment"># :1 = connected</span>
<a name="l00082"></a>00082     <span class="keywordflow">print</span> graph[1]
<a name="l00083"></a>00083     remoteFlows = [<span class="stringliteral">&quot;%s:%s:%s&quot;</span>%(src,snk,c) <span class="keywordflow">for</span> (src,snk,c) <span class="keywordflow">in</span> graph[1]]
<a name="l00084"></a>00084     <span class="keywordflow">if</span> expectedFlows <span class="keywordflow">or</span> remoteFlows:
<a name="l00085"></a>00085         <span class="comment">#assert set(expectedFlows) ^ set(remoteFlows), &quot;Graph flows [%s] does not match expected [%s]&quot;%(graph[1], graphFlows)</span>
<a name="l00086"></a>00086         diff = set(expectedFlows) ^ set(remoteFlows)
<a name="l00087"></a>00087         <span class="keyword">assert</span> <span class="keywordflow">not</span> diff, <span class="stringliteral">&quot;Graph flows %s does not match expected %s: %s&quot;</span>%(expectedFlows, remoteFlows, diff)
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">00089</a> <span class="keyword">def </span><a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">testParamState</a>(master, myState):
<a name="l00090"></a>00090     callerId = <span class="stringliteral">&#39;master&#39;</span> <span class="comment">#validate from root </span>
<a name="l00091"></a>00091     <span class="keywordflow">for</span> (k, v) <span class="keywordflow">in</span> myState.iteritems():
<a name="l00092"></a>00092         <span class="keywordflow">if</span> HAS_PARAM:
<a name="l00093"></a>00093             <span class="keyword">assert</span> apiSuccess(master.hasParam(callerId, k))
<a name="l00094"></a>00094         <span class="keywordflow">print</span> <span class="stringliteral">&quot;verifying parameter %s&quot;</span>%k
<a name="l00095"></a>00095         v2 = apiSuccess(master.getParam(callerId, k))
<a name="l00096"></a>00096         <span class="keywordflow">if</span> isinstance(v2, xmlrpclib.DateTime):
<a name="l00097"></a>00097             <span class="keyword">assert</span> xmlrpclib.DateTime(v) == v2, <span class="stringliteral">&quot;[%s]: %s != %s, %s&quot;</span>%(k, v, v2, v2.__class__)
<a name="l00098"></a>00098         <span class="keywordflow">else</span>:
<a name="l00099"></a>00099             <span class="keyword">assert</span> v == v2, <span class="stringliteral">&quot;[%s]: %s != %s, %s&quot;</span>%(k, v, v2, v2.__class__)
<a name="l00100"></a>00100     paramNames = myState.keys()
<a name="l00101"></a>00101     remoteParamNames = apiSuccess(master.getParamNames(callerId))
<a name="l00102"></a>00102     <span class="keyword">assert</span> <span class="keywordflow">not</span> set(paramNames) ^ set(remoteParamNames), <span class="stringliteral">&quot;parameter server keys do not match local&quot;</span> 
<a name="l00103"></a>00103 
<a name="l00104"></a><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html">00104</a> <span class="keyword">class </span><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html">ParamServerTestCase</a>(ROSGraphTestCase):
<a name="l00105"></a>00105     <span class="stringliteral">&quot;&quot;&quot;Parameter Server API Test Cases&quot;&quot;&quot;</span>
<a name="l00106"></a>00106     
<a name="l00107"></a><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#aed95aa728a2eeb9528d31b2b57d42c0d">00107</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#aed95aa728a2eeb9528d31b2b57d42c0d">setUp</a>(self):
<a name="l00108"></a>00108         super(ParamServerTestCase, self).<a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#aed95aa728a2eeb9528d31b2b57d42c0d">setUp</a>()
<a name="l00109"></a>00109     
<a name="l00110"></a><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#a443a956181b328b529751f76a45c3b00">00110</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#a443a956181b328b529751f76a45c3b00">tearDown</a>(self):
<a name="l00111"></a>00111         super(ParamServerTestCase, self).<a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#a443a956181b328b529751f76a45c3b00">tearDown</a>()        
<a name="l00112"></a>00112 
<a name="l00113"></a><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#a5933113a8a5e9cbc32c61168b92f0472">00113</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#a5933113a8a5e9cbc32c61168b92f0472">_testSetParam</a>(self, ctx, myState, testVals, master):
<a name="l00114"></a>00114         <span class="keywordflow">for</span> type, vals <span class="keywordflow">in</span> testVals:
<a name="l00115"></a>00115             <span class="keywordflow">try</span>:
<a name="l00116"></a>00116                 <span class="keywordflow">if</span> ctx:
<a name="l00117"></a>00117                     callerId = <span class="stringliteral">&quot;%s.node&quot;</span>%ctx
<a name="l00118"></a>00118                 <span class="keywordflow">else</span>:
<a name="l00119"></a>00119                     callerId = <span class="stringliteral">&quot;node&quot;</span>
<a name="l00120"></a>00120                 count = 0
<a name="l00121"></a>00121                 <span class="keywordflow">for</span> val <span class="keywordflow">in</span> vals:
<a name="l00122"></a>00122                     key = <span class="stringliteral">&quot;%s-%s&quot;</span>%(type,count)
<a name="l00123"></a>00123                     <span class="keywordflow">print</span> <span class="stringliteral">&quot;master.setParam(%s,%s,%s)&quot;</span>%(callerId, key, val)
<a name="l00124"></a>00124                     master.setParam(callerId, key, val)
<a name="l00125"></a>00125                     <span class="keywordflow">if</span> HAS_PARAM:                    
<a name="l00126"></a>00126                         <span class="keyword">assert</span> apiSuccess(master.hasParam(callerId, key))
<a name="l00127"></a>00127                     <span class="keywordflow">if</span> ctx:
<a name="l00128"></a>00128                         trueKey = <span class="stringliteral">&quot;%s.%s&quot;</span>%(ctx, key)
<a name="l00129"></a>00129                     <span class="keywordflow">else</span>:
<a name="l00130"></a>00130                         trueKey = key
<a name="l00131"></a>00131                     myState[trueKey] = val
<a name="l00132"></a>00132                     count += 1
<a name="l00133"></a>00133             <span class="keywordflow">except</span>:
<a name="l00134"></a>00134                 <span class="keyword">assert</span> <span class="stringliteral">&quot;getParam failed on type[%s], val[%s]&quot;</span>%(type,val)
<a name="l00135"></a>00135         <a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">testParamState</a>(master, myState)
<a name="l00136"></a>00136 
<a name="l00137"></a><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#a3d5aece27615f954601de168ac3792da">00137</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#a3d5aece27615f954601de168ac3792da">testParamValues</a>(self):
<a name="l00138"></a>00138         <span class="stringliteral">&quot;&quot;&quot;testParamValues: test storage of all XML-RPC compatible types&quot;&quot;&quot;</span>
<a name="l00139"></a>00139         <span class="keyword">from</span> xmlrpclib <span class="keyword">import</span> Binary
<a name="l00140"></a>00140         testVals = [
<a name="l00141"></a>00141             [<span class="stringliteral">&#39;int&#39;</span>, [0, 1024, 2147483647, -2147483647]],
<a name="l00142"></a>00142             [<span class="stringliteral">&#39;boolean&#39;</span>, [<span class="keyword">True</span>, <span class="keyword">False</span>]],
<a name="l00143"></a>00143             [<span class="stringliteral">&#39;string&#39;</span>, [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;\0&#39;</span>, <span class="stringliteral">&#39;x&#39;</span>, <span class="stringliteral">&#39;hello&#39;</span>, <span class="stringliteral">&#39;&#39;</span>.join([chr(n) <span class="keywordflow">for</span> n <span class="keywordflow">in</span> xrange(0, 255)])]],
<a name="l00144"></a>00144             [<span class="stringliteral">&#39;double&#39;</span>, [0.0, math.pi, -math.pi, 3.4028235e+38, -3.4028235e+38]],
<a name="l00145"></a>00145             <span class="comment">#TODO: microseconds?</span>
<a name="l00146"></a>00146             [<span class="stringliteral">&#39;datetime&#39;</span>, [datetime.datetime(2005, 12, 6, 12, 13, 14), datetime.datetime(1492, 12, 6, 12, 13, 14)]],
<a name="l00147"></a>00147             [<span class="stringliteral">&#39;base64&#39;</span>, [Binary(<span class="stringliteral">&#39;&#39;</span>), Binary(<span class="stringliteral">&#39;\0&#39;</span>), Binary(<span class="stringliteral">&#39;&#39;</span>.join([chr(n) <span class="keywordflow">for</span> n <span class="keywordflow">in</span> xrange(0, 255)]))]],
<a name="l00148"></a>00148             [<span class="stringliteral">&#39;struct&#39;</span>, [{ <span class="stringliteral">&quot;a&quot;</span>: 2, <span class="stringliteral">&quot;b&quot;</span>: 4},
<a name="l00149"></a>00149                         {<span class="stringliteral">&quot;a&quot;</span> : <span class="stringliteral">&quot;b&quot;</span>, <span class="stringliteral">&quot;c&quot;</span> : <span class="stringliteral">&quot;d&quot;</span>},
<a name="l00150"></a>00150                         {<span class="stringliteral">&quot;a&quot;</span> : {<span class="stringliteral">&quot;b&quot;</span> : { <span class="stringliteral">&quot;c&quot;</span> : <span class="stringliteral">&quot;d&quot;</span>}}}]],
<a name="l00151"></a>00151             [<span class="stringliteral">&#39;array&#39;</span>, [[], [1, 2, 3], [<span class="stringliteral">&#39;a&#39;</span>, <span class="stringliteral">&#39;b&#39;</span>, <span class="stringliteral">&#39;c&#39;</span>], [0.0, 0.1, 0.2, 2.0, 2.1, -4.0],
<a name="l00152"></a>00152                        [1, <span class="stringliteral">&#39;a&#39;</span>, math.pi], [[1, 2, 3], [<span class="stringliteral">&#39;a&#39;</span>, <span class="stringliteral">&#39;b&#39;</span>, <span class="stringliteral">&#39;c&#39;</span>], [1.0, 2.1, 3.2]]]
<a name="l00153"></a>00153              ],
<a name="l00154"></a>00154             ]
<a name="l00155"></a>00155         master = self.master
<a name="l00156"></a>00156 
<a name="l00157"></a>00157         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Putting parameters onto the server&quot;</span>
<a name="l00158"></a>00158         <span class="comment"># put our params into the parameter server</span>
<a name="l00159"></a>00159         contexts = [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;scope1&#39;</span>, <span class="stringliteral">&#39;scope2&#39;</span>, <span class="stringliteral">&#39;scope.subscope1&#39;</span>, <span class="stringliteral">&#39;scope.sub1.sub2&#39;</span>]
<a name="l00160"></a>00160         myState = {}
<a name="l00161"></a>00161         <span class="keywordflow">for</span> ctx <span class="keywordflow">in</span> contexts:
<a name="l00162"></a>00162             self.<a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#a5933113a8a5e9cbc32c61168b92f0472">_testSetParam</a>(ctx, myState, testVals, master)
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Deleting all of our parameters&quot;</span>
<a name="l00165"></a>00165         <span class="comment"># delete all of our parameters</span>
<a name="l00166"></a>00166         paramKeys = myState.keys()
<a name="l00167"></a>00167         <span class="keywordflow">for</span> key <span class="keywordflow">in</span> paramKeys:
<a name="l00168"></a>00168             apiSuccess(master.deleteParam(<span class="stringliteral">&#39;&#39;</span>, key))
<a name="l00169"></a>00169             del myState[key]
<a name="l00170"></a>00170         <a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">testParamState</a>(master, myState)
<a name="l00171"></a>00171 
<a name="l00172"></a><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#a45ebf7a1aaff27eb204425db2c823f08">00172</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#a45ebf7a1aaff27eb204425db2c823f08">testEncapsulation</a>(self):
<a name="l00173"></a>00173         <span class="stringliteral">&quot;&quot;&quot;testEncapsulation: test encapsulation: setting same parameter at different levels&quot;&quot;&quot;</span>
<a name="l00174"></a>00174         master = self.master
<a name="l00175"></a>00175         myState = {}
<a name="l00176"></a>00176         <a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">testParamState</a>(master, myState)
<a name="l00177"></a>00177 
<a name="l00178"></a>00178         testContexts = [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;en&#39;</span>, <span class="stringliteral">&#39;en.sub1&#39;</span>, <span class="stringliteral">&#39;en.sub2&#39;</span>, <span class="stringliteral">&#39;en.sub1.sub2&#39;</span>]
<a name="l00179"></a>00179         <span class="keywordflow">for</span> c <span class="keywordflow">in</span> testContexts:
<a name="l00180"></a>00180             testKey = <span class="stringliteral">&#39;param1&#39;</span>
<a name="l00181"></a>00181             testVal = random.randint(-1000000, 100000)
<a name="l00182"></a>00182             <span class="keywordflow">if</span> c:
<a name="l00183"></a>00183                 callerId = <span class="stringliteral">&quot;%s.node&quot;</span>%c
<a name="l00184"></a>00184                 trueKey = <span class="stringliteral">&quot;%s.%s&quot;</span>%(c,testKey)
<a name="l00185"></a>00185             <span class="keywordflow">else</span>:
<a name="l00186"></a>00186                 callerId =<span class="stringliteral">&quot;node&quot;</span>
<a name="l00187"></a>00187                 trueKey = testKey
<a name="l00188"></a>00188             master.setParam(callerId, testKey, testVal)
<a name="l00189"></a>00189             myState[trueKey] = testVal
<a name="l00190"></a>00190             <span class="comment"># make sure the master has the parameter under both keys and that they are equal</span>
<a name="l00191"></a>00191             v1 = apiSuccess(master.getParam(<span class="stringliteral">&#39;&#39;</span>, trueKey))
<a name="l00192"></a>00192             v2 = apiSuccess(master.getParam(callerId, testKey))
<a name="l00193"></a>00193             <span class="keyword">assert</span> v1 == v2, <span class="stringliteral">&quot;[%s]: %s vs. [%s,%s]: %s&quot;</span>%(trueKey, v1, callerId, testKey, v2)
<a name="l00194"></a>00194             <span class="keywordflow">if</span> HAS_PARAM:
<a name="l00195"></a>00195                 <span class="keyword">assert</span> apiSuccess(master.hasParam(callerId, testKey)), testKey
<a name="l00196"></a>00196                 <span class="keyword">assert</span> apiSuccess(master.hasParam(<span class="stringliteral">&#39;node&#39;</span>, trueKey)), trueKey
<a name="l00197"></a>00197 
<a name="l00198"></a>00198         <a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">testParamState</a>(master, myState)
<a name="l00199"></a>00199 
<a name="l00200"></a><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#ac7b74bf3afc33b5879ed46238f94f517">00200</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#ac7b74bf3afc33b5879ed46238f94f517">testDotLocalNames</a>(self):
<a name="l00201"></a>00201         master = self.master
<a name="l00202"></a>00202         myState = {}
<a name="l00203"></a>00203         <a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">testParamState</a>(master, myState)
<a name="l00204"></a>00204 
<a name="l00205"></a>00205         testContexts = [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;sub1&#39;</span>, <span class="stringliteral">&#39;sub1.sub2&#39;</span>, <span class="stringliteral">&#39;sub1.sub2.sub3&#39;</span>]
<a name="l00206"></a>00206         <span class="keywordflow">for</span> c <span class="keywordflow">in</span> testContexts:
<a name="l00207"></a>00207             <span class="keywordflow">if</span> c:
<a name="l00208"></a>00208                 callerId = <span class="stringliteral">&quot;%s.node&quot;</span>%c
<a name="l00209"></a>00209             <span class="keywordflow">else</span>:
<a name="l00210"></a>00210                 callerId = <span class="stringliteral">&quot;node&quot;</span>
<a name="l00211"></a>00211             testKey = <span class="stringliteral">&quot;.param1&quot;</span>
<a name="l00212"></a>00212             testVal = random.randint(-1000000, 100000)            
<a name="l00213"></a>00213             master.setParam(callerId, testKey, testVal)
<a name="l00214"></a>00214             trueKey = callerId+testKey
<a name="l00215"></a>00215             myState[trueKey] = testVal
<a name="l00216"></a>00216 
<a name="l00217"></a>00217             v1 = apiSuccess(master.getParam(<span class="stringliteral">&#39;node&#39;</span>, trueKey))
<a name="l00218"></a>00218             v2 = apiSuccess(master.getParam(callerId, testKey))
<a name="l00219"></a>00219             <span class="keyword">assert</span> v1 == v2, <span class="stringliteral">&quot;[%s]: %s vs. [%s,%s]: %s&quot;</span>%(trueKey, v1, callerId, testKey, v2)
<a name="l00220"></a>00220             <span class="keywordflow">if</span> HAS_PARAM:
<a name="l00221"></a>00221                 <span class="keyword">assert</span> apiSuccess(master.hasParam(callerId, testKey)), testKey
<a name="l00222"></a>00222                 <span class="keyword">assert</span> apiSuccess(master.hasParam(<span class="stringliteral">&#39;node&#39;</span>, trueKey)), trueKey
<a name="l00223"></a>00223 
<a name="l00224"></a>00224             <span class="comment">#test setting a local param on a different node</span>
<a name="l00225"></a>00225             testKey = <span class="stringliteral">&quot;altnode.param2&quot;</span>
<a name="l00226"></a>00226             testVal = random.randint(-1000000, 100000)            
<a name="l00227"></a>00227             master.setParam(callerId, testKey, testVal)
<a name="l00228"></a>00228             <span class="keywordflow">if</span> c:
<a name="l00229"></a>00229                 trueKey = <span class="stringliteral">&quot;%s.%s&quot;</span>%(c,testKey)
<a name="l00230"></a>00230                 altCallerId = <span class="stringliteral">&quot;%s.altnode&quot;</span>%c
<a name="l00231"></a>00231             <span class="keywordflow">else</span>:
<a name="l00232"></a>00232                 trueKey = testKey
<a name="l00233"></a>00233                 altCallerId = <span class="stringliteral">&quot;altnode&quot;</span>
<a name="l00234"></a>00234             myState[trueKey] = testVal
<a name="l00235"></a>00235 
<a name="l00236"></a>00236             v1 = apiSuccess(master.getParam(altCallerId, <span class="stringliteral">&quot;.param2&quot;</span>))
<a name="l00237"></a>00237             v2 = apiSuccess(master.getParam(callerId, testKey))
<a name="l00238"></a>00238             <span class="keyword">assert</span> v1 == v2
<a name="l00239"></a>00239             <span class="keywordflow">if</span> HAS_PARAM:
<a name="l00240"></a>00240                 <span class="keyword">assert</span> apiSuccess(master.hasParam(callerId, testKey)), testKey
<a name="l00241"></a>00241                 <span class="keyword">assert</span> apiSuccess(master.hasParam(altCallerId, <span class="stringliteral">&quot;.param2&quot;</span>))
<a name="l00242"></a>00242 
<a name="l00243"></a>00243         <a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">testParamState</a>(master, myState)
<a name="l00244"></a>00244 
<a name="l00245"></a><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#a5ef884df48d02cb508dadd49780bc6d5">00245</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#a5ef884df48d02cb508dadd49780bc6d5">testScopeUp</a>(self):
<a name="l00246"></a>00246         <span class="stringliteral">&quot;&quot;&quot;testScopeUp: test that parameter server can chain up scopes to find/delete parameters&quot;&quot;&quot;</span>
<a name="l00247"></a>00247         master = self.master
<a name="l00248"></a>00248         myState = {}
<a name="l00249"></a>00249         <a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">testParamState</a>(master, myState)
<a name="l00250"></a>00250         
<a name="l00251"></a>00251         testVal = random.randint(-1000000, 100000)
<a name="l00252"></a>00252         master.setParam(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;uparam1&#39;</span>, testVal)
<a name="l00253"></a>00253         myState[<span class="stringliteral">&#39;uparam1&#39;</span>] = testVal 
<a name="l00254"></a>00254         <span class="keyword">assert</span> testVal == apiSuccess(master.getParam(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;uparam1&#39;</span>))
<a name="l00255"></a>00255         <span class="keyword">assert</span> testVal == apiSuccess(master.getParam(<span class="stringliteral">&#39;uptest.node&#39;</span>, <span class="stringliteral">&#39;uparam1&#39;</span>))
<a name="l00256"></a>00256         <span class="keyword">assert</span> testVal == apiSuccess(master.getParam(<span class="stringliteral">&#39;uptest.sub1.node&#39;</span>, <span class="stringliteral">&#39;uparam1&#39;</span>))
<a name="l00257"></a>00257         <span class="keyword">assert</span> testVal == apiSuccess(master.getParam(<span class="stringliteral">&#39;uptest.sub1.sub2.node&#39;</span>, <span class="stringliteral">&#39;uparam1&#39;</span>))
<a name="l00258"></a>00258 
<a name="l00259"></a>00259         testVal = random.randint(-1000000, 100000)
<a name="l00260"></a>00260         master.setParam(<span class="stringliteral">&#39;uptest2.sub1.node&#39;</span>, <span class="stringliteral">&#39;uparam2&#39;</span>, testVal)
<a name="l00261"></a>00261         myState[<span class="stringliteral">&#39;uptest2.sub1.uparam2&#39;</span>] = testVal 
<a name="l00262"></a>00262         <span class="keyword">assert</span> testVal == apiSuccess(master.getParam(<span class="stringliteral">&#39;uptest2.sub1.node&#39;</span>, <span class="stringliteral">&#39;uparam2&#39;</span>))
<a name="l00263"></a>00263         <span class="keyword">assert</span> testVal == apiSuccess(master.getParam(<span class="stringliteral">&#39;uptest2.sub1.sub2.node&#39;</span>, <span class="stringliteral">&#39;uparam2&#39;</span>))
<a name="l00264"></a>00264         <span class="keyword">assert</span> testVal == apiSuccess(master.getParam(<span class="stringliteral">&#39;uptest2.sub1.sub2.sub3.node&#39;</span>, <span class="stringliteral">&#39;uparam2&#39;</span>))
<a name="l00265"></a>00265         <a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">testParamState</a>(master, myState)
<a name="l00266"></a>00266 
<a name="l00267"></a>00267         <span class="comment">#verify upwards deletion</span>
<a name="l00268"></a>00268         apiSuccess(master.deleteParam(<span class="stringliteral">&#39;uptest.sub1.sub2.node&#39;</span>, <span class="stringliteral">&#39;uparam1&#39;</span>))
<a name="l00269"></a>00269         del myState[<span class="stringliteral">&#39;uparam1&#39;</span>]
<a name="l00270"></a>00270         <a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">testParamState</a>(master, myState)        
<a name="l00271"></a>00271         apiSuccess(master.deleteParam(<span class="stringliteral">&#39;uptest2.sub1.sub2.sub3.node&#39;</span>, <span class="stringliteral">&#39;uparam2&#39;</span>))
<a name="l00272"></a>00272         del myState[<span class="stringliteral">&#39;uptest2.sub1.uparam2&#39;</span>]
<a name="l00273"></a>00273         <a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">testParamState</a>(master, myState)        
<a name="l00274"></a>00274         
<a name="l00275"></a><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#a740f2c350b4b863db4818bf081628be8">00275</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1ParamServerTestCase.html#a740f2c350b4b863db4818bf081628be8">testScopeDown</a>(self):
<a name="l00276"></a>00276         <span class="stringliteral">&quot;&quot;&quot;testScopeDown: test scoping rules for sub contexts&quot;&quot;&quot;</span>
<a name="l00277"></a>00277         master = self.master
<a name="l00278"></a>00278         myState = {}
<a name="l00279"></a>00279         <a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">testParamState</a>(master, myState)
<a name="l00280"></a>00280 
<a name="l00281"></a>00281         <span class="comment"># test that parameter server down not chain down scopes</span>
<a name="l00282"></a>00282         testVal = random.randint(-1000000, 100000)
<a name="l00283"></a>00283         master.setParam(<span class="stringliteral">&#39;down.one.two.three.node&#39;</span>, <span class="stringliteral">&#39;dparam1&#39;</span>, testVal)
<a name="l00284"></a>00284         myState[<span class="stringliteral">&#39;down.one.two.three.dparam1&#39;</span>] = testVal
<a name="l00285"></a>00285         <span class="keywordflow">if</span> HAS_PARAM:
<a name="l00286"></a>00286             <span class="keyword">assert</span> <span class="keywordflow">not</span> apiSuccess(master.hasParam(<span class="stringliteral">&#39;down.one&#39;</span>, <span class="stringliteral">&#39;dparam1&#39;</span>)) 
<a name="l00287"></a>00287             <span class="keyword">assert</span> <span class="keywordflow">not</span> apiSuccess(master.hasParam(<span class="stringliteral">&#39;down.one.two&#39;</span>, <span class="stringliteral">&#39;dparam1&#39;</span>))
<a name="l00288"></a>00288         apiError(master.getParam(<span class="stringliteral">&#39;down.one.node&#39;</span>, <span class="stringliteral">&#39;dparam1&#39;</span>)) 
<a name="l00289"></a>00289         apiError(master.getParam(<span class="stringliteral">&#39;down.one.two.node&#39;</span>, <span class="stringliteral">&#39;dparam1&#39;</span>))
<a name="l00290"></a>00290 
<a name="l00291"></a>00291         <span class="comment"># test that parameter server allows setting of parameters further down (1)</span>
<a name="l00292"></a>00292         testVal = random.randint(-1000000, 100000)
<a name="l00293"></a>00293         master.setParam(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;down2.dparam2&#39;</span>, testVal)
<a name="l00294"></a>00294         myState[<span class="stringliteral">&#39;down2.dparam2&#39;</span>] = testVal         
<a name="l00295"></a>00295         <span class="keyword">assert</span> testVal == apiSuccess(master.getParam(<span class="stringliteral">&#39;down2.node&#39;</span>, <span class="stringliteral">&#39;dparam2&#39;</span>))
<a name="l00296"></a>00296         <span class="keyword">assert</span> testVal == apiSuccess(master.getParam(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;down2.dparam2&#39;</span>))
<a name="l00297"></a>00297         <span class="keywordflow">if</span> HAS_PARAM:
<a name="l00298"></a>00298             <span class="keyword">assert</span> <span class="keywordflow">not</span> apiSuccess(master.hasParam(<span class="stringliteral">&#39;down2.node&#39;</span>, <span class="stringliteral">&#39;down2.dparam2&#39;</span>))
<a name="l00299"></a>00299         apiError(master.getParam(<span class="stringliteral">&#39;down2.node&#39;</span>, <span class="stringliteral">&#39;down2.dparam2&#39;</span>))
<a name="l00300"></a>00300         <a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">testParamState</a>(master, myState)
<a name="l00301"></a>00301         
<a name="l00302"></a>00302         <span class="comment"># test that parameter server allows setting of parameters further down (2)</span>
<a name="l00303"></a>00303         testVal = random.randint(-1000000, 100000)
<a name="l00304"></a>00304         master.setParam(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;down3.sub.dparam3&#39;</span>, testVal)
<a name="l00305"></a>00305         myState[<span class="stringliteral">&#39;down3.sub.dparam3&#39;</span>] = testVal
<a name="l00306"></a>00306         <span class="keyword">assert</span> testVal == apiSuccess(master.getParam(<span class="stringliteral">&#39;down3.sub.node&#39;</span>, <span class="stringliteral">&#39;dparam3&#39;</span>))
<a name="l00307"></a>00307         <span class="keyword">assert</span> testVal == apiSuccess(master.getParam(<span class="stringliteral">&#39;down3.node&#39;</span>, <span class="stringliteral">&#39;sub.dparam3&#39;</span>))
<a name="l00308"></a>00308         <span class="keyword">assert</span> testVal == apiSuccess(master.getParam(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;down3.sub.dparam3&#39;</span>))
<a name="l00309"></a>00309         <span class="keyword">assert</span> testVal == apiSuccess(master.getParam(<span class="stringliteral">&#39;down3.sub.sub2.node&#39;</span>, <span class="stringliteral">&#39;dparam3&#39;</span>))
<a name="l00310"></a>00310         <span class="keywordflow">if</span> HAS_PARAM:        
<a name="l00311"></a>00311             <span class="keyword">assert</span> <span class="keywordflow">not</span> apiSuccess(master.hasParam(<span class="stringliteral">&#39;down3.sub.node&#39;</span>, <span class="stringliteral">&#39;sub.dparam3&#39;</span>))
<a name="l00312"></a>00312             <span class="keyword">assert</span> <span class="keywordflow">not</span> apiSuccess(master.hasParam(<span class="stringliteral">&#39;down3.sub.node&#39;</span>, <span class="stringliteral">&#39;down3.sub.dparam3&#39;</span>))
<a name="l00313"></a>00313         apiError(master.getParam(<span class="stringliteral">&#39;down3.sub.node&#39;</span>, <span class="stringliteral">&#39;sub.dparam3&#39;</span>))
<a name="l00314"></a>00314         apiError(master.getParam(<span class="stringliteral">&#39;down3.sub.node&#39;</span>, <span class="stringliteral">&#39;down3.sub.dparam3&#39;</span>))
<a name="l00315"></a>00315         <a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">testParamState</a>(master, myState)
<a name="l00316"></a>00316 
<a name="l00317"></a>00317         <span class="comment"># test downwards deletion</span>
<a name="l00318"></a>00318         master.setParam(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;down4.sub.dparam4A&#39;</span>, testVal)
<a name="l00319"></a>00319         apiSuccess(master.deleteParam(<span class="stringliteral">&#39;down4.sub.node&#39;</span>, <span class="stringliteral">&#39;dparam4A&#39;</span>))
<a name="l00320"></a>00320         <span class="keywordflow">if</span> HAS_PARAM:        
<a name="l00321"></a>00321             <span class="keyword">assert</span> <span class="keywordflow">not</span> apiSuccess(master.hasParam(<span class="stringliteral">&#39;down4.sub&#39;</span>, <span class="stringliteral">&#39;dparam4A&#39;</span>))
<a name="l00322"></a>00322         master.setParam(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;down4.sub.dparam4B&#39;</span>, testVal)        
<a name="l00323"></a>00323         apiSuccess(master.deleteParam(<span class="stringliteral">&#39;down4.node&#39;</span>, <span class="stringliteral">&#39;sub.dparam4B&#39;</span>))
<a name="l00324"></a>00324         <span class="keywordflow">if</span> HAS_PARAM:        
<a name="l00325"></a>00325             <span class="keyword">assert</span> <span class="keywordflow">not</span> apiSuccess(master.hasParam(<span class="stringliteral">&#39;down4.sub&#39;</span>, <span class="stringliteral">&#39;dparam4B&#39;</span>))
<a name="l00326"></a>00326         master.setParam(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;down4.sub.dparam4C&#39;</span>, testVal)
<a name="l00327"></a>00327         apiSuccess(master.deleteParam(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;down4.sub.dparam4C&#39;</span>))
<a name="l00328"></a>00328         <span class="keywordflow">if</span> HAS_PARAM:        
<a name="l00329"></a>00329             <span class="keyword">assert</span> <span class="keywordflow">not</span> apiSuccess(master.hasParam(<span class="stringliteral">&#39;down4.sub.node&#39;</span>, <span class="stringliteral">&#39;dparam4C&#39;</span>))
<a name="l00330"></a>00330         <a class="code" href="namespacetest_1_1testMaster.html#a523fdb9f6f99709a1edd9a3bb7a4451b">testParamState</a>(master, myState)
<a name="l00331"></a>00331         
<a name="l00332"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html">00332</a> <span class="keyword">class </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html">MasterTestCase</a>(ROSGraphTestCase):
<a name="l00333"></a>00333     <span class="stringliteral">&quot;&quot;&quot;Master API Test Cases -- those not covered by ParamServer and AddKillNode&quot;&quot;&quot;</span>
<a name="l00334"></a>00334 
<a name="l00335"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a70dbb6be41c86d09e386cc0607c63e43">00335</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a70dbb6be41c86d09e386cc0607c63e43">setUp</a>(self):
<a name="l00336"></a>00336         super(MasterTestCase, self).<a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a70dbb6be41c86d09e386cc0607c63e43">setUp</a>()
<a name="l00337"></a>00337     
<a name="l00338"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a9c5ae2515684d278e5bcc453938c9d54">00338</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a9c5ae2515684d278e5bcc453938c9d54">tearDown</a>(self):
<a name="l00339"></a>00339         super(MasterTestCase, self).<a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a9c5ae2515684d278e5bcc453938c9d54">tearDown</a>() 
<a name="l00340"></a>00340 
<a name="l00341"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#ade0c1c85f663d2c9de2d0051398add66">00341</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#ade0c1c85f663d2c9de2d0051398add66">_verifyFlowNameState</a>(self, master, state):
<a name="l00342"></a>00342         flows = apiSuccess(master.getFlowNames(<span class="stringliteral">&#39;node1&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00343"></a>00343         <span class="keyword">assert</span> len(flows) == len(state.values()), <span class="stringliteral">&quot;Master reported a different number of flows&quot;</span>
<a name="l00344"></a>00344         <span class="keywordflow">for</span> val <span class="keywordflow">in</span> state.itervalues():
<a name="l00345"></a>00345             <span class="keyword">assert</span> val <span class="keywordflow">in</span> flows, <span class="stringliteral">&quot;flows does not contain %s : %s&quot;</span>%(val, flows)
<a name="l00346"></a>00346 
<a name="l00347"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a29d6f5d72617fda8d51a4716a3c267d4">00347</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a29d6f5d72617fda8d51a4716a3c267d4">testPromoteFlow</a>(self):
<a name="l00348"></a>00348         master = self.master
<a name="l00349"></a>00349         state = {}
<a name="l00350"></a>00350         callerId = <span class="stringliteral">&#39;node1&#39;</span>
<a name="l00351"></a>00351         type = <span class="stringliteral">&#39;common_flows/String&#39;</span>
<a name="l00352"></a>00352         <span class="comment">#setup node1 with outflows outflow1..3 and inflow1..3</span>
<a name="l00353"></a>00353         apiSuccess(master.registerNode(callerId, <span class="stringliteral">&#39;node1&#39;</span>, <span class="stringliteral">&#39;localhost&#39;</span>, 1234, []))
<a name="l00354"></a>00354         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1, 4):
<a name="l00355"></a>00355             <span class="keywordflow">for</span> dir <span class="keywordflow">in</span> [<span class="stringliteral">&#39;inflow&#39;</span>, <span class="stringliteral">&#39;outflow&#39;</span>]:
<a name="l00356"></a>00356                 locator = <span class="stringliteral">&#39;node1:%s%s&#39;</span>%(dir, i)
<a name="l00357"></a>00357                 apiSuccess(master.registerFlow(callerId, <span class="stringliteral">&#39;node1&#39;</span>, locator, dir, type))
<a name="l00358"></a>00358                 state[locator] = [locator, dir, type, 0]
<a name="l00359"></a>00359         
<a name="l00360"></a>00360         <span class="comment">#test promote of a non-existent flow</span>
<a name="l00361"></a>00361         apiError(master.promoteFlow(callerId, <span class="stringliteral">&#39;node1:notAFlow&#39;</span>, <span class="stringliteral">&#39;node1:newNotAFlow&#39;</span>))
<a name="l00362"></a>00362         <span class="comment"># - :outflow1 should resolve to parent, which is a non-existent flow</span>
<a name="l00363"></a>00363         apiError(master.promoteFlow(callerId, <span class="stringliteral">&#39;:outflow1&#39;</span>, <span class="stringliteral">&#39;node1:newNotAFlow&#39;</span>))        
<a name="l00364"></a>00364 
<a name="l00365"></a>00365         <span class="comment">## Play with Outflows</span>
<a name="l00366"></a>00366         <span class="comment">#successfully promote outflow1 to global namespace</span>
<a name="l00367"></a>00367         dir = <span class="stringliteral">&#39;outflow&#39;</span>
<a name="l00368"></a>00368         apiSuccess(master.promoteFlow(callerId, <span class="stringliteral">&#39;node1:outflow1&#39;</span>, <span class="stringliteral">&#39;:outflow1&#39;</span>))
<a name="l00369"></a>00369         state[<span class="stringliteral">&#39;:outflow1&#39;</span>] = [<span class="stringliteral">&#39;:outflow1&#39;</span>, dir, type, 1]        
<a name="l00370"></a>00370         <span class="comment"># - verify with .local syntax</span>
<a name="l00371"></a>00371         apiSuccess(master.promoteFlow(callerId, <span class="stringliteral">&#39;.:outflow2&#39;</span>, <span class="stringliteral">&#39;:outflow2&#39;</span>))        
<a name="l00372"></a>00372         state[<span class="stringliteral">&#39;:outflow2&#39;</span>] = [<span class="stringliteral">&#39;:outflow2&#39;</span>, dir, type, 1]
<a name="l00373"></a>00373 
<a name="l00374"></a>00374         <span class="comment">## Play with Inflows</span>
<a name="l00375"></a>00375         <span class="comment">#successfully promote inflow1 to the same namespace</span>
<a name="l00376"></a>00376         dir = <span class="stringliteral">&#39;inflow&#39;</span>
<a name="l00377"></a>00377         tests = [
<a name="l00378"></a>00378             [<span class="stringliteral">&#39;node1:inflow1&#39;</span>,  <span class="stringliteral">&#39;node1:newInflow1&#39;</span>],
<a name="l00379"></a>00379             [<span class="stringliteral">&#39;node1:inflow2&#39;</span>, <span class="stringliteral">&#39;sibling:inflow2&#39;</span>],
<a name="l00380"></a>00380             [<span class="stringliteral">&#39;node1:inflow3&#39;</span>, <span class="stringliteral">&#39;node1:subgraph1:inflow3&#39;</span>]
<a name="l00381"></a>00381             ]
<a name="l00382"></a>00382         <span class="keywordflow">for</span> source, target <span class="keywordflow">in</span> tests:
<a name="l00383"></a>00383             apiSuccess(master.promoteFlow(callerId, source, target))
<a name="l00384"></a>00384             state[target] = [target, dir, type, 1]
<a name="l00385"></a>00385         
<a name="l00386"></a>00386         self.<a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#ade0c1c85f663d2c9de2d0051398add66">_verifyFlowNameState</a>(master, state)
<a name="l00387"></a>00387 
<a name="l00388"></a>00388         <span class="comment">#TODO: test promotion to an already promoted/registered flow name</span>
<a name="l00389"></a>00389         apiError(master.promoteFlow(callerId, <span class="stringliteral">&#39;node1:outflow1&#39;</span>, <span class="stringliteral">&#39;node1:outflow2&#39;</span>))
<a name="l00390"></a>00390         apiError(master.promoteFlow(callerId, <span class="stringliteral">&#39;node1:outflow2&#39;</span>, <span class="stringliteral">&#39;:outflow1&#39;</span>))
<a name="l00391"></a>00391         apiError(master.promoteFlow(callerId, <span class="stringliteral">&#39;node1:inflow1&#39;</span>, <span class="stringliteral">&#39;sibling:inflow2&#39;</span>))        
<a name="l00392"></a>00392 
<a name="l00393"></a>00393         <span class="comment">#TODO: test promote of a promoted flow</span>
<a name="l00394"></a>00394         <span class="comment">#TODO: test promote with both :flow and .:flow</span>
<a name="l00395"></a>00395         <span class="comment">#TODO: test name resolution with subgraphs and callerIds better</span>
<a name="l00396"></a>00396     
<a name="l00397"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a1ae6e5158ea1d72c759563f4a83a1651">00397</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a1ae6e5158ea1d72c759563f4a83a1651">testRegisterFlow</a>(self):
<a name="l00398"></a>00398         master = self.master
<a name="l00399"></a>00399         state = {}
<a name="l00400"></a>00400         type = <span class="stringliteral">&#39;common_flows/String&#39;</span>
<a name="l00401"></a>00401         <span class="keywordflow">for</span> callerId <span class="keywordflow">in</span> [<span class="stringliteral">&#39;node1&#39;</span>, <span class="stringliteral">&#39;subgraph.node1&#39;</span>, <span class="stringliteral">&#39;grandparent.parent.node1&#39;</span>]:
<a name="l00402"></a>00402             <span class="comment">#setup node1 with outflows outflow1..3 and inflow1..3</span>
<a name="l00403"></a>00403             apiSuccess(master.registerNode(callerId, <span class="stringliteral">&#39;node1&#39;</span>, <span class="stringliteral">&#39;localhost&#39;</span>, 1234, []))
<a name="l00404"></a>00404             <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1, 4):
<a name="l00405"></a>00405                 <span class="keywordflow">for</span> dir <span class="keywordflow">in</span> [<span class="stringliteral">&#39;inflow&#39;</span>, <span class="stringliteral">&#39;outflow&#39;</span>]:
<a name="l00406"></a>00406                     <span class="keywordflow">if</span> dir == <span class="stringliteral">&#39;inflow&#39;</span>:
<a name="l00407"></a>00407                         locator = <span class="stringliteral">&#39;node1:%s%s&#39;</span>%(dir, i)
<a name="l00408"></a>00408                     <span class="keywordflow">else</span>:
<a name="l00409"></a>00409                         locator = <span class="stringliteral">&#39;.:%s%s&#39;</span>%(dir, i) <span class="comment">#test .local resolution</span>
<a name="l00410"></a>00410                     apiSuccess(master.registerFlow(callerId, <span class="stringliteral">&#39;node1&#39;</span>, locator, dir, type))
<a name="l00411"></a>00411                     realLocator = <span class="stringliteral">&#39;%s:%s%s&#39;</span>%(callerId, dir, i)
<a name="l00412"></a>00412                     state[realLocator] = [realLocator, dir, type, 0]
<a name="l00413"></a>00413             <span class="comment">#test register on a non-existent node</span>
<a name="l00414"></a>00414             apiError(master.registerFlow(callerId, <span class="stringliteral">&#39;notNode&#39;</span>, <span class="stringliteral">&#39;notANode:outflow&#39;</span>, <span class="stringliteral">&#39;outflow&#39;</span>, type))
<a name="l00415"></a>00415             <span class="comment">#test register on bad locators</span>
<a name="l00416"></a>00416             apiError(master.registerFlow(callerId, <span class="stringliteral">&#39;node1&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;outflow&#39;</span>, type))
<a name="l00417"></a>00417             apiError(master.registerFlow(callerId, <span class="stringliteral">&#39;node1&#39;</span>, <span class="stringliteral">&#39;badflow1&#39;</span>, <span class="stringliteral">&#39;outflow&#39;</span>, type))            
<a name="l00418"></a>00418             <span class="comment">#test register on a bad direction</span>
<a name="l00419"></a>00419             apiError(master.registerFlow(callerId, <span class="stringliteral">&#39;node1&#39;</span>, <span class="stringliteral">&#39;node1:badflow2&#39;</span>, <span class="stringliteral">&#39;spiralflow&#39;</span>, type))
<a name="l00420"></a>00420             <span class="comment">#test register on invalid types</span>
<a name="l00421"></a>00421             apiError(master.registerFlow(callerId, <span class="stringliteral">&#39;node1&#39;</span>, <span class="stringliteral">&#39;node1:badflow3&#39;</span>, <span class="stringliteral">&#39;outflow&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00422"></a>00422             apiError(master.registerFlow(callerId, <span class="stringliteral">&#39;node1&#39;</span>, <span class="stringliteral">&#39;node1:badflow4&#39;</span>, <span class="stringliteral">&#39;outflow&#39;</span>, <span class="stringliteral">&#39;faketype&#39;</span>))
<a name="l00423"></a>00423 
<a name="l00424"></a>00424             <span class="comment">#test register to an already promoted/registered flow name</span>
<a name="l00425"></a>00425             apiError(master.registerFlow(callerId, <span class="stringliteral">&#39;node1&#39;</span>, <span class="stringliteral">&#39;node1:outflow1&#39;</span>, <span class="stringliteral">&#39;outflow&#39;</span>, type))
<a name="l00426"></a>00426             apiSuccess(master.promoteFlow(callerId, <span class="stringliteral">&#39;node1:outflow1&#39;</span>, <span class="stringliteral">&#39;node1:newOutflow1&#39;</span>))
<a name="l00427"></a>00427             state[<span class="stringliteral">&#39;%s:newOutflow1&#39;</span>%callerId] = [<span class="stringliteral">&#39;node1:newOutflow1&#39;</span>, dir, type, 1]            
<a name="l00428"></a>00428             apiError(master.registerFlow(callerId, <span class="stringliteral">&#39;node1&#39;</span>, <span class="stringliteral">&#39;node1:newOutflow1&#39;</span>, <span class="stringliteral">&#39;outflow&#39;</span>, type))
<a name="l00429"></a>00429 
<a name="l00430"></a>00430             self.<a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#ade0c1c85f663d2c9de2d0051398add66">_verifyFlowNameState</a>(master, state)
<a name="l00431"></a>00431 
<a name="l00432"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#afb87f30bb0e1cf1dd59780a791562412">00432</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#afb87f30bb0e1cf1dd59780a791562412">testUnregisterFlow</a>(self):
<a name="l00433"></a>00433         master = self.master
<a name="l00434"></a>00434         state = {}
<a name="l00435"></a>00435         type = <span class="stringliteral">&#39;common_flows/String&#39;</span>
<a name="l00436"></a>00436         <span class="keywordflow">for</span> callerId <span class="keywordflow">in</span> [<span class="stringliteral">&#39;node1&#39;</span>, <span class="stringliteral">&#39;subgraph.node1&#39;</span>, <span class="stringliteral">&#39;grandparent.parent.node1&#39;</span>]:
<a name="l00437"></a>00437             <span class="comment">#setup node1 with outflows outflow1..3 and inflow1..3</span>
<a name="l00438"></a>00438             apiSuccess(master.registerNode(callerId, <span class="stringliteral">&#39;node1&#39;</span>, <span class="stringliteral">&#39;localhost&#39;</span>, 1234, []))
<a name="l00439"></a>00439             <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1, 4):
<a name="l00440"></a>00440                 <span class="keywordflow">for</span> dir <span class="keywordflow">in</span> [<span class="stringliteral">&#39;inflow&#39;</span>, <span class="stringliteral">&#39;outflow&#39;</span>]:
<a name="l00441"></a>00441                     <span class="keywordflow">if</span> dir == <span class="stringliteral">&#39;inflow&#39;</span>:
<a name="l00442"></a>00442                         locator = rlocator = <span class="stringliteral">&#39;node1:%s%s&#39;</span>%(dir, i)
<a name="l00443"></a>00443                     <span class="keywordflow">else</span>:
<a name="l00444"></a>00444                         locator = <span class="stringliteral">&#39;.:%s%s&#39;</span>%(dir, i) <span class="comment">#test .local resolution</span>
<a name="l00445"></a>00445                         rlocator = <span class="stringliteral">&#39;node1:%s%s&#39;</span>%(dir, i) <span class="comment">#test .local resolution</span>
<a name="l00446"></a>00446                     apiSuccess(master.registerFlow(callerId, <span class="stringliteral">&#39;node1&#39;</span>, locator, dir, type))
<a name="l00447"></a>00447                     realLocator = <span class="stringliteral">&#39;%s:%s%s&#39;</span>%(callerId, dir, i)
<a name="l00448"></a>00448                     state[realLocator] = [realLocator, dir, type, 0]
<a name="l00449"></a>00449 
<a name="l00450"></a>00450             self.<a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#ade0c1c85f663d2c9de2d0051398add66">_verifyFlowNameState</a>(master, state)
<a name="l00451"></a>00451             
<a name="l00452"></a>00452             <span class="comment">#test bad unregisters</span>
<a name="l00453"></a>00453             apiError(master.unregisterFlow(callerId, <span class="stringliteral">&#39;notANode:outflow&#39;</span>))
<a name="l00454"></a>00454             apiError(master.unregisterFlow(callerId, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00455"></a>00455             apiError(master.unregisterFlow(callerId.replace(<span class="stringliteral">&#39;node1&#39;</span>, <span class="stringliteral">&#39;node2&#39;</span>), <span class="stringliteral">&#39;outflow1&#39;</span>))
<a name="l00456"></a>00456 
<a name="l00457"></a>00457             apiSuccess(master.unregisterFlow(callerId, <span class="stringliteral">&#39;node1:outflow1&#39;</span>))
<a name="l00458"></a>00458             del state[<span class="stringliteral">&#39;%s:outflow1&#39;</span>%callerId]
<a name="l00459"></a>00459             apiSuccess(master.unregisterFlow(callerId, <span class="stringliteral">&#39;.:outflow2&#39;</span>))
<a name="l00460"></a>00460             del state[<span class="stringliteral">&#39;%s:outflow2&#39;</span>%callerId]            
<a name="l00461"></a>00461             apiSuccess(master.unregisterFlow(callerId.replace(<span class="stringliteral">&#39;node1&#39;</span>, <span class="stringliteral">&#39;node2&#39;</span>), <span class="stringliteral">&#39;node1:outflow3&#39;</span>))
<a name="l00462"></a>00462             del state[<span class="stringliteral">&#39;%s:outflow3&#39;</span>%callerId]             
<a name="l00463"></a>00463             apiSuccess(master.unregisterFlow(<span class="stringliteral">&#39;master&#39;</span>, <span class="stringliteral">&#39;%s:inflow1&#39;</span>%callerId))
<a name="l00464"></a>00464             del state[<span class="stringliteral">&#39;%s:inflow1&#39;</span>%callerId]
<a name="l00465"></a>00465 
<a name="l00466"></a>00466             self.<a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#ade0c1c85f663d2c9de2d0051398add66">_verifyFlowNameState</a>(master, state)
<a name="l00467"></a>00467             
<a name="l00468"></a>00468             <span class="comment">#test register to an already unregistered flow</span>
<a name="l00469"></a>00469             apiError(master.unregisterFlow(callerId, <span class="stringliteral">&#39;node1:outflow1&#39;</span>))
<a name="l00470"></a>00470 
<a name="l00471"></a>00471             <span class="comment">#test transitive unregisters</span>
<a name="l00472"></a>00472             apiSuccess(master.promoteFlow(callerId, <span class="stringliteral">&#39;node1:inflow3&#39;</span>, <span class="stringliteral">&#39;:inflow3A&#39;</span>))
<a name="l00473"></a>00473             apiSuccess(master.promoteFlow(callerId, <span class="stringliteral">&#39;:inflow3A&#39;</span>, <span class="stringliteral">&#39;:inflow3B&#39;</span>))
<a name="l00474"></a>00474             <span class="comment"># - should unregister both 3A and 3B</span>
<a name="l00475"></a>00475             apiSuccess(master.unregisterFlow(callerId, <span class="stringliteral">&#39;node1:inflow3&#39;</span>))
<a name="l00476"></a>00476             del state[<span class="stringliteral">&#39;%s:inflow3&#39;</span>%callerId]
<a name="l00477"></a>00477             
<a name="l00478"></a>00478             self.<a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#ade0c1c85f663d2c9de2d0051398add66">_verifyFlowNameState</a>(master, state)
<a name="l00479"></a>00479     
<a name="l00480"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a0de895c94176a9184cd13309bb2b0004">00480</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a0de895c94176a9184cd13309bb2b0004">testGetFlowNames</a>(self):
<a name="l00481"></a>00481         master = self.master
<a name="l00482"></a>00482         pkg,node = testNode
<a name="l00483"></a>00483         subgraph = <span class="stringliteral">&#39;sub1.sub2&#39;</span>
<a name="l00484"></a>00484         name = <span class="stringliteral">&#39;testGFN_A&#39;</span>
<a name="l00485"></a>00485         port = apiSuccess(master.addNode(<span class="stringliteral">&#39;caller&#39;</span>, subgraph, name, pkg, node, TEST_MACHINE, 0))        
<a name="l00486"></a>00486         <span class="comment">#testNode must have :in and :out</span>
<a name="l00487"></a>00487         <span class="comment">#:in and :out</span>
<a name="l00488"></a>00488         testFlowNames = [<span class="stringliteral">&quot;%s:%s&quot;</span>%(name, v) <span class="keywordflow">for</span> v <span class="keywordflow">in</span> [<span class="stringliteral">&quot;in&quot;</span>, <span class="stringliteral">&quot;out&quot;</span>]]
<a name="l00489"></a>00489         <span class="keywordflow">print</span> <span class="stringliteral">&quot;FLOW NAMES&quot;</span>, apiSuccess(master.getFlowNames(<span class="stringliteral">&#39;master&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))        
<a name="l00490"></a>00490         flows = apiSuccess(master.getFlowNames(<span class="stringliteral">&#39;%s.caller&#39;</span>%subgraph, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00491"></a>00491         <span class="keyword">assert</span> <span class="keywordflow">not</span> set([x[0] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> flows]) ^ set(testFlowNames), <span class="stringliteral">&quot;%s vs. %s&quot;</span>%([x[0] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> flows], testFlowNames)
<a name="l00492"></a>00492         
<a name="l00493"></a>00493         inDirs = [x[1] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> flows <span class="keywordflow">if</span> x[0].endswith(<span class="stringliteral">&#39;:in&#39;</span>)]
<a name="l00494"></a>00494         outDirs = [x[1] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> flows <span class="keywordflow">if</span> x[0].endswith(<span class="stringliteral">&#39;:out&#39;</span>)]        
<a name="l00495"></a>00495         <span class="keyword">assert</span> <span class="keywordflow">not</span> filter(<span class="keyword">lambda</span> x: x != <span class="stringliteral">&quot;inflow&quot;</span>, inDirs), inDirs
<a name="l00496"></a>00496         <span class="keyword">assert</span> <span class="keywordflow">not</span> filter(<span class="keyword">lambda</span> x: x != <span class="stringliteral">&quot;outflow&quot;</span>, outDirs), outDirs
<a name="l00497"></a>00497         <span class="keyword">assert</span> <span class="keywordflow">not</span> filter(<span class="keyword">lambda</span> x: x != <span class="stringliteral">&quot;common_flows/String&quot;</span>, [x[2] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> flows]) <span class="comment">#all flow types should be String</span>
<a name="l00498"></a>00498         <span class="keyword">assert</span> <span class="keywordflow">not</span> filter(<span class="keyword">lambda</span> x: x, [x[3] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> flows]) <span class="comment">#promoted flag should all be zero</span>
<a name="l00499"></a>00499 
<a name="l00500"></a>00500         <span class="comment">#test callerId scoping and subgraph parameter</span>
<a name="l00501"></a>00501         testFlowNames = [<span class="stringliteral">&quot;%s.%s:%s&quot;</span>%(subgraph, name, v) <span class="keywordflow">for</span> v <span class="keywordflow">in</span> [<span class="stringliteral">&quot;in&quot;</span>, <span class="stringliteral">&quot;out&quot;</span>]]        
<a name="l00502"></a>00502         flows = apiSuccess(master.getFlowNames(<span class="stringliteral">&#39;caller&#39;</span>, subgraph))
<a name="l00503"></a>00503         <span class="keyword">assert</span> <span class="keywordflow">not</span> set([x[0] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> flows]) ^ set(testFlowNames), <span class="stringliteral">&quot;%s vs. %s&quot;</span>%([x[0] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> flows], testFlowNames)
<a name="l00504"></a>00504         flows = apiSuccess(master.getFlowNames(<span class="stringliteral">&#39;caller&#39;</span>, <span class="stringliteral">&quot;%s.%s&quot;</span>%(subgraph, name)))
<a name="l00505"></a>00505         <span class="keyword">assert</span> <span class="keywordflow">not</span> set([x[0] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> flows]) ^ set(testFlowNames), <span class="stringliteral">&quot;%s vs. %s&quot;</span>%([x[0] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> flows], testFlowNames)
<a name="l00506"></a>00506 
<a name="l00507"></a>00507         testFlowNames = [<span class="stringliteral">&quot;sub2.%s:%s&quot;</span>%(name, v) <span class="keywordflow">for</span> v <span class="keywordflow">in</span> [<span class="stringliteral">&quot;in&quot;</span>, <span class="stringliteral">&quot;out&quot;</span>]]        
<a name="l00508"></a>00508         flows = apiSuccess(master.getFlowNames(<span class="stringliteral">&#39;sub1.caller&#39;</span>, <span class="stringliteral">&#39;sub2&#39;</span>))
<a name="l00509"></a>00509         <span class="keyword">assert</span> <span class="keywordflow">not</span> set([x[0] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> flows]) ^ set(testFlowNames), <span class="stringliteral">&quot;%s vs. %s&quot;</span>%([x[0] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> flows], testFlowNames)
<a name="l00510"></a>00510         
<a name="l00511"></a>00511 
<a name="l00512"></a>00512         testFlowNames = [<span class="stringliteral">&quot;%s.%s:%s&quot;</span>%(subgraph, name, v) <span class="keywordflow">for</span> v <span class="keywordflow">in</span> [<span class="stringliteral">&quot;in&quot;</span>, <span class="stringliteral">&quot;out&quot;</span>]]        
<a name="l00513"></a>00513         flows = apiSuccess(master.getFlowNames(<span class="stringliteral">&#39;caller&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00514"></a>00514         flowNames = [x[0] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> flows]
<a name="l00515"></a>00515         <span class="keyword">assert</span> <span class="keywordflow">not</span> set(flowNames) ^ set(testFlowNames)
<a name="l00516"></a>00516 
<a name="l00517"></a>00517     
<a name="l00518"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a2a28209fd187e4aad8cfb18d203a1ec1">00518</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a2a28209fd187e4aad8cfb18d203a1ec1">testGetNodeAddress</a>(self):
<a name="l00519"></a>00519         <span class="keyword">def </span>validate(val, callerId, name, port):
<a name="l00520"></a>00520             <span class="keyword">assert</span> len(val) == 3, <span class="stringliteral">&quot;getNodeAddress did not return 3-element list for value field&quot;</span>
<a name="l00521"></a>00521             <span class="keyword">assert</span> type(val[0]) == str <span class="keywordflow">and</span> type(val[1]) == str <span class="keywordflow">and</span> type(val[2]) == int,\
<a name="l00522"></a>00522                    <span class="stringliteral">&quot;getNodeAddress did not return (str, str, int) for value field&quot;</span>
<a name="l00523"></a>00523             <a class="code" href="namespacetest_1_1testMaster.html#aca320cc1080a5e92d25935cd502e4008">verifyNodeAddress</a>(master, callerId, name, TEST_MACHINE, <span class="stringliteral">&#39;localhost&#39;</span>, port)
<a name="l00524"></a>00524         
<a name="l00525"></a>00525         <span class="comment">#NOTE: this does not do full coverage on rospy, as many of the branch</span>
<a name="l00526"></a>00526         <span class="comment">#conditions in rospy are inaccessible via external call (they required</span>
<a name="l00527"></a>00527         <span class="comment">#corrupted data to be inserted into the master, which registerNode prevents)</span>
<a name="l00528"></a>00528 
<a name="l00529"></a>00529         master = self.master
<a name="l00530"></a>00530         <span class="comment">#test that invalid case still meets type spec</span>
<a name="l00531"></a>00531         code, msg, val = master.getNodeAddress(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;testGetNodeAddress-fake&#39;</span>)
<a name="l00532"></a>00532         <span class="keyword">assert</span> code == -1, <span class="stringliteral">&quot;getNodeAddress did not return failure code 0 for non-existent node&quot;</span>
<a name="l00533"></a>00533         <span class="keyword">assert</span> len(val) == 3, <span class="stringliteral">&quot;getNodeAddress did not return 3-element list for value field in error case&quot;</span>
<a name="l00534"></a>00534         <span class="keyword">assert</span> type(val[0]) == str <span class="keywordflow">and</span> type(val[1]) == str <span class="keywordflow">and</span> type(val[2]) == int,\
<a name="l00535"></a>00535                <span class="stringliteral">&quot;getNodeAddress did not return (str, str, int) for value field in error case&quot;</span>
<a name="l00536"></a>00536 
<a name="l00537"></a>00537         <span class="comment">#start a node to test valid case against</span>
<a name="l00538"></a>00538         name = <span class="stringliteral">&#39;testGetNodeAddress-1&#39;</span>
<a name="l00539"></a>00539         port = 7981
<a name="l00540"></a>00540         pkg, node = testNode
<a name="l00541"></a>00541         apiSuccess(master.addNode(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, name, pkg, node, TEST_MACHINE, port))
<a name="l00542"></a>00542         val = apiSuccess(master.getNodeAddress(<span class="stringliteral">&#39;&#39;</span>, name))
<a name="l00543"></a>00543         validate(val, <span class="stringliteral">&#39;&#39;</span>, name, port)
<a name="l00544"></a>00544 
<a name="l00545"></a>00545         <span class="comment">#verify Graph Resource Name scoping rules</span>
<a name="l00546"></a>00546         name = <span class="stringliteral">&#39;testGetNodeAddress-2&#39;</span>
<a name="l00547"></a>00547         port = 7982
<a name="l00548"></a>00548         apiSuccess(master.addNode(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;gna1.gna2&#39;</span>, name, pkg, node, TEST_MACHINE, port))
<a name="l00549"></a>00549         <span class="comment">#make sure we have a node</span>
<a name="l00550"></a>00550         tests = [
<a name="l00551"></a>00551             <span class="comment">#test exact name matches</span>
<a name="l00552"></a>00552             [<span class="stringliteral">&#39;gna1.gna2.node&#39;</span>, name],
<a name="l00553"></a>00553             [<span class="stringliteral">&#39;gna1.node&#39;</span>, <span class="stringliteral">&#39;gna2.%s&#39;</span>%name],
<a name="l00554"></a>00554             [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;gna1.gna2.%s&#39;</span>%name],
<a name="l00555"></a>00555             <span class="comment">#make sure that gNA searches upwards </span>
<a name="l00556"></a>00556             [<span class="stringliteral">&#39;gna1.gna2.gna3.node&#39;</span>, name],
<a name="l00557"></a>00557             ]
<a name="l00558"></a>00558         <span class="keywordflow">for</span> test <span class="keywordflow">in</span> tests:
<a name="l00559"></a>00559             callerId, name = test
<a name="l00560"></a>00560             validate(apiSuccess(master.getNodeAddress(callerId, name)), callerId, name, port)
<a name="l00561"></a>00561         
<a name="l00562"></a>00562         <span class="comment">#make sure that it gNA doesn&#39;t search upwards when subcontext is specified</span>
<a name="l00563"></a>00563         val = apiError(master.getNodeAddress(<span class="stringliteral">&#39;gna1.gna2&#39;</span>, <span class="stringliteral">&#39;gna3.%s&#39;</span>%name))
<a name="l00564"></a>00564 
<a name="l00565"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a241c49c8862b23b7ad53f80d46b4405a">00565</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a241c49c8862b23b7ad53f80d46b4405a">_verifyNodeDead</a>(self, port):
<a name="l00566"></a>00566         testUri = <span class="stringliteral">&quot;http://localhost:%s/&quot;</span>%port
<a name="l00567"></a>00567         <span class="keywordflow">try</span>:
<a name="l00568"></a>00568             xmlrpclib.ServerProxy(testUri).getPid(<span class="stringliteral">&#39;node&#39;</span>)
<a name="l00569"></a>00569             self.fail(<span class="stringliteral">&quot;test node is still running&quot;</span>)
<a name="l00570"></a>00570         <span class="keywordflow">except</span>:
<a name="l00571"></a>00571             <span class="keywordflow">pass</span>
<a name="l00572"></a>00572         
<a name="l00573"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a14295500c38e08120e22776662daf364">00573</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a14295500c38e08120e22776662daf364">testAddKillNode</a>(self):
<a name="l00574"></a>00574         <span class="stringliteral">&quot;&quot;&quot;testAddKillNode: test adding then killing nodes&quot;&quot;&quot;</span>
<a name="l00575"></a>00575         <span class="comment">#TODO: more test cases</span>
<a name="l00576"></a>00576         master = self.master
<a name="l00577"></a>00577         pkg,node = testNode        
<a name="l00578"></a>00578         apiError(master.killNode(<span class="stringliteral">&#39;node&#39;</span>,<span class="stringliteral">&#39;nonexistentNode&#39;</span>))
<a name="l00579"></a>00579         name = <span class="stringliteral">&#39;testAddKillA&#39;</span>
<a name="l00580"></a>00580         port = apiSuccess(master.addNode(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;subgraph&#39;</span>, name, pkg, node, TEST_MACHINE, 0))
<a name="l00581"></a>00581         <span class="comment"># - doesn&#39;t traverse across        </span>
<a name="l00582"></a>00582         apiError(master.killNode(<span class="stringliteral">&#39;different.subgraph.node&#39;</span>, name))
<a name="l00583"></a>00583         <span class="comment"># - doesn&#39;t traverse down</span>
<a name="l00584"></a>00584         apiError(master.killNode(<span class="stringliteral">&#39;node&#39;</span>, name))
<a name="l00585"></a>00585         <span class="comment"># - doesn&#39;t traverse up        </span>
<a name="l00586"></a>00586         apiError(master.killNode(<span class="stringliteral">&#39;subgraph.sub2.node&#39;</span>, name))
<a name="l00587"></a>00587         <span class="comment"># - kill it</span>
<a name="l00588"></a>00588         apiSuccess(master.killNode(<span class="stringliteral">&#39;subgraph.node&#39;</span>, name))
<a name="l00589"></a>00589 
<a name="l00590"></a>00590         <span class="comment"># - push on the name resolution a bit</span>
<a name="l00591"></a>00591         tests = [[<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;testAddKillB&#39;</span>],
<a name="l00592"></a>00592                  [<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;g1.g2&#39;</span>, <span class="stringliteral">&#39;testAddKillB&#39;</span>],
<a name="l00593"></a>00593                  [<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;g1&#39;</span>, <span class="stringliteral">&#39;testAddKillB&#39;</span>],
<a name="l00594"></a>00594                  [<span class="stringliteral">&#39;g1.g2.node&#39;</span>, <span class="stringliteral">&#39;g3&#39;</span>, <span class="stringliteral">&#39;testAddKillB&#39;</span>],
<a name="l00595"></a>00595                  ]
<a name="l00596"></a>00596         <span class="keywordflow">for</span> callerId, subcontext, nodeName <span class="keywordflow">in</span> tests:
<a name="l00597"></a>00597             port = apiSuccess(master.addNode(callerId, subcontext, nodeName, pkg, node, TEST_MACHINE, 0))
<a name="l00598"></a>00598             <span class="keywordflow">if</span> subcontext:
<a name="l00599"></a>00599                 name = <span class="stringliteral">&quot;%s.%s&quot;</span>%(subcontext, nodeName)
<a name="l00600"></a>00600             <span class="keywordflow">else</span>:
<a name="l00601"></a>00601                 name = nodeName
<a name="l00602"></a>00602             apiSuccess(master.killNode(callerId, name))
<a name="l00603"></a>00603             self.<a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a241c49c8862b23b7ad53f80d46b4405a">_verifyNodeDead</a>(port)
<a name="l00604"></a>00604 
<a name="l00605"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a8a4fa3133a10eccd949485f5e3eef8f0">00605</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a8a4fa3133a10eccd949485f5e3eef8f0">testAddNode</a>(self):
<a name="l00606"></a>00606         <span class="stringliteral">&quot;&quot;&quot;testAddNode: test master.addNode(callerId, subcontext, name, pkg, pkgNode, machine, port)&quot;&quot;&quot;</span>
<a name="l00607"></a>00607         master = self.master
<a name="l00608"></a>00608         graphNodes = [<span class="stringliteral">&#39;master&#39;</span>]
<a name="l00609"></a>00609         graphFlows = []
<a name="l00610"></a>00610         <span class="comment"># Failure cases</span>
<a name="l00611"></a>00611         pkg, node = testNode
<a name="l00612"></a>00612         errors = [
<a name="l00613"></a>00613             <span class="comment"># - subcontext</span>
<a name="l00614"></a>00614             [<span class="stringliteral">&#39;&#39;</span>, 12, <span class="stringliteral">&#39;testAddNodeError1&#39;</span>, pkg, node, TEST_MACHINE, 0],
<a name="l00615"></a>00615             <span class="comment">#name</span>
<a name="l00616"></a>00616             [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, 123,                pkg, node, TEST_MACHINE, 0],
<a name="l00617"></a>00617             <span class="comment"># - invalid package implementation type</span>
<a name="l00618"></a>00618             [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;testAddNodeError2&#39;</span>, 123,         node, TEST_MACHINE, 0],
<a name="l00619"></a>00619             <span class="comment"># - node impl name</span>
<a name="l00620"></a>00620             [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;testAddNodeError3&#39;</span>, pkg, <span class="stringliteral">&#39;&#39;</span>,       TEST_MACHINE, 0],
<a name="l00621"></a>00621             [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;testAddNodeError4&#39;</span>, pkg, 123,      TEST_MACHINE, 0],
<a name="l00622"></a>00622             <span class="comment"># - machine parameter</span>
<a name="l00623"></a>00623             [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;testAddNodeError6&#39;</span>, pkg, node, <span class="stringliteral">&#39;unknown&#39;</span>, 0],
<a name="l00624"></a>00624             [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;testAddNodeError7&#39;</span>, pkg, <span class="stringliteral">&#39;noNode&#39;</span>, 123, 0],
<a name="l00625"></a>00625             <span class="comment"># - port</span>
<a name="l00626"></a>00626             [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;testAddNodeError8&#39;</span>, pkg, node, TEST_MACHINE, -80],
<a name="l00627"></a>00627             [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;testAddNodeError9&#39;</span>, pkg, node, TEST_MACHINE, <span class="stringliteral">&quot;80&quot;</span>],
<a name="l00628"></a>00628             ]
<a name="l00629"></a>00629         <span class="keywordflow">for</span> args <span class="keywordflow">in</span> errors:
<a name="l00630"></a>00630             <span class="keywordflow">try</span>:
<a name="l00631"></a>00631                 apiError(master.addNode(*args))
<a name="l00632"></a>00632             <span class="keywordflow">except</span> Exception, e:
<a name="l00633"></a>00633                 self.fail(<span class="stringliteral">&quot;addNodeError case failed with args[%s] and exception [%s]&quot;</span>%(args, e))
<a name="l00634"></a>00634         <span class="comment"># - non-existent node implementation (this takes awhile)</span>
<a name="l00635"></a>00635         apiFail(master.addNode(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;testAddNodeFail1&#39;</span>, pkg, <span class="stringliteral">&#39;notANode&#39;</span>, TEST_MACHINE, 0))
<a name="l00636"></a>00636 
<a name="l00637"></a>00637         <a class="code" href="namespacetest_1_1testMaster.html#a89b54e8c6edb3f125f6e2c87d180123c">testGraphState</a>(master, graphNodes, graphFlows)
<a name="l00638"></a>00638         tests = [[[<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;testAddNode1&#39;</span>], [TEST_MACHINE, 7980]],
<a name="l00639"></a>00639                  [[<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;testAddNode2&#39;</span>], [TEST_MACHINE, 0]],
<a name="l00640"></a>00640                  [[<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;testAddNode3&#39;</span>], [<span class="stringliteral">&#39;&#39;</span>, 0]],
<a name="l00641"></a>00641                  [[<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;testAddNode4&#39;</span>], [TEST_MACHINE, 0]],
<a name="l00642"></a>00642                  [[<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;testAddNode5&#39;</span>], [TEST_MACHINE, 0]],
<a name="l00643"></a>00643                  [[<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;testAddNode6&#39;</span>], [TEST_MACHINE, 0]],
<a name="l00644"></a>00644                  [[<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;testAddNode7&#39;</span>], [TEST_MACHINE, 0]],
<a name="l00645"></a>00645                  <span class="comment"># subcontext</span>
<a name="l00646"></a>00646                  [[<span class="stringliteral">&#39;push&#39;</span>,                <span class="stringliteral">&#39;testAddNode8&#39;</span>], [TEST_MACHINE, 0]],
<a name="l00647"></a>00647                  [[<span class="stringliteral">&#39;push.one.two&#39;</span>,        <span class="stringliteral">&#39;testAddNode9&#39;</span>], [TEST_MACHINE, 0]],
<a name="l00648"></a>00648                  [[<span class="stringliteral">&#39;stanford.addNodeTest&#39;</span>,<span class="stringliteral">&#39;testAddNodeA&#39;</span>], [TEST_MACHINE, 0]],
<a name="l00649"></a>00649                  [[<span class="stringliteral">&#39;wg.addNodeTest&#39;</span>,      <span class="stringliteral">&#39;testAddNodeA&#39;</span>], [TEST_MACHINE, 0]],
<a name="l00650"></a>00650                  ]
<a name="l00651"></a>00651         <span class="keywordflow">for</span> fullname, args <span class="keywordflow">in</span> tests:
<a name="l00652"></a>00652             <span class="keywordflow">print</span> <span class="stringliteral">&quot;testAddNode: testing&quot;</span>, fullname
<a name="l00653"></a>00653             subcontext, name = fullname
<a name="l00654"></a>00654             <span class="keywordflow">if</span> subcontext:
<a name="l00655"></a>00655                 fullname = <span class="stringliteral">&#39;%s.%s&#39;</span>%(subcontext, name)
<a name="l00656"></a>00656             <span class="keywordflow">else</span>:
<a name="l00657"></a>00657                 fullname = name
<a name="l00658"></a>00658             machine, port = args
<a name="l00659"></a>00659             apiSuccess(master.addNode(<span class="stringliteral">&#39;&#39;</span>, subcontext, name, pkg, node, machine, port))
<a name="l00660"></a>00660             <a class="code" href="namespacetest_1_1testMaster.html#aca320cc1080a5e92d25935cd502e4008">verifyNodeAddress</a>(master, <span class="stringliteral">&#39;&#39;</span>, fullname, machine, <span class="stringliteral">&#39;localhost&#39;</span>, port)
<a name="l00661"></a>00661             graphNodes.append(fullname)
<a name="l00662"></a>00662             <a class="code" href="namespacetest_1_1testMaster.html#a89b54e8c6edb3f125f6e2c87d180123c">testGraphState</a>(master, graphNodes, graphFlows)
<a name="l00663"></a>00663             <span class="comment"># duplicate call should succeed</span>
<a name="l00664"></a>00664             apiSuccess(master.addNode(<span class="stringliteral">&#39;&#39;</span>, subcontext, name, pkg, node, machine, port))
<a name="l00665"></a>00665 
<a name="l00666"></a>00666         <span class="comment">#TODO: more stress testing of name resolution with non-root callerIds</span>
<a name="l00667"></a>00667         
<a name="l00668"></a>00668         <span class="comment"># duplicate call with different params should fail</span>
<a name="l00669"></a>00669         port = apiSuccess(master.addNode(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;duplicate.test&#39;</span>, <span class="stringliteral">&#39;nodeA&#39;</span>, pkg, node, TEST_MACHINE, 0))
<a name="l00670"></a>00670         apiError(master.addNode(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;duplicate.test&#39;</span>, <span class="stringliteral">&#39;nodeA&#39;</span>, pkg, node, TEST_MACHINE, port + 1))
<a name="l00671"></a>00671         apiError(master.addNode(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;duplicate.test&#39;</span>, <span class="stringliteral">&#39;nodeA&#39;</span>, pkg+<span class="stringliteral">&#39;foo&#39;</span>, node, TEST_MACHINE, port))
<a name="l00672"></a>00672         apiError(master.addNode(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;duplicate.test&#39;</span>, <span class="stringliteral">&#39;nodeA&#39;</span>, pkg, node+<span class="stringliteral">&#39;foo&#39;</span>, TEST_MACHINE, port))        
<a name="l00673"></a>00673         <span class="comment">#TODO: different machine</span>
<a name="l00674"></a>00674     
<a name="l00675"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#ac2800f6188eb062fba9119d2d915b964">00675</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#ac2800f6188eb062fba9119d2d915b964">testGetGraph</a>(self):
<a name="l00676"></a>00676         <span class="comment">#TODO: in ROS 2.0, graph will be scoped by callerId. For now its safe to assume</span>
<a name="l00677"></a>00677         <span class="comment">#that we are implicitly testing getGraph()</span>
<a name="l00678"></a>00678         <span class="keywordflow">pass</span>
<a name="l00679"></a>00679     
<a name="l00680"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a5503249b533c6a99af13036e33e9c7f7">00680</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a5503249b533c6a99af13036e33e9c7f7">testAddMachine</a>(self):
<a name="l00681"></a>00681         master = self.master
<a name="l00682"></a>00682         host, port = masterAddr
<a name="l00683"></a>00683         <span class="comment">#test invalid calls on addMachine</span>
<a name="l00684"></a>00684         <span class="comment"># - name</span>
<a name="l00685"></a>00685         apiError(master.addMachine(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, self.rosRoot, host, 22, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00686"></a>00686         apiError(master.addMachine(<span class="stringliteral">&#39;node&#39;</span>, 123, self.rosRoot, host, 22, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))        
<a name="l00687"></a>00687         <span class="comment"># - ros root</span>
<a name="l00688"></a>00688         apiError(master.addMachine(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, host, 22, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00689"></a>00689         apiError(master.addMachine(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>, 123, host, 22, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))        
<a name="l00690"></a>00690         <span class="comment"># - address</span>
<a name="l00691"></a>00691         apiError(master.addMachine(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, 22, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00692"></a>00692         apiError(master.addMachine(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, 123, 22, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))        
<a name="l00693"></a>00693         <span class="comment"># - ssh port </span>
<a name="l00694"></a>00694         apiError(master.addMachine(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, host, -22, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00695"></a>00695         apiError(master.addMachine(<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, host, <span class="stringliteral">&quot;22&quot;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00696"></a>00696         
<a name="l00697"></a>00697         tests = [
<a name="l00698"></a>00698             [<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;testAddMachine-1&#39;</span>],
<a name="l00699"></a>00699             [<span class="stringliteral">&#39;g1.node&#39;</span>, <span class="stringliteral">&#39;testAddMachine-2&#39;</span>],
<a name="l00700"></a>00700             [<span class="stringliteral">&#39;g1.g2.g3.node&#39;</span>, <span class="stringliteral">&#39;testAddMachine-3&#39;</span>],
<a name="l00701"></a>00701             [<span class="stringliteral">&#39;g1.g2.node&#39;</span>, <span class="stringliteral">&#39;testAddMachine-4&#39;</span>],            
<a name="l00702"></a>00702             ]
<a name="l00703"></a>00703         rosRoot = self.rosRoot
<a name="l00704"></a>00704         <span class="keywordflow">for</span> callerId, m <span class="keywordflow">in</span> tests:
<a name="l00705"></a>00705             apiSuccess(master.addMachine(callerId, m, rosRoot, host, 22, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00706"></a>00706             <span class="comment"># - duplicate safe</span>
<a name="l00707"></a>00707             apiSuccess(master.addMachine(callerId, m, rosRoot, host, 22, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00708"></a>00708             <span class="comment"># - test error for each parameter being changed</span>
<a name="l00709"></a>00709             apiError(master.addMachine(callerId, m, rosRoot+<span class="stringliteral">&#39;/foo/&#39;</span>, host, 22, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00710"></a>00710             apiError(master.addMachine(callerId, m, rosRoot, <span class="stringliteral">&#39;www.google.com&#39;</span>, 22, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))            
<a name="l00711"></a>00711             apiError(master.addMachine(callerId, m, rosRoot, host, 21, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00712"></a>00712             apiError(master.addMachine(callerId, m, rosRoot, host, 22, <span class="stringliteral">&#39;fake-user&#39;</span>, <span class="stringliteral">&#39;&#39;</span>))
<a name="l00713"></a>00713             apiError(master.addMachine(callerId, m, rosRoot, host, 22, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;fake-password&#39;</span>))
<a name="l00714"></a>00714             
<a name="l00715"></a>00715         <span class="comment">#TODO: rewrite once master has a method for interrogating machines</span>
<a name="l00716"></a>00716 
<a name="l00717"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a9e9f50e909741c3f273462def65e9686">00717</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a9e9f50e909741c3f273462def65e9686">testRegisterNode_Flows</a>(self):
<a name="l00718"></a>00718         <span class="comment">#TODO: test flows param</span>
<a name="l00719"></a>00719         <span class="keywordflow">pass</span>
<a name="l00720"></a>00720 
<a name="l00721"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#af58a9318b0caf19cc5488981e08a2396">00721</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#af58a9318b0caf19cc5488981e08a2396">testRegisterNode</a>(self):
<a name="l00722"></a>00722         master = self.master
<a name="l00723"></a>00723         flows = []
<a name="l00724"></a>00724         <span class="comment"># - invalid name</span>
<a name="l00725"></a>00725         apiError(master.registerNode(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;localhost&#39;</span>, 80, flows))
<a name="l00726"></a>00726         <span class="comment"># - invalid address</span>
<a name="l00727"></a>00727         apiError(master.registerNode(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;registerNodeFail2&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, 80, flows))
<a name="l00728"></a>00728         <span class="comment"># - invalid ports</span>
<a name="l00729"></a>00729         apiError(master.registerNode(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;registerNodeFail3&#39;</span>, <span class="stringliteral">&#39;localhost&#39;</span>, -80, flows))
<a name="l00730"></a>00730         apiError(master.registerNode(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;registerNodeFail4&#39;</span>, <span class="stringliteral">&#39;localhost&#39;</span>, 0, flows))        
<a name="l00731"></a>00731         
<a name="l00732"></a>00732         <span class="comment">#implicitly test registerNode via local exec of test node</span>
<a name="l00733"></a>00733         <span class="comment"># - this actually tests the slave as much as the master, but I don&#39;t want</span>
<a name="l00734"></a>00734         <span class="comment">#   to call registerNode with correct parameters as it is ambiguous whether</span>
<a name="l00735"></a>00735         <span class="comment">#   or not the master should verify that the slave node actually exists</span>
<a name="l00736"></a>00736         testCases = [
<a name="l00737"></a>00737             [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;registerNodeExternal-1&#39;</span>],
<a name="l00738"></a>00738             [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;rne.registerNodeExternal-2&#39;</span>],
<a name="l00739"></a>00739             [<span class="stringliteral">&#39;rne&#39;</span>, <span class="stringliteral">&#39;registerNodeExternal-3&#39;</span>],
<a name="l00740"></a>00740             [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;rne.rne2.rne3.registerNodeExternal-4&#39;</span>],
<a name="l00741"></a>00741             [<span class="stringliteral">&#39;rne&#39;</span>, <span class="stringliteral">&#39;rne2.rne3.registerNodeExternal-5&#39;</span>],
<a name="l00742"></a>00742             [<span class="stringliteral">&#39;rne.rne2.rne3&#39;</span>, <span class="stringliteral">&#39;registerNodeExternal-6&#39;</span>],
<a name="l00743"></a>00743             ]
<a name="l00744"></a>00744         <span class="keywordflow">for</span> context, name <span class="keywordflow">in</span> testCases:
<a name="l00745"></a>00745             <span class="keywordflow">try</span>:
<a name="l00746"></a>00746                 <span class="keywordflow">if</span> context:
<a name="l00747"></a>00747                     fullName = <span class="stringliteral">&quot;%s.%s&quot;</span>%(context, name)
<a name="l00748"></a>00748                     callerId = <span class="stringliteral">&quot;%s.node&quot;</span>%context 
<a name="l00749"></a>00749                 <span class="keywordflow">else</span>:
<a name="l00750"></a>00750                     fullName = name
<a name="l00751"></a>00751                     callerId = <span class="stringliteral">&quot;node&quot;</span>
<a name="l00752"></a>00752                 startTestNode(fullName)
<a name="l00753"></a>00753                 <span class="comment"># Block until node is responsive before continuing</span>
<a name="l00754"></a>00754                 <span class="comment"># - give test node 4 seconds to start</span>
<a name="l00755"></a>00755                 timeoutT = time.time() + 4.0 
<a name="l00756"></a>00756                 node = getTestNode()
<a name="l00757"></a>00757                 val = <span class="keywordtype">None</span>
<a name="l00758"></a>00758                 <span class="keywordflow">while</span> time.time() &lt; timeoutT <span class="keywordflow">and</span> <span class="keywordflow">not</span> val:
<a name="l00759"></a>00759                     <span class="keywordflow">try</span>:
<a name="l00760"></a>00760                         _, _, val = node.getPid(<span class="stringliteral">&#39;&#39;</span>)
<a name="l00761"></a>00761                     <span class="keywordflow">except</span>:
<a name="l00762"></a>00762                         <span class="keywordflow">pass</span>
<a name="l00763"></a>00763                 <span class="keyword">assert</span> val, <span class="stringliteral">&quot;unable to start test node for registerNode test case&quot;</span>
<a name="l00764"></a>00764                 <span class="comment"># - we don&#39;t know the machine in this case</span>
<a name="l00765"></a>00765                 <a class="code" href="namespacetest_1_1testMaster.html#aca320cc1080a5e92d25935cd502e4008">verifyNodeAddress</a>(master, callerId, name, <span class="keywordtype">None</span>, testNodeAddr[0], testNodeAddr[1])
<a name="l00766"></a>00766             <span class="keywordflow">finally</span>:
<a name="l00767"></a>00767                 stopTestNode()
<a name="l00768"></a>00768             
<a name="l00769"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a8fcac43502b7e6c17981163e5086dfa8">00769</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a8fcac43502b7e6c17981163e5086dfa8">testConnectFlow</a>(self):
<a name="l00770"></a>00770         master = self.master
<a name="l00771"></a>00771         pkg, node = testNode
<a name="l00772"></a>00772         graphNodes = [<span class="stringliteral">&#39;master&#39;</span>]
<a name="l00773"></a>00773         graphFlows = []
<a name="l00774"></a>00774         machine = TEST_MACHINE
<a name="l00775"></a>00775         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1, 5):
<a name="l00776"></a>00776             apiSuccess(master.addNode(<span class="stringliteral">&#39;m&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;baseTcfNode-%s&#39;</span>%i, pkg, node, machine, 0))
<a name="l00777"></a>00777             graphNodes.append(<span class="stringliteral">&#39;baseTcfNode-%s&#39;</span>%i) <span class="comment">#for testing up leveling</span>
<a name="l00778"></a>00778             apiSuccess(master.addNode(<span class="stringliteral">&#39;m&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;tcfNode-%s&#39;</span>%i, pkg, node, machine, 0)) 
<a name="l00779"></a>00779             graphNodes.append(<span class="stringliteral">&#39;tcfNode-%s&#39;</span>%i)
<a name="l00780"></a>00780             apiSuccess(master.addNode(<span class="stringliteral">&#39;m&#39;</span>, <span class="stringliteral">&#39;tcf1&#39;</span>, <span class="stringliteral">&#39;tcfNode-%s&#39;</span>%i, pkg, node, machine, 0))
<a name="l00781"></a>00781             graphNodes.append(<span class="stringliteral">&#39;tcf1.tcfNode-%s&#39;</span>%i)
<a name="l00782"></a>00782             apiSuccess(master.addNode(<span class="stringliteral">&#39;m&#39;</span>, <span class="stringliteral">&#39;tcf2&#39;</span>, <span class="stringliteral">&#39;tcfNode-%s&#39;</span>%i, pkg, node, machine, 0))
<a name="l00783"></a>00783             graphNodes.append(<span class="stringliteral">&#39;tcf2.tcfNode-%s&#39;</span>%i)
<a name="l00784"></a>00784             apiSuccess(master.addNode(<span class="stringliteral">&#39;m&#39;</span>, <span class="stringliteral">&#39;tcf1.sub1&#39;</span>, <span class="stringliteral">&#39;tcfNode-%s&#39;</span>%i, pkg, node, machine, 0))
<a name="l00785"></a>00785             graphNodes.append(<span class="stringliteral">&#39;tcf1.sub1.tcfNode-%s&#39;</span>%i)
<a name="l00786"></a>00786             apiSuccess(master.addNode(<span class="stringliteral">&#39;m&#39;</span>, <span class="stringliteral">&#39;tcf2.sub1&#39;</span>, <span class="stringliteral">&#39;tcfNode-%s&#39;</span>%i, pkg, node, machine, 0))
<a name="l00787"></a>00787             graphNodes.append(<span class="stringliteral">&#39;tcf2.sub1.tcfNode-%s&#39;</span>%i)
<a name="l00788"></a>00788             apiSuccess(master.addNode(<span class="stringliteral">&#39;m&#39;</span>, <span class="stringliteral">&#39;tcf3&#39;</span>, <span class="stringliteral">&#39;tcfNode3-%s&#39;</span>%i, pkg, node, machine, 0))
<a name="l00789"></a>00789             graphNodes.append(<span class="stringliteral">&#39;tcf3.tcfNode3-%s&#39;</span>%i)
<a name="l00790"></a>00790             <a class="code" href="namespacetest_1_1testMaster.html#a89b54e8c6edb3f125f6e2c87d180123c">testGraphState</a>(master, graphNodes, graphFlows)
<a name="l00791"></a>00791             
<a name="l00792"></a>00792         reliable = 1
<a name="l00793"></a>00793 
<a name="l00794"></a>00794         <span class="comment"># illegal cases</span>
<a name="l00795"></a>00795         illegal = [
<a name="l00796"></a>00796             <span class="comment"># - name resolution scope</span>
<a name="l00797"></a>00797             [<span class="stringliteral">&#39;node.tcf1&#39;</span>,   <span class="stringliteral">&#39;baseTcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcfNode-1:in&#39;</span>],
<a name="l00798"></a>00798             [<span class="stringliteral">&#39;tcf1.node&#39;</span>,   <span class="stringliteral">&#39;tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;baseTcfNode-1:in&#39;</span>],
<a name="l00799"></a>00799             [<span class="stringliteral">&#39;tcf1.tcfNode-1&#39;</span>, <span class="stringliteral">&#39;tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcf1.tcfNode-1:in&#39;</span>],
<a name="l00800"></a>00800             [<span class="stringliteral">&#39;tcf1.tcfNode-1&#39;</span>, <span class="stringliteral">&#39;:out&#39;</span>, <span class="stringliteral">&#39;tcf1.tcfNode-1:in&#39;</span>],
<a name="l00801"></a>00801             [<span class="stringliteral">&#39;tcf1.tcfNode-1&#39;</span>, <span class="stringliteral">&#39;tcf1.tcfNode-2:out&#39;</span>, <span class="stringliteral">&#39;:in&#39;</span>],                    
<a name="l00802"></a>00802             [<span class="stringliteral">&#39;tcf1.node&#39;</span>,   <span class="stringliteral">&#39;tcf1.tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcfNode-1:in&#39;</span>],
<a name="l00803"></a>00803             [<span class="stringliteral">&#39;tcf1.node&#39;</span>,   <span class="stringliteral">&#39;tcf2.tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcfNode-1:in&#39;</span>],
<a name="l00804"></a>00804             [<span class="stringliteral">&#39;tcf1.node&#39;</span>,   <span class="stringliteral">&#39;tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcf2.tcfNode-1:in&#39;</span>],
<a name="l00805"></a>00805             [<span class="stringliteral">&#39;tcf1.node&#39;</span>,   <span class="stringliteral">&#39;sub1.tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcf2.sub1.tcfNode-1:in&#39;</span>],
<a name="l00806"></a>00806             [<span class="stringliteral">&#39;tcf1.sub1.node&#39;</span>,<span class="stringliteral">&#39;baseTcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcfNode-1:in&#39;</span>],
<a name="l00807"></a>00807             [<span class="stringliteral">&#39;tcf1.sub1.node&#39;</span>,<span class="stringliteral">&#39;sub1.tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcfNode-1:in&#39;</span>],
<a name="l00808"></a>00808             [<span class="stringliteral">&#39;tcf1.sub1.node&#39;</span>,<span class="stringliteral">&#39;tcf2.tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcfNode-1:in&#39;</span>],            
<a name="l00809"></a>00809             ]
<a name="l00810"></a>00810         <span class="keywordflow">for</span> callerId, source, sink <span class="keywordflow">in</span> illegal:
<a name="l00811"></a>00811             apiError(master.connectFlow(callerId, source, sink, reliable))
<a name="l00812"></a>00812 
<a name="l00813"></a>00813         <span class="comment"># single source to sink sink</span>
<a name="l00814"></a>00814         singleCase = [
<a name="l00815"></a>00815             <span class="comment">#straight forward cases</span>
<a name="l00816"></a>00816             [<span class="stringliteral">&#39;node&#39;</span>, <span class="stringliteral">&#39;tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcfNode-2:in&#39;</span>, <span class="stringliteral">&#39;tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcfNode-2:in&#39;</span>,],
<a name="l00817"></a>00817             [<span class="stringliteral">&#39;tcfNode-1&#39;</span>,<span class="stringliteral">&#39;tcf1.tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcf1.tcfNode-2:in&#39;</span>, <span class="stringliteral">&#39;tcf1.tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcf1.tcfNode-2:in&#39;</span>],
<a name="l00818"></a>00818             [<span class="stringliteral">&#39;tcf2.tcfNode-1&#39;</span>, <span class="stringliteral">&#39;tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcfNode-2:in&#39;</span>, <span class="stringliteral">&#39;tcf2.tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcf2.tcfNode-2:in&#39;</span>],
<a name="l00819"></a>00819             [<span class="stringliteral">&#39;tcf1.tcfNode-2&#39;</span>, <span class="stringliteral">&#39;sub1.tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;sub1.tcfNode-2:in&#39;</span>, <span class="stringliteral">&#39;tcf1.sub1.tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcf1.sub1.tcfNode-2:in&#39;</span>],
<a name="l00820"></a>00820             [<span class="stringliteral">&#39;tcf2.tcfNode-1&#39;</span>, <span class="stringliteral">&#39;tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;sub1.tcfNode-1:in&#39;</span>, <span class="stringliteral">&#39;tcf2.tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcf2.sub1.tcfNode-1:in&#39;</span>],
<a name="l00821"></a>00821             
<a name="l00822"></a>00822             <span class="comment"># &#39;.locator&#39; naming test</span>
<a name="l00823"></a>00823             [<span class="stringliteral">&#39;tcf2.sub1.tcfNode-1&#39;</span>, <span class="stringliteral">&#39;.:out&#39;</span>, <span class="stringliteral">&#39;tcfNode-2:in&#39;</span>, <span class="stringliteral">&#39;tcf2.sub1.tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcf2.sub1.tcfNode-2:in&#39;</span>],
<a name="l00824"></a>00824             [<span class="stringliteral">&#39;tcf3.tcfNode3-2&#39;</span>, <span class="stringliteral">&#39;tcfNode3-1:out&#39;</span>, <span class="stringliteral">&#39;.:in&#39;</span>, <span class="stringliteral">&#39;tcf3.tcfNode3-1:out&#39;</span>, <span class="stringliteral">&#39;tcf3.tcfNode3-2:in&#39;</span>], 
<a name="l00825"></a>00825             ]
<a name="l00826"></a>00826         <span class="keywordflow">for</span> callerId, source, sink, sourceFull, sinkFull <span class="keywordflow">in</span> singleCase:        
<a name="l00827"></a>00827             apiSuccess(master.connectFlow(callerId, source, sink, reliable)) 
<a name="l00828"></a>00828             graphFlows.append((sourceFull, sinkFull))
<a name="l00829"></a>00829             <a class="code" href="namespacetest_1_1testMaster.html#a89b54e8c6edb3f125f6e2c87d180123c">testGraphState</a>(master, graphNodes, graphFlows)            
<a name="l00830"></a>00830 
<a name="l00831"></a>00831         <span class="comment"># - already connected</span>
<a name="l00832"></a>00832         <span class="comment"># Spec is fuzzy here. It&#39;s possible that this should be a succeed.</span>
<a name="l00833"></a>00833         apiError(master.connectFlow(<span class="stringliteral">&#39;tcf2.node&#39;</span>,   <span class="stringliteral">&#39;tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcfNode-2:in&#39;</span>, reliable))        
<a name="l00834"></a>00834         apiError(master.connectFlow(<span class="stringliteral">&#39;node&#39;</span>,        <span class="stringliteral">&#39;tcf1.tcfNode-1:out&#39;</span>, <span class="stringliteral">&#39;tcf1.tcfNode-2:in&#39;</span>, reliable))        
<a name="l00835"></a>00835         
<a name="l00836"></a>00836         <span class="comment">#TODO: test single source to multiple sinks</span>
<a name="l00837"></a>00837         <span class="comment">#TODO: test multiple sources to single sink</span>
<a name="l00838"></a>00838 
<a name="l00839"></a>00839 
<a name="l00840"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#aef80b65882b54ff5c508b8d75d416c7a">00840</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#aef80b65882b54ff5c508b8d75d416c7a">testKillFlow</a>(self):
<a name="l00841"></a>00841         master = self.master
<a name="l00842"></a>00842         <span class="keywordflow">if</span> 0:
<a name="l00843"></a>00843             master.killFlow(callerId, source, sink)             
<a name="l00844"></a>00844 
<a name="l00845"></a><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a176a464217349f366d980e16d484620c">00845</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1testMaster_1_1MasterTestCase.html#a176a464217349f366d980e16d484620c">testMisc</a>(self):
<a name="l00846"></a>00846         master = self.master
<a name="l00847"></a>00847         <span class="keyword">assert</span> master <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>, <span class="stringliteral">&quot;master is None&quot;</span>
<a name="l00848"></a>00848         masterUri = apiSuccess(master.getMasterUri(<span class="stringliteral">&#39;&#39;</span>))
<a name="l00849"></a>00849         <span class="keyword">assert</span> masterUri == apiSuccess(master.getMasterUri(<span class="stringliteral">&#39;a.different.id&#39;</span>)), master.getMasterUri(<span class="stringliteral">&#39;a.different.id&#39;</span>)
<a name="l00850"></a>00850         <span class="keyword">assert</span> (getMasterUri() == masterUri) <span class="keywordflow">or</span> \
<a name="l00851"></a>00851                (getMasterUriAlt() == masterUri), masterUri
<a name="l00852"></a>00852         <span class="comment">#getPid</span>
<a name="l00853"></a>00853         pid = apiSuccess(master.getPid(<span class="stringliteral">&#39;&#39;</span>))
<a name="l00854"></a>00854         <span class="keyword">assert</span> pid == apiSuccess(master.getPid(<span class="stringliteral">&#39;a.different.id&#39;</span>)), master.getPid(<span class="stringliteral">&#39;a.different.id&#39;</span>)
<a name="l00855"></a>00855         <span class="comment">#callerId must be string</span>
<a name="l00856"></a>00856         apiError(master.getPid(0))
<a name="l00857"></a>00857         apiError(master.getMasterUri(0))
<a name="l00858"></a>00858         <span class="comment">#shutdown</span>
<a name="l00859"></a>00859         <span class="keywordflow">try</span>:
<a name="l00860"></a>00860             master.shutdown(<span class="stringliteral">&#39;some.id&#39;</span>)
<a name="l00861"></a>00861         <span class="keywordflow">except</span>:
<a name="l00862"></a>00862             <span class="keywordflow">pass</span>
<a name="l00863"></a>00863         time.sleep(0.1)
<a name="l00864"></a>00864         <span class="keywordflow">try</span>:
<a name="l00865"></a>00865             code, status, val = master.getPid(<span class="stringliteral">&#39;&#39;</span>)
<a name="l00866"></a>00866             <span class="keyword">assert</span> code &lt; 1, <span class="stringliteral">&quot;Master is still running after shutdown&quot;</span>
<a name="l00867"></a>00867         <span class="keywordflow">except</span>:
<a name="l00868"></a>00868             <span class="keywordflow">pass</span>
<a name="l00869"></a>00869         
<a name="l00870"></a><a class="code" href="namespacetest_1_1testMaster.html#aaf838210dcd222fb5dc3c11831f37f8f">00870</a> <span class="keyword">def </span><a class="code" href="namespacetest_1_1testMaster.html#aaf838210dcd222fb5dc3c11831f37f8f">testMasterMain</a>(argv, stdout, env):
<a name="l00871"></a>00871     <span class="keywordflow">return</span> msMain(argv, stdout, env, [ParamServerTestCase, MasterTestCase], singletest) 
<a name="l00872"></a>00872         
<a name="l00873"></a>00873 <span class="keywordflow">if</span> __name__ == <span class="stringliteral">&#39;__main__&#39;</span>:
<a name="l00874"></a>00874     <a class="code" href="namespacetest_1_1testMaster.html#aaf838210dcd222fb5dc3c11831f37f8f">testMasterMain</a>(sys.argv, sys.stdout, os.environ)
<a name="l00875"></a>00875 
<a name="l00876"></a>00876         
</pre></div></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/test_rosmaster">test_rosmaster</a><br />
Author(s): Ken Conley</br />
<small>autogenerated on Fri Aug 28 2015 12:33:45</small>
</div>
</body>
</html>
