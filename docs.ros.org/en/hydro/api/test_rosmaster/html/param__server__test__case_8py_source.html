<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>test_rosmaster: param_server_test_case.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">


<link rel="canonical" href="http://docs.ros.org/hydro/api/test_rosmaster/html/param__server__test__case_8py_source.html" />
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">param_server_test_case.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="http://docs.ros.org/en/hydro/api/test_rosmaster/html/param__server__test__case_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacetest_1_1param__server__test__case.html">00001</a> <span class="comment">#!/usr/bin/env python</span>
<a name="l00002"></a>00002 <span class="comment"># Software License Agreement (BSD License)</span>
<a name="l00003"></a>00003 <span class="comment">#</span>
<a name="l00004"></a>00004 <span class="comment"># Copyright (c) 2008, Willow Garage, Inc.</span>
<a name="l00005"></a>00005 <span class="comment"># All rights reserved.</span>
<a name="l00006"></a>00006 <span class="comment">#</span>
<a name="l00007"></a>00007 <span class="comment"># Redistribution and use in source and binary forms, with or without</span>
<a name="l00008"></a>00008 <span class="comment"># modification, are permitted provided that the following conditions</span>
<a name="l00009"></a>00009 <span class="comment"># are met:</span>
<a name="l00010"></a>00010 <span class="comment">#</span>
<a name="l00011"></a>00011 <span class="comment">#  * Redistributions of source code must retain the above copyright</span>
<a name="l00012"></a>00012 <span class="comment">#    notice, this list of conditions and the following disclaimer.</span>
<a name="l00013"></a>00013 <span class="comment">#  * Redistributions in binary form must reproduce the above</span>
<a name="l00014"></a>00014 <span class="comment">#    copyright notice, this list of conditions and the following</span>
<a name="l00015"></a>00015 <span class="comment">#    disclaimer in the documentation and/or other materials provided</span>
<a name="l00016"></a>00016 <span class="comment">#    with the distribution.</span>
<a name="l00017"></a>00017 <span class="comment">#  * Neither the name of Willow Garage, Inc. nor the names of its</span>
<a name="l00018"></a>00018 <span class="comment">#    contributors may be used to endorse or promote products derived</span>
<a name="l00019"></a>00019 <span class="comment">#    from this software without specific prior written permission.</span>
<a name="l00020"></a>00020 <span class="comment">#</span>
<a name="l00021"></a>00021 <span class="comment"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00022"></a>00022 <span class="comment"># &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00023"></a>00023 <span class="comment"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS</span>
<a name="l00024"></a>00024 <span class="comment"># FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE</span>
<a name="l00025"></a>00025 <span class="comment"># COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</span>
<a name="l00026"></a>00026 <span class="comment"># INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</span>
<a name="l00027"></a>00027 <span class="comment"># BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<a name="l00028"></a>00028 <span class="comment"># LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<a name="l00029"></a>00029 <span class="comment"># CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<a name="l00030"></a>00030 <span class="comment"># LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN</span>
<a name="l00031"></a>00031 <span class="comment"># ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<a name="l00032"></a>00032 <span class="comment"># POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00033"></a>00033 <span class="comment">#</span>
<a name="l00034"></a>00034 <span class="comment"># Revision $Id: test_embed_msg.py 1986 2008-08-26 23:57:56Z sfkwc $</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="comment">## Integration test for empty services to test serializers</span>
<a name="l00037"></a>00037 <span class="comment">## and transport</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="keyword">import</span> sys
<a name="l00040"></a>00040 <span class="keyword">import</span> unittest
<a name="l00041"></a>00041 <span class="keyword">import</span> xmlrpclib
<a name="l00042"></a>00042 <span class="keyword">import</span> math
<a name="l00043"></a>00043 <span class="keyword">import</span> datetime
<a name="l00044"></a>00044 <span class="keyword">import</span> random
<a name="l00045"></a>00045 <span class="keyword">import</span> traceback
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="keyword">import</span> rostest
<a name="l00048"></a>00048 <span class="keyword">from</span> roslib.names <span class="keyword">import</span> make_global_ns, ns_join
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="keyword">from</span> rosclient <span class="keyword">import</span> TestRosClient
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="namespacetest_1_1param__server__test__case.html#ad06ae9a0080ccbc490482b8b74f16711">00052</a> HAS_PARAM = <span class="keyword">True</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="comment">## Parameter Server API Test Cases. These tests are individually</span>
<a name="l00055"></a>00055 <span class="comment">## enabled by param server test nodes. Each test assumes a fresh param</span>
<a name="l00056"></a>00056 <span class="comment">## server, so we cannot run within the same roslaunch/rostest session.</span>
<a name="l00057"></a><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html">00057</a> <span class="keyword">class </span><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html" title="Parameter Server API Test Cases.">ParamServerTestCase</a>(TestRosClient):
<a name="l00058"></a>00058     
<a name="l00059"></a><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a43b029ac487e7d5c73ffc6643e83cff0">00059</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a43b029ac487e7d5c73ffc6643e83cff0">_setParam</a>(self, ctx, myState, testVals, master):
<a name="l00060"></a>00060         ctx = make_global_ns(ctx)
<a name="l00061"></a>00061         <span class="keywordflow">for</span> type, vals <span class="keywordflow">in</span> testVals:
<a name="l00062"></a>00062             <span class="keywordflow">try</span>:
<a name="l00063"></a>00063                 callerId = ns_join(ctx, <span class="stringliteral">&quot;node&quot;</span>)
<a name="l00064"></a>00064                 count = 0
<a name="l00065"></a>00065                 <span class="keywordflow">for</span> val <span class="keywordflow">in</span> vals:
<a name="l00066"></a>00066                     key = <span class="stringliteral">&quot;%s-%s&quot;</span>%(type,count)
<a name="l00067"></a>00067                     <span class="comment">#print &quot;master.setParam(%s,%s)&quot;%(callerId, key)</span>
<a name="l00068"></a>00068                     master.setParam(callerId, key, val)
<a name="l00069"></a>00069                     self.assert_(self.apiSuccess(master.hasParam(callerId, key)))
<a name="l00070"></a>00070                     trueKey = ns_join(ctx, key)
<a name="l00071"></a>00071                     myState[trueKey] = val
<a name="l00072"></a>00072                     count += 1
<a name="l00073"></a>00073             <span class="keywordflow">except</span> Exception, e:
<a name="l00074"></a>00074                 <span class="keyword">assert</span> <span class="stringliteral">&quot;getParam failed on type[%s], val[%s]&quot;</span>%(type,val)
<a name="l00075"></a>00075         <span class="comment">#self._checkParamState(myState)</span>
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">00077</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(self, myState):
<a name="l00078"></a>00078         master = self.master
<a name="l00079"></a>00079         callerId = <span class="stringliteral">&#39;master&#39;</span> <span class="comment">#validate from root </span>
<a name="l00080"></a>00080         <span class="keywordflow">for</span> (k, v) <span class="keywordflow">in</span> myState.iteritems():
<a name="l00081"></a>00081             <span class="keyword">assert</span> self.apiSuccess(master.hasParam(callerId, k))
<a name="l00082"></a>00082             <span class="comment">#print &quot;verifying parameter %s&quot;%k</span>
<a name="l00083"></a>00083             <span class="keywordflow">try</span>:
<a name="l00084"></a>00084                 v2 = self.apiSuccess(master.getParam(callerId, k))
<a name="l00085"></a>00085             <span class="keywordflow">except</span>:
<a name="l00086"></a>00086                 <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&quot;Exception raised while calling master.getParam(%s,%s): %s&quot;</span>%(callerId, k, traceback.format_exc()))
<a name="l00087"></a>00087             <span class="keywordflow">if</span> isinstance(v2, xmlrpclib.DateTime):
<a name="l00088"></a>00088                 self.assertEquals(xmlrpclib.DateTime(v), v2, <span class="stringliteral">&quot;[%s]: %s != %s, %s&quot;</span>%(k, v, v2, v2.__class__))
<a name="l00089"></a>00089             <span class="keywordflow">elif</span> type(v2) == float:
<a name="l00090"></a>00090                 self.assertAlmostEqual(v, v2, 3, <span class="stringliteral">&quot;[%s]: %s != %s, %s&quot;</span>%(k, v, v2, v2.__class__))
<a name="l00091"></a>00091             <span class="keywordflow">else</span>:
<a name="l00092"></a>00092                 self.assertEquals(v, v2)
<a name="l00093"></a>00093         paramNames = myState.keys()
<a name="l00094"></a>00094         remoteParamNames = self.apiSuccess(master.getParamNames(callerId))
<a name="l00095"></a>00095         <span class="comment"># filter out the roslaunch params like run id and roslaunch/, which are always set</span>
<a name="l00096"></a>00096         remoteParamNames = [p <span class="keywordflow">for</span> p <span class="keywordflow">in</span> remoteParamNames <span class="keywordflow">if</span> <span class="keywordflow">not</span> p <span class="keywordflow">in</span> [<span class="stringliteral">&#39;/run_id&#39;</span>, <span class="stringliteral">&#39;/rosdistro&#39;</span>, <span class="stringliteral">&#39;/rosversion&#39;</span>]]
<a name="l00097"></a>00097         remoteParamNames = [p <span class="keywordflow">for</span> p <span class="keywordflow">in</span> remoteParamNames <span class="keywordflow">if</span> <span class="keywordflow">not</span> p.startswith(<span class="stringliteral">&#39;/roslaunch/&#39;</span>)]
<a name="l00098"></a>00098 
<a name="l00099"></a>00099         <span class="keyword">assert</span> <span class="keywordflow">not</span> set(paramNames) ^ set(remoteParamNames), <span class="stringliteral">&quot;parameter server keys do not match local: %s&quot;</span>%(set(paramNames)^set(remoteParamNames))
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     <span class="comment"># _testHasParam: test hasParam API</span>
<a name="l00103"></a><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a99fed643954afe046f8a4a81112fc4d7">00103</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a99fed643954afe046f8a4a81112fc4d7">_testHasParam</a>(self):
<a name="l00104"></a>00104         master = self.master
<a name="l00105"></a>00105         caller_id = <span class="stringliteral">&#39;/node&#39;</span>
<a name="l00106"></a>00106         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/new_param&#39;</span>)))
<a name="l00107"></a>00107         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/new_param&#39;</span>, 1))
<a name="l00108"></a>00108         self.assert_(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/new_param&#39;</span>)))
<a name="l00109"></a>00109         <span class="comment"># test with relative-name resolution</span>
<a name="l00110"></a>00110         self.assert_(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;new_param&#39;</span>)))
<a name="l00111"></a>00111 
<a name="l00112"></a>00112         <span class="comment"># test with param in sub-namespace</span>
<a name="l00113"></a>00113         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/sub/sub2/new_param2&#39;</span>)))
<a name="l00114"></a>00114         <span class="comment"># - verify that parameter tree does not exist yet (#587)</span>
<a name="l00115"></a>00115         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/sub/sub2/&#39;</span>)))
<a name="l00116"></a>00116         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/sub/sub2&#39;</span>)))        
<a name="l00117"></a>00117         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/sub/&#39;</span>)))
<a name="l00118"></a>00118         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/sub&#39;</span>)))                        
<a name="l00119"></a>00119         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/sub/sub2/new_param2&#39;</span>, 1))
<a name="l00120"></a>00120         self.assert_(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/sub/sub2/new_param2&#39;</span>)))
<a name="l00121"></a>00121         <span class="comment"># - verify that parameter tree now exists (#587)</span>
<a name="l00122"></a>00122         self.assert_(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/sub/sub2/&#39;</span>)))
<a name="l00123"></a>00123         self.assert_(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/sub/sub2&#39;</span>)))        
<a name="l00124"></a>00124         self.assert_(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/sub/&#39;</span>)))
<a name="l00125"></a>00125         self.assert_(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/sub&#39;</span>)))                
<a name="l00126"></a>00126         <span class="comment"># test with relative-name resolution</span>
<a name="l00127"></a>00127         self.assert_(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;sub/sub2/new_param2&#39;</span>)))
<a name="l00128"></a>00128         self.assert_(self.apiSuccess(master.hasParam(<span class="stringliteral">&#39;/sub/node&#39;</span>, <span class="stringliteral">&#39;sub2/new_param2&#39;</span>)))
<a name="l00129"></a>00129         self.assert_(self.apiSuccess(master.hasParam(<span class="stringliteral">&#39;/sub/sub2/node&#39;</span>, <span class="stringliteral">&#39;new_param2&#39;</span>)))
<a name="l00130"></a>00130         self.assert_(self.apiSuccess(master.hasParam(<span class="stringliteral">&#39;/sub/node&#39;</span>, <span class="stringliteral">&#39;sub2&#39;</span>)))
<a name="l00131"></a>00131         self.assert_(self.apiSuccess(master.hasParam(<span class="stringliteral">&#39;/node&#39;</span>, <span class="stringliteral">&#39;sub&#39;</span>)))           
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     <span class="comment"># testSearchParam: test upwards-looking parameter search</span>
<a name="l00134"></a><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a2cf51720f03f2aa779d803f4bfaea07d">00134</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a2cf51720f03f2aa779d803f4bfaea07d">_testSearchParam</a>(self):
<a name="l00135"></a>00135         master = self.master
<a name="l00136"></a>00136         caller_id = <span class="stringliteral">&#39;/node&#39;</span>
<a name="l00137"></a>00137         <span class="comment"># vals are mostly identical, save some randomness. we want</span>
<a name="l00138"></a>00138         <span class="comment"># identical structure in order to stress lookup rules</span>
<a name="l00139"></a>00139         val1 = { <span class="stringliteral">&#39;level1_p1&#39;</span>: random.randint(0, 10000),
<a name="l00140"></a>00140                  <span class="stringliteral">&#39;level1_p2&#39;</span> : { <span class="stringliteral">&#39;level2_p2&#39;</span>: random.randint(0, 10000) }}
<a name="l00141"></a>00141         val2 = { <span class="stringliteral">&#39;level1_p1&#39;</span>: random.randint(0, 10000),
<a name="l00142"></a>00142                  <span class="stringliteral">&#39;level1_p2&#39;</span> : { <span class="stringliteral">&#39;level2_p2&#39;</span>: random.randint(0, 10000) }}
<a name="l00143"></a>00143         val3 = { <span class="stringliteral">&#39;level1_p1&#39;</span>: random.randint(0, 10000),
<a name="l00144"></a>00144                  <span class="stringliteral">&#39;level1_p2&#39;</span> : { <span class="stringliteral">&#39;level2_p2&#39;</span>: random.randint(0, 10000) }}
<a name="l00145"></a>00145         val4 = { <span class="stringliteral">&#39;level1_p1&#39;</span>: random.randint(0, 10000),
<a name="l00146"></a>00146                  <span class="stringliteral">&#39;level1_p2&#39;</span> : { <span class="stringliteral">&#39;level2_p2&#39;</span>: random.randint(0, 10000) }}
<a name="l00147"></a>00147         full_dict = {}
<a name="l00148"></a>00148 
<a name="l00149"></a>00149         <span class="comment"># set the val parameter at three levels so we can validate search</span>
<a name="l00150"></a>00150         caller_id = <span class="stringliteral">&#39;/root&#39;</span>
<a name="l00151"></a>00151         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/param&#39;</span>)))
<a name="l00152"></a>00152         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/param&#39;</span>, val1))
<a name="l00153"></a>00153         <span class="comment"># - test param </span>
<a name="l00154"></a>00154         self.assertEquals(<span class="stringliteral">&#39;/param&#39;</span>, self.apiSuccess(master.searchParam(caller_id, <span class="stringliteral">&#39;param&#39;</span>)))
<a name="l00155"></a>00155 
<a name="l00156"></a>00156         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/level1/param&#39;</span>)))
<a name="l00157"></a>00157         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/level1/param&#39;</span>, val2))
<a name="l00158"></a>00158         self.assertEquals(val2, self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/level1/param&#39;</span>)))
<a name="l00159"></a>00159         <span class="comment"># - test search param </span>
<a name="l00160"></a>00160         self.assertEquals(<span class="stringliteral">&#39;/param&#39;</span>,
<a name="l00161"></a>00161                           self.apiSuccess(master.searchParam(caller_id, <span class="stringliteral">&#39;param&#39;</span>)))
<a name="l00162"></a>00162         self.assertEquals(<span class="stringliteral">&#39;/level1/param&#39;</span>,
<a name="l00163"></a>00163                           self.apiSuccess(master.searchParam(<span class="stringliteral">&#39;/level1/node&#39;</span>, <span class="stringliteral">&#39;param&#39;</span>)))
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/level1/level2/param&#39;</span>)))
<a name="l00166"></a>00166         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/level1/level2/param&#39;</span>, val3))
<a name="l00167"></a>00167         <span class="comment"># - test search param </span>
<a name="l00168"></a>00168         self.assertEquals(<span class="stringliteral">&#39;/param&#39;</span>,
<a name="l00169"></a>00169                           self.apiSuccess(master.searchParam(caller_id, <span class="stringliteral">&#39;param&#39;</span>)))
<a name="l00170"></a>00170         self.assertEquals(<span class="stringliteral">&#39;/level1/param&#39;</span>,
<a name="l00171"></a>00171                           self.apiSuccess(master.searchParam(<span class="stringliteral">&#39;/level1/node&#39;</span>, <span class="stringliteral">&#39;param&#39;</span>)))
<a name="l00172"></a>00172         self.assertEquals(<span class="stringliteral">&#39;/level1/level2/param&#39;</span>,
<a name="l00173"></a>00173                           self.apiSuccess(master.searchParam(<span class="stringliteral">&#39;/level1/level2/node&#39;</span>, <span class="stringliteral">&#39;param&#39;</span>)))
<a name="l00174"></a>00174         self.assertEquals(<span class="stringliteral">&#39;/level1/level2/param&#39;</span>,
<a name="l00175"></a>00175                           self.apiSuccess(master.searchParam(<span class="stringliteral">&#39;/level1/level2/level3/level4/node&#39;</span>, <span class="stringliteral">&#39;param&#39;</span>)))
<a name="l00176"></a>00176         
<a name="l00177"></a>00177         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/level1/level2/level3/level4/param&#39;</span>)))
<a name="l00178"></a>00178         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/level1/level2/level3/level4/param&#39;</span>, val4))
<a name="l00179"></a>00179         <span class="comment"># - test search param </span>
<a name="l00180"></a>00180         self.assertEquals(<span class="stringliteral">&#39;/param&#39;</span>,
<a name="l00181"></a>00181                           self.apiSuccess(master.searchParam(caller_id, <span class="stringliteral">&#39;param&#39;</span>)))
<a name="l00182"></a>00182         self.assertEquals(<span class="stringliteral">&#39;/level1/param&#39;</span>,
<a name="l00183"></a>00183                           self.apiSuccess(master.searchParam(<span class="stringliteral">&#39;/level1/node&#39;</span>, <span class="stringliteral">&#39;param&#39;</span>)))
<a name="l00184"></a>00184         self.assertEquals(<span class="stringliteral">&#39;/level1/level2/param&#39;</span>,
<a name="l00185"></a>00185                           self.apiSuccess(master.searchParam(<span class="stringliteral">&#39;/level1/level2/node&#39;</span>, <span class="stringliteral">&#39;param&#39;</span>)))
<a name="l00186"></a>00186         self.assertEquals(<span class="stringliteral">&#39;/level1/level2/param&#39;</span>,
<a name="l00187"></a>00187                           self.apiSuccess(master.searchParam(<span class="stringliteral">&#39;/level1/level2/level3/node&#39;</span>, <span class="stringliteral">&#39;param&#39;</span>)))
<a name="l00188"></a>00188         self.assertEquals(<span class="stringliteral">&#39;/level1/level2/level3/level4/param&#39;</span>,
<a name="l00189"></a>00189                           self.apiSuccess(master.searchParam(<span class="stringliteral">&#39;/level1/level2/level3/level4/node&#39;</span>, <span class="stringliteral">&#39;param&#39;</span>)))
<a name="l00190"></a>00190 
<a name="l00191"></a>00191         <span class="comment"># test completely different hierarchy, should go to top</span>
<a name="l00192"></a>00192         self.assertEquals(<span class="stringliteral">&#39;/param&#39;</span>, self.apiSuccess(master.searchParam(<span class="stringliteral">&#39;/not/level1/level2/level3/level4/node&#39;</span>, <span class="stringliteral">&#39;param&#39;</span>)))
<a name="l00193"></a>00193         <span class="comment"># test looking for param/sub_param</span>
<a name="l00194"></a>00194         tests = [(<span class="stringliteral">&#39;/param&#39;</span>, <span class="stringliteral">&#39;/not/level1/level2/level3/level4/node&#39;</span>),
<a name="l00195"></a>00195                  (<span class="stringliteral">&#39;/level1/param&#39;</span>, <span class="stringliteral">&#39;/level1/node&#39;</span>),
<a name="l00196"></a>00196                  (<span class="stringliteral">&#39;/level1/param&#39;</span>, <span class="stringliteral">&#39;/level1/notlevel2/notlevel3/node&#39;</span>),
<a name="l00197"></a>00197                  (<span class="stringliteral">&#39;/level1/level2/param&#39;</span>, <span class="stringliteral">&#39;/level1/level2/node&#39;</span>),
<a name="l00198"></a>00198                  (<span class="stringliteral">&#39;/level1/level2/param&#39;</span>, <span class="stringliteral">&#39;/level1/level2/level3/node&#39;</span>),
<a name="l00199"></a>00199                  (<span class="stringliteral">&#39;/level1/level2/param&#39;</span>, <span class="stringliteral">&#39;/level1/level2/notlevel3/notlevel3/node&#39;</span>),
<a name="l00200"></a>00200                  (<span class="stringliteral">&#39;/level1/level2/level3/level4/param&#39;</span>, <span class="stringliteral">&#39;/level1/level2/level3/level4/node&#39;</span>),
<a name="l00201"></a>00201                  (<span class="stringliteral">&#39;/level1/level2/level3/level4/param&#39;</span>, <span class="stringliteral">&#39;/level1/level2/level3/level4/l5/l6/node&#39;</span>),
<a name="l00202"></a>00202                  ]
<a name="l00203"></a>00203         <span class="keywordflow">for</span> pbase, caller_id <span class="keywordflow">in</span> tests:
<a name="l00204"></a>00204             self.assertEquals(pbase + <span class="stringliteral">&#39;/level1_p1&#39;</span>,
<a name="l00205"></a>00205                               self.apiSuccess(master.searchParam(caller_id, <span class="stringliteral">&#39;param/level1_p1&#39;</span>)))
<a name="l00206"></a>00206             key = pbase+<span class="stringliteral">&#39;/level1_p2/level2_p2&#39;</span>
<a name="l00207"></a>00207             self.assertEquals(key,
<a name="l00208"></a>00208                               self.apiSuccess(master.searchParam(caller_id, <span class="stringliteral">&#39;param/level1_p2/level2_p2&#39;</span>)))
<a name="l00209"></a>00209             <span class="comment"># delete the sub key and repeat, should get the same result as searchParam does partial matches</span>
<a name="l00210"></a>00210             <span class="comment"># - we may have already deleted the parameter in a previous iteration, so make sure</span>
<a name="l00211"></a>00211             <span class="keywordflow">if</span> self.apiSuccess(master.hasParam(caller_id, key)):
<a name="l00212"></a>00212                 self.apiSuccess(master.deleteParam(caller_id, key))
<a name="l00213"></a>00213             self.assertEquals(key,
<a name="l00214"></a>00214                               self.apiSuccess(master.searchParam(caller_id, <span class="stringliteral">&#39;param/level1_p2/level2_p2&#39;</span>)))
<a name="l00215"></a>00215             <span class="comment"># to make sure that it didn&#39;t work spuriously, search for non-existent key</span>
<a name="l00216"></a>00216             self.assertEquals(pbase + <span class="stringliteral">&#39;/non_existent&#39;</span>,
<a name="l00217"></a>00217                               self.apiSuccess(master.searchParam(caller_id, <span class="stringliteral">&#39;param/non_existent&#39;</span>)))
<a name="l00218"></a>00218             self.assertEquals(pbase + <span class="stringliteral">&#39;/level1_p2/non_existent&#39;</span>,
<a name="l00219"></a>00219                               self.apiSuccess(master.searchParam(caller_id, <span class="stringliteral">&#39;param/level1_p2/non_existent&#39;</span>)))
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 
<a name="l00222"></a>00222     <span class="comment">## remove common keys that roslaunch places on param server</span>
<a name="l00223"></a><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a00ecd5304782f717597485e7adb19b47">00223</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a00ecd5304782f717597485e7adb19b47" title="remove common keys that roslaunch places on param server">_filterDict</a>(self, d):
<a name="l00224"></a>00224         <span class="keywordflow">for</span> k <span class="keywordflow">in</span> [<span class="stringliteral">&#39;run_id&#39;</span>, <span class="stringliteral">&#39;roslaunch&#39;</span>, <span class="stringliteral">&#39;rosversion&#39;</span>, <span class="stringliteral">&#39;rosdistro&#39;</span>]:
<a name="l00225"></a>00225             <span class="keywordflow">if</span> k <span class="keywordflow">in</span> d:
<a name="l00226"></a>00226                 del d[k]
<a name="l00227"></a>00227         <span class="keywordflow">return</span> d
<a name="l00228"></a>00228         
<a name="l00229"></a>00229     <span class="comment"># testGetParam: test basic getParam behavior. Value encoding verified separately by testParamValues</span>
<a name="l00230"></a><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a66b1abc9c52c7b5af1c3a499ee401779">00230</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a66b1abc9c52c7b5af1c3a499ee401779">_testGetParam</a>(self):
<a name="l00231"></a>00231         master = self.master
<a name="l00232"></a>00232         caller_id = <span class="stringliteral">&#39;/node&#39;</span>
<a name="l00233"></a>00233         val = random.randint(0, 10000)
<a name="l00234"></a>00234 
<a name="l00235"></a>00235         full_dict = {}
<a name="l00236"></a>00236         
<a name="l00237"></a>00237         <span class="comment"># very similar to has param sequence</span>
<a name="l00238"></a>00238         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/new_param&#39;</span>)))
<a name="l00239"></a>00239         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/new_param&#39;</span>, val))
<a name="l00240"></a>00240         full_dict[<span class="stringliteral">&#39;new_param&#39;</span>] = val
<a name="l00241"></a>00241         self.assertEquals(val, self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/new_param&#39;</span>)))
<a name="l00242"></a>00242         <span class="comment"># test with relative-name resolution</span>
<a name="l00243"></a>00243         self.assertEquals(val, self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;new_param&#39;</span>)))
<a name="l00244"></a>00244         <span class="comment"># test full get</span>
<a name="l00245"></a>00245         ps_full_dict = self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/&#39;</span>))
<a name="l00246"></a>00246         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a00ecd5304782f717597485e7adb19b47" title="remove common keys that roslaunch places on param server">_filterDict</a>(ps_full_dict)
<a name="l00247"></a>00247             
<a name="l00248"></a>00248         self.assertEquals(full_dict, ps_full_dict)
<a name="l00249"></a>00249         
<a name="l00250"></a>00250         <span class="comment"># test with param in sub-namespace</span>
<a name="l00251"></a>00251         val = random.randint(0, 10000)        
<a name="l00252"></a>00252         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/sub/sub2/new_param2&#39;</span>)))
<a name="l00253"></a>00253         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/sub/sub2/new_param2&#39;</span>, val))
<a name="l00254"></a>00254         full_dict[<span class="stringliteral">&#39;sub&#39;</span>] = {<span class="stringliteral">&#39;sub2&#39;</span>: { <span class="stringliteral">&#39;new_param2&#39;</span>: val }}
<a name="l00255"></a>00255         self.assertEquals(val, self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/sub/sub2/new_param2&#39;</span>)))
<a name="l00256"></a>00256         <span class="comment"># test with relative-name resolution</span>
<a name="l00257"></a>00257         self.assertEquals(val, self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;sub/sub2/new_param2&#39;</span>)))
<a name="l00258"></a>00258         self.assertEquals(val, self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/sub/node&#39;</span>, <span class="stringliteral">&#39;sub2/new_param2&#39;</span>)))
<a name="l00259"></a>00259         self.assertEquals(val, self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/sub/sub2/node&#39;</span>, <span class="stringliteral">&#39;new_param2&#39;</span>)))
<a name="l00260"></a>00260         <span class="comment"># test that parameter server allows gets across namespaces (#493)</span>
<a name="l00261"></a>00261         self.assertEquals(val, self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/foo/bar/baz/blah/node&#39;</span>, <span class="stringliteral">&#39;/sub/sub2/new_param2&#39;</span>)))
<a name="l00262"></a>00262         <span class="comment"># test full get</span>
<a name="l00263"></a>00263         ps_full_dict = self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/&#39;</span>))
<a name="l00264"></a>00264         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a00ecd5304782f717597485e7adb19b47" title="remove common keys that roslaunch places on param server">_filterDict</a>(ps_full_dict)
<a name="l00265"></a>00265         self.assertEquals(full_dict, ps_full_dict)
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 
<a name="l00268"></a>00268         <span class="comment"># test that parameter server namespace-get (#587)</span>
<a name="l00269"></a>00269         val1 = random.randint(0, 10000)
<a name="l00270"></a>00270         val2 = random.randint(0, 10000)
<a name="l00271"></a>00271         val3 = random.randint(0, 10000)
<a name="l00272"></a>00272         
<a name="l00273"></a>00273         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/gains/P&#39;</span>)))
<a name="l00274"></a>00274         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/gains/I&#39;</span>)))
<a name="l00275"></a>00275         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/gains/D&#39;</span>)))                        
<a name="l00276"></a>00276         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/gains&#39;</span>)))
<a name="l00277"></a>00277 
<a name="l00278"></a>00278         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/gains/P&#39;</span>, val1))
<a name="l00279"></a>00279         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/gains/I&#39;</span>, val2))
<a name="l00280"></a>00280         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/gains/D&#39;</span>, val3))        
<a name="l00281"></a>00281 
<a name="l00282"></a>00282         pid = {<span class="stringliteral">&#39;P&#39;</span>: val1, <span class="stringliteral">&#39;I&#39;</span>: val2, <span class="stringliteral">&#39;D&#39;</span>: val3}
<a name="l00283"></a>00283         full_dict[<span class="stringliteral">&#39;gains&#39;</span>] = pid
<a name="l00284"></a>00284         self.assertEquals(pid,
<a name="l00285"></a>00285                           self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/gains&#39;</span>)))
<a name="l00286"></a>00286         self.assertEquals(pid,
<a name="l00287"></a>00287                           self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/gains/&#39;</span>)))
<a name="l00288"></a>00288         ps_full_dict = self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/&#39;</span>))
<a name="l00289"></a>00289         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a00ecd5304782f717597485e7adb19b47" title="remove common keys that roslaunch places on param server">_filterDict</a>(ps_full_dict)
<a name="l00290"></a>00290         self.assertEquals(full_dict, ps_full_dict)
<a name="l00291"></a>00291 
<a name="l00292"></a>00292         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/ns/gains/P&#39;</span>)))
<a name="l00293"></a>00293         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/ns/gains/I&#39;</span>)))
<a name="l00294"></a>00294         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/ns/gains/D&#39;</span>)))                        
<a name="l00295"></a>00295         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/ns/gains&#39;</span>)))
<a name="l00296"></a>00296         
<a name="l00297"></a>00297         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/ns/gains/P&#39;</span>, val1))
<a name="l00298"></a>00298         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/ns/gains/I&#39;</span>, val2))
<a name="l00299"></a>00299         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/ns/gains/D&#39;</span>, val3))        
<a name="l00300"></a>00300         full_dict[<span class="stringliteral">&#39;ns&#39;</span>] = {<span class="stringliteral">&#39;gains&#39;</span>: pid}
<a name="l00301"></a>00301         
<a name="l00302"></a>00302         self.assertEquals(pid,
<a name="l00303"></a>00303                           self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/ns/gains&#39;</span>)))
<a name="l00304"></a>00304         self.assertEquals({<span class="stringliteral">&#39;gains&#39;</span>: pid},
<a name="l00305"></a>00305                           self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/ns/&#39;</span>)))
<a name="l00306"></a>00306         self.assertEquals({<span class="stringliteral">&#39;gains&#39;</span>: pid},
<a name="l00307"></a>00307                           self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/ns&#39;</span>)))
<a name="l00308"></a>00308         ps_full_dict = self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/&#39;</span>))
<a name="l00309"></a>00309         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a00ecd5304782f717597485e7adb19b47" title="remove common keys that roslaunch places on param server">_filterDict</a>(ps_full_dict)
<a name="l00310"></a>00310         self.assertEquals(full_dict, ps_full_dict)
<a name="l00311"></a>00311         
<a name="l00312"></a>00312         
<a name="l00313"></a>00313     <span class="comment"># testSetParam: test basic setParam behavior. Value encoding verified separately by testParamValues</span>
<a name="l00314"></a><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a2d40b536e71e7ebf9ef2aed71899def2">00314</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a2d40b536e71e7ebf9ef2aed71899def2">_testSetParam</a>(self):
<a name="l00315"></a>00315         master = self.master
<a name="l00316"></a>00316         caller_id = <span class="stringliteral">&#39;/node&#39;</span>
<a name="l00317"></a>00317         val = random.randint(0, 10000)
<a name="l00318"></a>00318 
<a name="l00319"></a>00319         <span class="comment"># very similar to has param sequence</span>
<a name="l00320"></a>00320         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/new_param&#39;</span>)))
<a name="l00321"></a>00321         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/new_param&#39;</span>, val))
<a name="l00322"></a>00322         self.assertEquals(val, self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/new_param&#39;</span>)))
<a name="l00323"></a>00323         <span class="comment"># test with relative-name resolution</span>
<a name="l00324"></a>00324         self.assertEquals(val, self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;new_param&#39;</span>)))
<a name="l00325"></a>00325 
<a name="l00326"></a>00326         <span class="comment"># test type mutation, including from dictionary to value and back</span>
<a name="l00327"></a>00327         vals = [<span class="stringliteral">&#39;a&#39;</span>, {<span class="stringliteral">&#39;a&#39;</span>: <span class="stringliteral">&#39;b&#39;</span>}, 1, 1., <span class="stringliteral">&#39;foo&#39;</span>, {<span class="stringliteral">&#39;c&#39;</span>: <span class="stringliteral">&#39;d&#39;</span>}, 4]
<a name="l00328"></a>00328         <span class="keywordflow">for</span> v <span class="keywordflow">in</span> vals:
<a name="l00329"></a>00329             self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/multi/multi_param&#39;</span>, v))
<a name="l00330"></a>00330             self.assertEquals(v, self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;multi/multi_param&#39;</span>)))        
<a name="l00331"></a>00331         
<a name="l00332"></a>00332         <span class="comment"># test with param in sub-namespace</span>
<a name="l00333"></a>00333         val = random.randint(0, 10000)        
<a name="l00334"></a>00334         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/sub/sub2/new_param2&#39;</span>)))
<a name="l00335"></a>00335         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/sub/sub2/new_param2&#39;</span>, val))
<a name="l00336"></a>00336         self.assertEquals(val, self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/sub/sub2/new_param2&#39;</span>)))
<a name="l00337"></a>00337         <span class="comment"># test with relative-name resolution</span>
<a name="l00338"></a>00338         self.assertEquals(val, self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;sub/sub2/new_param2&#39;</span>)))
<a name="l00339"></a>00339         self.assertEquals(val, self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/sub/node&#39;</span>, <span class="stringliteral">&#39;sub2/new_param2&#39;</span>)))
<a name="l00340"></a>00340         self.assertEquals(val, self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/sub/sub2/node&#39;</span>, <span class="stringliteral">&#39;new_param2&#39;</span>)))
<a name="l00341"></a>00341 
<a name="l00342"></a>00342         <span class="comment"># test that parameter server namespace-set (#587)</span>
<a name="l00343"></a>00343         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/gains/P&#39;</span>)))
<a name="l00344"></a>00344         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/gains/I&#39;</span>)))
<a name="l00345"></a>00345         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/gains/D&#39;</span>)))                        
<a name="l00346"></a>00346         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/gains&#39;</span>)))
<a name="l00347"></a>00347 
<a name="l00348"></a>00348         pid = {<span class="stringliteral">&#39;P&#39;</span>: random.randint(0, 10000), <span class="stringliteral">&#39;I&#39;</span>: random.randint(0, 10000), <span class="stringliteral">&#39;D&#39;</span>: random.randint(0, 10000)}
<a name="l00349"></a>00349         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/gains&#39;</span>, pid))
<a name="l00350"></a>00350         self.assertEquals(pid,  self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/gains&#39;</span>)))
<a name="l00351"></a>00351         self.assertEquals(pid[<span class="stringliteral">&#39;P&#39;</span>], self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/gains/P&#39;</span>)))
<a name="l00352"></a>00352         self.assertEquals(pid[<span class="stringliteral">&#39;I&#39;</span>], self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/gains/I&#39;</span>)))
<a name="l00353"></a>00353         self.assertEquals(pid[<span class="stringliteral">&#39;D&#39;</span>], self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/gains/D&#39;</span>)))
<a name="l00354"></a>00354 
<a name="l00355"></a>00355         subns = {<span class="stringliteral">&#39;gains1&#39;</span>: pid, <span class="stringliteral">&#39;gains2&#39;</span>: pid}
<a name="l00356"></a>00356         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/ns&#39;</span>, subns))
<a name="l00357"></a>00357         self.assertEquals(pid[<span class="stringliteral">&#39;P&#39;</span>], self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/ns/gains1/P&#39;</span>)))
<a name="l00358"></a>00358         self.assertEquals(pid[<span class="stringliteral">&#39;I&#39;</span>], self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/ns/gains1/I&#39;</span>)))
<a name="l00359"></a>00359         self.assertEquals(pid[<span class="stringliteral">&#39;D&#39;</span>], self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/ns/gains1/D&#39;</span>)))
<a name="l00360"></a>00360         self.assertEquals(pid, self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/ns/gains1&#39;</span>)))
<a name="l00361"></a>00361         self.assertEquals(pid, self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/ns/gains2&#39;</span>)))
<a name="l00362"></a>00362         self.assertEquals(subns, self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/ns/&#39;</span>)))
<a name="l00363"></a>00363 
<a name="l00364"></a>00364         <span class="comment"># test empty dictionary set</span>
<a name="l00365"></a>00365         self.apiSuccess(master.setParam(caller_id, <span class="stringliteral">&#39;/ns&#39;</span>, {}))
<a name="l00366"></a>00366         <span class="comment"># - param should still exist</span>
<a name="l00367"></a>00367         self.assert_(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/ns/&#39;</span>)))
<a name="l00368"></a>00368         <span class="comment"># - value should remain dictionary</span>
<a name="l00369"></a>00369         self.assertEquals({}, self.apiSuccess(master.getParam(caller_id, <span class="stringliteral">&#39;/ns/&#39;</span>)))
<a name="l00370"></a>00370         <span class="comment"># - value2 below /ns/ should be erased</span>
<a name="l00371"></a>00371         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/ns/gains1&#39;</span>)))
<a name="l00372"></a>00372         self.failIf(self.apiSuccess(master.hasParam(caller_id, <span class="stringliteral">&#39;/ns/gains1/P&#39;</span>)))
<a name="l00373"></a>00373         
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="comment"># testParamValues: test storage of all XML-RPC compatible types&quot;&quot;&quot;</span>
<a name="l00376"></a><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a3cbdaef18786dbc7232d32b81473fa79">00376</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a3cbdaef18786dbc7232d32b81473fa79">_testParamValues</a>(self):
<a name="l00377"></a>00377         <span class="keyword">from</span> xmlrpclib <span class="keyword">import</span> Binary
<a name="l00378"></a>00378         testVals = [
<a name="l00379"></a>00379             [<span class="stringliteral">&#39;int&#39;</span>, [0, 1024, 2147483647, -2147483647]],
<a name="l00380"></a>00380             [<span class="stringliteral">&#39;boolean&#39;</span>, [<span class="keyword">True</span>, <span class="keyword">False</span>]],
<a name="l00381"></a>00381             <span class="comment">#no longer testing null char</span>
<a name="l00382"></a>00382             <span class="comment">#[&#39;string&#39;, [&#39;&#39;, &#39;\0&#39;, &#39;x&#39;, &#39;hello&#39;, &#39;&#39;.join([chr(n) for n in xrange(0, 255)])]],</span>
<a name="l00383"></a>00383             [<span class="stringliteral">&#39;unicode-string&#39;</span>, [<span class="stringliteral">u&#39;&#39;</span>, <span class="stringliteral">u&#39;hello&#39;</span>, unicode(<span class="stringliteral">&#39;Andr\302\202&#39;</span>, <span class="stringliteral">&#39;utf-8&#39;</span>), unicode(<span class="stringliteral">&#39;\377\376A\000n\000d\000r\000\202\000&#39;</span>, <span class="stringliteral">&#39;utf-16&#39;</span>)]],
<a name="l00384"></a>00384             [<span class="stringliteral">&#39;string-easy-ascii&#39;</span>, [chr(n) <span class="keywordflow">for</span> n <span class="keywordflow">in</span> xrange(32, 128)]],
<a name="l00385"></a>00385 
<a name="l00386"></a>00386             <span class="comment">#[&#39;string-mean-ascii-low&#39;, [chr(n) for n in xrange(9, 10)]], #separate for easier book-keeping</span>
<a name="l00387"></a>00387             <span class="comment">#[&#39;string-mean-ascii-low&#39;, [chr(n) for n in xrange(1, 31)]], #separate for easier book-keeping</span>
<a name="l00388"></a>00388             <span class="comment">#[&#39;string-mean-signed&#39;, [chr(n) for n in xrange(129, 256)]],</span>
<a name="l00389"></a>00389             [<span class="stringliteral">&#39;string&#39;</span>, [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;x&#39;</span>, <span class="stringliteral">&#39;hello-there&#39;</span>, <span class="stringliteral">&#39;new\nline&#39;</span>, <span class="stringliteral">&#39;tab\t&#39;</span>]],
<a name="l00390"></a>00390             [<span class="stringliteral">&#39;double&#39;</span>, [0.0, math.pi, -math.pi, 3.4028235e+38, -3.4028235e+38]],
<a name="l00391"></a>00391             <span class="comment">#TODO: microseconds?</span>
<a name="l00392"></a>00392             [<span class="stringliteral">&#39;datetime&#39;</span>, [datetime.datetime(2005, 12, 6, 12, 13, 14), datetime.datetime(1492, 12, 6, 12, 13, 14)]],
<a name="l00393"></a>00393             [<span class="stringliteral">&#39;base64&#39;</span>, [Binary(<span class="stringliteral">&#39;&#39;</span>), Binary(<span class="stringliteral">&#39;\0&#39;</span>), Binary(<span class="stringliteral">&#39;&#39;</span>.join([chr(n) <span class="keywordflow">for</span> n <span class="keywordflow">in</span> xrange(0, 255)]))]],
<a name="l00394"></a>00394             [<span class="stringliteral">&#39;array&#39;</span>, [[], [1, 2, 3], [<span class="stringliteral">&#39;a&#39;</span>, <span class="stringliteral">&#39;b&#39;</span>, <span class="stringliteral">&#39;c&#39;</span>], [0.0, 0.1, 0.2, 2.0, 2.1, -4.0],
<a name="l00395"></a>00395                        [1, <span class="stringliteral">&#39;a&#39;</span>, <span class="keyword">True</span>], [[1, 2, 3], [<span class="stringliteral">&#39;a&#39;</span>, <span class="stringliteral">&#39;b&#39;</span>, <span class="stringliteral">&#39;c&#39;</span>], [1.0, 2.1, 3.2]]]
<a name="l00396"></a>00396              ],
<a name="l00397"></a>00397             ]
<a name="l00398"></a>00398         master = self.master
<a name="l00399"></a>00399 
<a name="l00400"></a>00400         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Putting parameters onto the server&quot;</span>
<a name="l00401"></a>00401         <span class="comment"># put our params into the parameter server</span>
<a name="l00402"></a>00402         contexts = [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;scope1&#39;</span>, <span class="stringliteral">&#39;scope/sub1/sub2&#39;</span>]
<a name="l00403"></a>00403         myState = {}
<a name="l00404"></a>00404         failures = []
<a name="l00405"></a>00405         <span class="keywordflow">for</span> ctx <span class="keywordflow">in</span> contexts:
<a name="l00406"></a>00406             self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a43b029ac487e7d5c73ffc6643e83cff0">_setParam</a>(ctx, myState, testVals, master)
<a name="l00407"></a>00407         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(myState)
<a name="l00408"></a>00408         
<a name="l00409"></a>00409         <span class="keywordflow">print</span> <span class="stringliteral">&quot;Deleting all of our parameters&quot;</span>
<a name="l00410"></a>00410         <span class="comment"># delete all of our parameters</span>
<a name="l00411"></a>00411         paramKeys = myState.keys()
<a name="l00412"></a>00412         ctx = <span class="stringliteral">&#39;&#39;</span>
<a name="l00413"></a>00413         count = 0
<a name="l00414"></a>00414         <span class="keywordflow">for</span> key <span class="keywordflow">in</span> paramKeys:
<a name="l00415"></a>00415             count += 1
<a name="l00416"></a>00416             <span class="keywordflow">print</span> <span class="stringliteral">&quot;deleting [%s], [%s]&quot;</span>%(ctx, key)
<a name="l00417"></a>00417             self.apiSuccess(master.deleteParam(ctx, key))
<a name="l00418"></a>00418             del myState[key]
<a name="l00419"></a>00419             <span class="comment"># far too intensive to check every time</span>
<a name="l00420"></a>00420             <span class="keywordflow">if</span> count % 50 == 0:
<a name="l00421"></a>00421                 self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(myState)
<a name="l00422"></a>00422         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(myState)
<a name="l00423"></a>00423 
<a name="l00424"></a><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#ab0e8c4056d237270a0b920c884792522">00424</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#ab0e8c4056d237270a0b920c884792522">_testEncapsulation</a>(self):
<a name="l00425"></a>00425         <span class="stringliteral">&quot;&quot;&quot;testEncapsulation: test encapsulation: setting same parameter at different levels&quot;&quot;&quot;</span>
<a name="l00426"></a>00426         master = self.master
<a name="l00427"></a>00427         myState = {}
<a name="l00428"></a>00428         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(myState)
<a name="l00429"></a>00429 
<a name="l00430"></a>00430         testContexts = [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;en&#39;</span>, <span class="stringliteral">&#39;en/sub1&#39;</span>, <span class="stringliteral">&#39;en/sub2&#39;</span>, <span class="stringliteral">&#39;en/sub1/sub2&#39;</span>]
<a name="l00431"></a>00431         <span class="keywordflow">for</span> c <span class="keywordflow">in</span> testContexts:
<a name="l00432"></a>00432             c = make_global_ns(c)
<a name="l00433"></a>00433             testKey = <span class="stringliteral">&#39;param1&#39;</span>
<a name="l00434"></a>00434             testVal = random.randint(-1000000, 100000)
<a name="l00435"></a>00435             callerId = ns_join(c, <span class="stringliteral">&quot;node&quot;</span>)
<a name="l00436"></a>00436             trueKey = ns_join(c, testKey)
<a name="l00437"></a>00437             master.setParam(callerId, testKey, testVal)
<a name="l00438"></a>00438             myState[trueKey] = testVal
<a name="l00439"></a>00439             <span class="comment"># make sure the master has the parameter under both keys and that they are equal</span>
<a name="l00440"></a>00440             v1 = self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/&#39;</span>, trueKey))
<a name="l00441"></a>00441             v2 = self.apiSuccess(master.getParam(callerId, testKey))
<a name="l00442"></a>00442             <span class="keyword">assert</span> v1 == v2, <span class="stringliteral">&quot;[%s]: %s vs. [%s,%s]: %s&quot;</span>%(trueKey, v1, callerId, testKey, v2)
<a name="l00443"></a>00443             <span class="keyword">assert</span> self.apiSuccess(master.hasParam(callerId, testKey)), testKey
<a name="l00444"></a>00444             <span class="keyword">assert</span> self.apiSuccess(master.hasParam(<span class="stringliteral">&#39;node&#39;</span>, trueKey)), trueKey
<a name="l00445"></a>00445 
<a name="l00446"></a>00446         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(myState)
<a name="l00447"></a>00447 
<a name="l00448"></a><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a6fd94cd70be12bcedafeef74c1a05253">00448</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a6fd94cd70be12bcedafeef74c1a05253">_testPrivateNames</a>(self):
<a name="l00449"></a>00449         master = self.master
<a name="l00450"></a>00450         myState = {}
<a name="l00451"></a>00451         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(myState)
<a name="l00452"></a>00452 
<a name="l00453"></a>00453         testContexts = [<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;sub1&#39;</span>, <span class="stringliteral">&#39;sub1/sub2&#39;</span>, <span class="stringliteral">&#39;sub1/sub2/sub3&#39;</span>]
<a name="l00454"></a>00454         <span class="keywordflow">for</span> c <span class="keywordflow">in</span> testContexts:
<a name="l00455"></a>00455             c = make_global_ns(c)
<a name="l00456"></a>00456             callerId = ns_join(c, <span class="stringliteral">&quot;node&quot;</span>)
<a name="l00457"></a>00457             
<a name="l00458"></a>00458             keyStub = <span class="stringliteral">&quot;param1&quot;</span>
<a name="l00459"></a>00459             testKey = <span class="stringliteral">&quot;~%s&quot;</span>%keyStub
<a name="l00460"></a>00460             testVal = random.randint(-1000000, 100000)            
<a name="l00461"></a>00461             master.setParam(callerId, testKey, testVal)
<a name="l00462"></a>00462             trueKey = ns_join(callerId, keyStub)
<a name="l00463"></a>00463             myState[trueKey] = testVal
<a name="l00464"></a>00464 
<a name="l00465"></a>00465             <span class="keywordflow">print</span> <span class="stringliteral">&quot;checking&quot;</span>, trueKey
<a name="l00466"></a>00466             v1 = self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/&#39;</span>, trueKey))
<a name="l00467"></a>00467             v2 = self.apiSuccess(master.getParam(callerId, testKey))
<a name="l00468"></a>00468             <span class="keyword">assert</span> v1 == v2, <span class="stringliteral">&quot;[%s]: %s vs. [%s,%s]: %s&quot;</span>%(trueKey, v1, callerId, testKey, v2)
<a name="l00469"></a>00469             <span class="keyword">assert</span> self.apiSuccess(master.hasParam(callerId, testKey)), testKey
<a name="l00470"></a>00470             <span class="keyword">assert</span> self.apiSuccess(master.hasParam(<span class="stringliteral">&#39;node&#39;</span>, trueKey)), trueKey
<a name="l00471"></a>00471 
<a name="l00472"></a>00472             <span class="comment">#test setting a local param on a different node</span>
<a name="l00473"></a>00473             testKey = ns_join(<span class="stringliteral">&quot;altnode&quot;</span>,<span class="stringliteral">&quot;param2&quot;</span>)
<a name="l00474"></a>00474             testVal = random.randint(-1000000, 100000)            
<a name="l00475"></a>00475             master.setParam(callerId, testKey, testVal)
<a name="l00476"></a>00476             trueKey = ns_join(c, testKey)
<a name="l00477"></a>00477             altCallerId = ns_join(c, <span class="stringliteral">&quot;altnode&quot;</span>)
<a name="l00478"></a>00478             myState[trueKey] = testVal
<a name="l00479"></a>00479 
<a name="l00480"></a>00480             v1 = self.apiSuccess(master.getParam(altCallerId, <span class="stringliteral">&quot;~param2&quot;</span>))
<a name="l00481"></a>00481             v2 = self.apiSuccess(master.getParam(callerId, testKey))
<a name="l00482"></a>00482             <span class="keyword">assert</span> v1 == v2
<a name="l00483"></a>00483             <span class="keyword">assert</span> self.apiSuccess(master.hasParam(callerId, testKey)), testKey
<a name="l00484"></a>00484             <span class="keyword">assert</span> self.apiSuccess(master.hasParam(altCallerId, <span class="stringliteral">&quot;~param2&quot;</span>))
<a name="l00485"></a>00485 
<a name="l00486"></a>00486         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(myState)
<a name="l00487"></a>00487 
<a name="l00488"></a>00488     <span class="comment">## testScopeUp: test that parameter server can chain up scopes to find/delete parameters</span>
<a name="l00489"></a><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#af1dcd5248a4b667aa44db2894e02a4bc">00489</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#af1dcd5248a4b667aa44db2894e02a4bc" title="testScopeUp: test that parameter server can chain up scopes to find/delete parameters">_testScopeUp</a>(self):
<a name="l00490"></a>00490         master = self.master
<a name="l00491"></a>00491         myState = {}
<a name="l00492"></a>00492         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(myState)
<a name="l00493"></a>00493         
<a name="l00494"></a>00494         testVal = random.randint(-1000000, 100000)
<a name="l00495"></a>00495         master.setParam(<span class="stringliteral">&#39;/&#39;</span>, <span class="stringliteral">&#39;uparam1&#39;</span>, testVal)
<a name="l00496"></a>00496         myState[<span class="stringliteral">&#39;/uparam1&#39;</span>] = testVal 
<a name="l00497"></a>00497         <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/node&#39;</span>, <span class="stringliteral">&#39;uparam1&#39;</span>))
<a name="l00498"></a>00498         <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/uptest/node&#39;</span>, <span class="stringliteral">&#39;uparam1&#39;</span>))
<a name="l00499"></a>00499         <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/uptest/sub1/node&#39;</span>, <span class="stringliteral">&#39;uparam1&#39;</span>))
<a name="l00500"></a>00500         <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/uptest/sub1/sub2/node&#39;</span>, <span class="stringliteral">&#39;uparam1&#39;</span>))
<a name="l00501"></a>00501 
<a name="l00502"></a>00502         testVal = random.randint(-1000000, 100000)
<a name="l00503"></a>00503         master.setParam(<span class="stringliteral">&#39;/uptest2/sub1/node&#39;</span>, <span class="stringliteral">&#39;uparam2&#39;</span>, testVal)
<a name="l00504"></a>00504         myState[<span class="stringliteral">&#39;/uptest2/sub1/uparam2&#39;</span>] = testVal 
<a name="l00505"></a>00505         <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/uptest2/sub1/node&#39;</span>, <span class="stringliteral">&#39;uparam2&#39;</span>))
<a name="l00506"></a>00506         <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/uptest2/sub1/sub2/node&#39;</span>, <span class="stringliteral">&#39;uparam2&#39;</span>))
<a name="l00507"></a>00507         <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/uptest2/sub1/sub2/sub3/node&#39;</span>, <span class="stringliteral">&#39;uparam2&#39;</span>))
<a name="l00508"></a>00508 
<a name="l00509"></a>00509         <span class="comment"># make sure we can ascend then descend</span>
<a name="l00510"></a>00510         <span class="keywordflow">if</span> 0:
<a name="l00511"></a>00511             testVal = random.randint(-1000000, 100000)
<a name="l00512"></a>00512             master.setParam(<span class="stringliteral">&#39;/uptest3/node&#39;</span>, <span class="stringliteral">&#39;alt2/alt3/uparam3&#39;</span>, testVal)
<a name="l00513"></a>00513             myState[<span class="stringliteral">&#39;/uptest3/alt2/alt3/uparam3&#39;</span>] = testVal 
<a name="l00514"></a>00514             <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/uptest3/sub1/node&#39;</span>, <span class="stringliteral">&#39;alt2/alt3/uparam3&#39;</span>))
<a name="l00515"></a>00515             <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/uptest3/sub1/sub2/node&#39;</span>, <span class="stringliteral">&#39;alt2/alt3/uparam3&#39;</span>))
<a name="l00516"></a>00516             <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/uptest3/sub1/sub2/sub3/node&#39;</span>, <span class="stringliteral">&#39;alt2/alt3/uparam3&#39;</span>))
<a name="l00517"></a>00517             self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(myState)
<a name="l00518"></a>00518         
<a name="l00519"></a>00519         <span class="comment">#verify upwards deletion</span>
<a name="l00520"></a>00520         self.apiSuccess(master.deleteParam(<span class="stringliteral">&#39;/uptest/sub1/sub2/node&#39;</span>, <span class="stringliteral">&#39;uparam1&#39;</span>))
<a name="l00521"></a>00521         del myState[<span class="stringliteral">&#39;/uparam1&#39;</span>]
<a name="l00522"></a>00522         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(myState)        
<a name="l00523"></a>00523         self.apiSuccess(master.deleteParam(<span class="stringliteral">&#39;/uptest2/sub1/sub2/sub3/node&#39;</span>, <span class="stringliteral">&#39;uparam2&#39;</span>))
<a name="l00524"></a>00524         del myState[<span class="stringliteral">&#39;/uptest2/sub1/uparam2&#39;</span>]
<a name="l00525"></a>00525         <span class="keywordflow">if</span> 0:
<a name="l00526"></a>00526             self.apiSuccess(master.deleteParam(<span class="stringliteral">&#39;/uptest3/sub1/sub2/sub3/node&#39;</span>, <span class="stringliteral">&#39;alt2/alt3/uparam3&#39;</span>))
<a name="l00527"></a>00527             del myState[<span class="stringliteral">&#39;/uptest3/alt2/alt3/uparam3&#39;</span>]
<a name="l00528"></a>00528         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(myState)        
<a name="l00529"></a>00529         
<a name="l00530"></a>00530     <span class="comment">## testScopeDown: test scoping rules for sub contexts</span>
<a name="l00531"></a><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a58149a812f37b2460b4a9898d4b04873">00531</a>     <span class="keyword">def </span><a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a58149a812f37b2460b4a9898d4b04873" title="testScopeDown: test scoping rules for sub contexts">_testScopeDown</a>(self):
<a name="l00532"></a>00532         master = self.master
<a name="l00533"></a>00533         myState = {}
<a name="l00534"></a>00534         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(myState)
<a name="l00535"></a>00535 
<a name="l00536"></a>00536         <span class="comment"># test that parameter server down not chain down scopes</span>
<a name="l00537"></a>00537         testVal = random.randint(-1000000, 100000)
<a name="l00538"></a>00538         master.setParam(<span class="stringliteral">&#39;/down/one/two/three/node&#39;</span>, <span class="stringliteral">&#39;dparam1&#39;</span>, testVal)
<a name="l00539"></a>00539         myState[<span class="stringliteral">&#39;/down/one/two/three/dparam1&#39;</span>] = testVal
<a name="l00540"></a>00540         <span class="keyword">assert</span> <span class="keywordflow">not</span> self.apiSuccess(master.hasParam(<span class="stringliteral">&#39;/down/one/node&#39;</span>, <span class="stringliteral">&#39;dparam1&#39;</span>)) 
<a name="l00541"></a>00541         <span class="keyword">assert</span> <span class="keywordflow">not</span> self.apiSuccess(master.hasParam(<span class="stringliteral">&#39;/down/one/two/node&#39;</span>, <span class="stringliteral">&#39;dparam1&#39;</span>))
<a name="l00542"></a>00542         self.apiError(master.getParam(<span class="stringliteral">&#39;/down/one/node&#39;</span>, <span class="stringliteral">&#39;dparam1&#39;</span>)) 
<a name="l00543"></a>00543         self.apiError(master.getParam(<span class="stringliteral">&#39;/down/one/two/node&#39;</span>, <span class="stringliteral">&#39;dparam1&#39;</span>))
<a name="l00544"></a>00544 
<a name="l00545"></a>00545         <span class="comment"># test that parameter server allows setting of parameters further down (1)</span>
<a name="l00546"></a>00546         testVal = random.randint(-1000000, 100000)
<a name="l00547"></a>00547         master.setParam(<span class="stringliteral">&#39;/&#39;</span>, <span class="stringliteral">&#39;/down2/dparam2&#39;</span>, testVal)
<a name="l00548"></a>00548         myState[<span class="stringliteral">&#39;/down2/dparam2&#39;</span>] = testVal         
<a name="l00549"></a>00549         <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/down2/node&#39;</span>, <span class="stringliteral">&#39;dparam2&#39;</span>))
<a name="l00550"></a>00550         <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/&#39;</span>, <span class="stringliteral">&#39;down2/dparam2&#39;</span>))
<a name="l00551"></a>00551         <span class="keyword">assert</span> <span class="keywordflow">not</span> self.apiSuccess(master.hasParam(<span class="stringliteral">&#39;/down2/node&#39;</span>, <span class="stringliteral">&#39;down2/dparam2&#39;</span>))
<a name="l00552"></a>00552         self.apiError(master.getParam(<span class="stringliteral">&#39;/down2/node&#39;</span>, <span class="stringliteral">&#39;down2/dparam2&#39;</span>))
<a name="l00553"></a>00553         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(myState)
<a name="l00554"></a>00554         
<a name="l00555"></a>00555         <span class="comment"># test that parameter server allows setting of parameters further down (2)</span>
<a name="l00556"></a>00556         testVal = random.randint(-1000000, 100000)
<a name="l00557"></a>00557         master.setParam(<span class="stringliteral">&#39;/&#39;</span>, <span class="stringliteral">&#39;/down3/sub/dparam3&#39;</span>, testVal)
<a name="l00558"></a>00558         myState[<span class="stringliteral">&#39;/down3/sub/dparam3&#39;</span>] = testVal
<a name="l00559"></a>00559         <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/down3/sub/node&#39;</span>, <span class="stringliteral">&#39;dparam3&#39;</span>))
<a name="l00560"></a>00560         <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/down3/node&#39;</span>, <span class="stringliteral">&#39;sub/dparam3&#39;</span>))
<a name="l00561"></a>00561         <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/&#39;</span>, <span class="stringliteral">&#39;down3/sub/dparam3&#39;</span>))
<a name="l00562"></a>00562         <span class="keyword">assert</span> testVal == self.apiSuccess(master.getParam(<span class="stringliteral">&#39;/down3/sub/sub2/node&#39;</span>, <span class="stringliteral">&#39;dparam3&#39;</span>))
<a name="l00563"></a>00563         <span class="keyword">assert</span> <span class="keywordflow">not</span> self.apiSuccess(master.hasParam(<span class="stringliteral">&#39;/down3/sub/node&#39;</span>, <span class="stringliteral">&#39;sub/dparam3&#39;</span>))
<a name="l00564"></a>00564         <span class="keyword">assert</span> <span class="keywordflow">not</span> self.apiSuccess(master.hasParam(<span class="stringliteral">&#39;/down3/sub/node&#39;</span>, <span class="stringliteral">&#39;down3/sub/dparam3&#39;</span>))
<a name="l00565"></a>00565         self.apiError(master.getParam(<span class="stringliteral">&#39;/down3/sub/node&#39;</span>, <span class="stringliteral">&#39;sub/dparam3&#39;</span>))
<a name="l00566"></a>00566         self.apiError(master.getParam(<span class="stringliteral">&#39;/down3/sub/node&#39;</span>, <span class="stringliteral">&#39;down3/sub/dparam3&#39;</span>))
<a name="l00567"></a>00567         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(myState)
<a name="l00568"></a>00568 
<a name="l00569"></a>00569         <span class="comment"># test downwards deletion</span>
<a name="l00570"></a>00570         master.setParam(<span class="stringliteral">&#39;/&#39;</span>, <span class="stringliteral">&#39;/down4/sub/dparam4A&#39;</span>, testVal)
<a name="l00571"></a>00571         self.apiSuccess(master.deleteParam(<span class="stringliteral">&#39;/down4/sub/node&#39;</span>, <span class="stringliteral">&#39;dparam4A&#39;</span>))
<a name="l00572"></a>00572         <span class="keyword">assert</span> <span class="keywordflow">not</span> self.apiSuccess(master.hasParam(<span class="stringliteral">&#39;/down4/sub&#39;</span>, <span class="stringliteral">&#39;dparam4A&#39;</span>))
<a name="l00573"></a>00573         master.setParam(<span class="stringliteral">&#39;/&#39;</span>, <span class="stringliteral">&#39;/down4/sub/dparam4B&#39;</span>, testVal)        
<a name="l00574"></a>00574         self.apiSuccess(master.deleteParam(<span class="stringliteral">&#39;/down4/node&#39;</span>, <span class="stringliteral">&#39;sub/dparam4B&#39;</span>))
<a name="l00575"></a>00575         <span class="keyword">assert</span> <span class="keywordflow">not</span> self.apiSuccess(master.hasParam(<span class="stringliteral">&#39;/down4/sub&#39;</span>, <span class="stringliteral">&#39;dparam4B&#39;</span>))
<a name="l00576"></a>00576         master.setParam(<span class="stringliteral">&#39;/&#39;</span>, <span class="stringliteral">&#39;/down4/sub/dparam4C&#39;</span>, testVal)
<a name="l00577"></a>00577         self.apiSuccess(master.deleteParam(<span class="stringliteral">&#39;/&#39;</span>, <span class="stringliteral">&#39;down4/sub/dparam4C&#39;</span>))
<a name="l00578"></a>00578         <span class="keyword">assert</span> <span class="keywordflow">not</span> self.apiSuccess(master.hasParam(<span class="stringliteral">&#39;/down4/sub/node&#39;</span>, <span class="stringliteral">&#39;dparam4C&#39;</span>))
<a name="l00579"></a>00579         self.<a class="code" href="classtest_1_1param__server__test__case_1_1ParamServerTestCase.html#a65c674fa61401d5a3ce663c1f9046c88">_checkParamState</a>(myState)
<a name="l00580"></a>00580 
</pre></div></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/test_rosmaster">test_rosmaster</a><br />
Author(s): Ken Conley</br />
<small>autogenerated on Fri Aug 28 2015 12:33:45</small>
</div>
</body>
</html>
