
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Developer’s Guide &#8212; rosdep 0.22.1 documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="rosdep2 Python API" href="rosdep2_api.html" />
    <link rel="prev" title="rosdep sources list" href="sources_list.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="rosdep2_api.html" title="rosdep2 Python API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sources_list.html" title="rosdep sources list"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="contents.html">rosdep 0.22.1 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="contents.html">
              <img class="logo" src="_static/ros.png" alt="Logo"/>
            </a></p>
  <h3><a href="contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Developer’s Guide</a><ul>
<li><a class="reference internal" href="#python-api-reference">Python API reference</a></li>
<li><a class="reference internal" href="#rep-114-rospkg-standalone-library">REP 114: rospkg standalone library</a></li>
<li><a class="reference internal" href="#bug-reports-and-feature-requests">Bug reports and feature requests</a></li>
<li><a class="reference internal" href="#getting-the-code">Getting the code</a></li>
<li><a class="reference internal" href="#supporting-a-new-os-package-manager">Supporting a new OS/package manager</a><ul>
<li><a class="reference internal" href="#declaring-a-new-os">Declaring a new OS</a></li>
<li><a class="reference internal" href="#declaring-a-new-installer">Declaring a new installer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing">Testing</a></li>
<li><a class="reference internal" href="#documentation">Documentation</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="sources_list.html"
                        title="previous chapter">rosdep sources list</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="rosdep2_api.html"
                        title="next chapter">rosdep2 Python API</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="http://docs.ros.org/en/independent/api/rosdep/html/_sources/developers_guide.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="developer-s-guide">
<span id="dev-guide"></span><h1>Developer’s Guide<a class="headerlink" href="#developer-s-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="python-api-reference">
<h2>Python API reference<a class="headerlink" href="#python-api-reference" title="Permalink to this headline">¶</a></h2>
<p>In progress, please see <a class="reference internal" href="rosdep2_api.html#python-api"><span class="std std-ref">Python API</span></a>.</p>
</div>
<div class="section" id="rep-114-rospkg-standalone-library">
<h2>REP 114: rospkg standalone library<a class="headerlink" href="#rep-114-rospkg-standalone-library" title="Permalink to this headline">¶</a></h2>
<p>The rosdep library is being developed using the ROS REP process.  It
is necessary to be familiar with these REPs in order to make sure
that rosdep continues to follow the relevant specifications.</p>
<ul class="simple">
<li><a class="reference external" href="http://ros.org/reps/rep-0111.html">REP 111: Multiple Package Manager Support for Rosdep</a>.</li>
<li><a class="reference external" href="http://ros.org/reps/rep-0112.html">REP 112: Source Package Manager for Rosdep</a>.</li>
<li><a class="reference external" href="http://ros.org/reps/rep-0125.html">REP 125: rosdep 2</a>.</li>
</ul>
</div>
<div class="section" id="bug-reports-and-feature-requests">
<h2>Bug reports and feature requests<a class="headerlink" href="#bug-reports-and-feature-requests" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://code.ros.org/trac/ros/newticket?component=rospkg&amp;type=defect&amp;&amp;rospkg">Submit a bug report</a></li>
<li><a class="reference external" href="https://code.ros.org/trac/ros/newticket?component=rospkg&amp;type=enhancement&amp;rospkg">Submit a feature request</a></li>
</ul>
</div>
<div class="section" id="getting-the-code">
<h2>Getting the code<a class="headerlink" href="#getting-the-code" title="Permalink to this headline">¶</a></h2>
<p>The rosdep codebase is hosted on GitHub.  To get started contributing patches, please create a fork:</p>
<p><a class="reference external" href="https://github.com/ros-infrastructure/rosdep">https://github.com/ros-infrastructure/rosdep</a></p>
</div>
<div class="section" id="supporting-a-new-os-package-manager">
<h2>Supporting a new OS/package manager<a class="headerlink" href="#supporting-a-new-os-package-manager" title="Permalink to this headline">¶</a></h2>
<p>Adding new platforms to rosdep can be separated into two steps: adding
support for a new package manager, and adding support for a new OS.</p>
<p>NOTE: There are numerous examples in <code class="xref py py-mod docutils literal notranslate"><span class="pre">rosdep2.platforms</span></code> that you
can follow.</p>
<div class="section" id="declaring-a-new-os">
<h3>Declaring a new OS<a class="headerlink" href="#declaring-a-new-os" title="Permalink to this headline">¶</a></h3>
<p>Adding support for a new OS is fairly straightforward: you just
have to provide rosdep2 the keys that are associated with your OS and the
keys of the installers that your OS supports.</p>
<p>Implementations must provide a <code class="docutils literal notranslate"><span class="pre">register_platforms(context)</span></code> call
which sets up the keys used for the OS and package managers.  The
registration only sets up associated keys – it does not specify the
implementation.  OS keys should be pulled from <code class="docutils literal notranslate"><span class="pre">rospkg.os_detect</span></code> if
they are available.</p>
<p>This example registers the <code class="docutils literal notranslate"><span class="pre">gentoo</span></code> OS and adds support for the
<code class="docutils literal notranslate"><span class="pre">equery</span></code> and <code class="docutils literal notranslate"><span class="pre">source</span></code> package managers.  It then sets the default
package manager to <code class="docutils literal notranslate"><span class="pre">equery</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rospkg.os_detect</span> <span class="k">import</span> <span class="n">OS_GENTOO</span>
<span class="k">def</span> <span class="nf">register_platforms</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">add_os_installer_key</span><span class="p">(</span><span class="n">OS_GENTOO</span><span class="p">,</span> <span class="n">EQUERY_INSTALLER</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">add_os_installer_key</span><span class="p">(</span><span class="n">OS_GENTOO</span><span class="p">,</span> <span class="n">SOURCE_INSTALLER</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">set_default_os_installer_key</span><span class="p">(</span><span class="n">OS_GENTOO</span><span class="p">,</span> <span class="n">EQUERY_INSTALLER</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="declaring-a-new-installer">
<h3>Declaring a new installer<a class="headerlink" href="#declaring-a-new-installer" title="Permalink to this headline">¶</a></h3>
<p>A new installer is registered with the system using a
<code class="docutils literal notranslate"><span class="pre">register_installers(context)</span></code> call.  This call aqssociates the
installer key with an implementation.</p>
<p>This example declares that <code class="docutils literal notranslate"><span class="pre">pip</span></code> is implemented using the
<code class="docutils literal notranslate"><span class="pre">PipInstaller()</span></code> class.  We also declare the <code class="docutils literal notranslate"><span class="pre">PIP_INSTALLER</span></code>
variable so that other code can use it symbolically.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PIP_INSTALLER</span> <span class="o">=</span> <span class="s1">&#39;pip&#39;</span>
<span class="k">def</span> <span class="nf">register_installers</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">set_installer</span><span class="p">(</span><span class="n">PIP_INSTALLER</span><span class="p">,</span> <span class="n">PipInstaller</span><span class="p">())</span>
</pre></div>
</div>
<p>Most installers are implemented using the the
<code class="xref py py-class docutils literal notranslate"><span class="pre">PackageManagerInstaller</span></code> API.  The following is the implementation
of the <code class="docutils literal notranslate"><span class="pre">PipInstaller</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PipInstaller</span><span class="p">(</span><span class="n">PackageManagerInstaller</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PipInstaller</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">pip_detect</span><span class="p">,</span> <span class="n">supports_depends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_install_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolved</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reinstall</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_pip_installed</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">InstallFailed</span><span class="p">((</span><span class="n">PIP_INSTALLER</span><span class="p">,</span> <span class="s2">&quot;pip is not installed&quot;</span><span class="p">))</span>
        <span class="c1"># convenience function that calls outs to our detect function</span>
        <span class="n">packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_packages_to_install</span><span class="p">(</span><span class="n">resolved</span><span class="p">,</span> <span class="n">reinstall</span><span class="o">=</span><span class="n">reinstall</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">packages</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[[</span><span class="s1">&#39;sudo&#39;</span><span class="p">,</span> <span class="s1">&#39;pip&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;-U&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">]</span>
</pre></div>
</div>
<p>The pattern is fairly simple to implement for other package managers.
You must provide a <code class="docutils literal notranslate"><span class="pre">detect_function(package_names)</span></code>
(e.g. <code class="docutils literal notranslate"><span class="pre">pip_detect()</span></code>) that returns a list of package names that are
already installed.  You must also implement <code class="docutils literal notranslate"><span class="pre">get_install_command()</span></code>
which must return a <em>list</em> of commands to execute in order to install
the relevant packages.</p>
</div>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>If you contribute a support for a new OS/package manager, you <em>must</em>
provide complete unit test coverage.  For example, if your detector
relies on parsing the output of a package manager, you must submit
example output along with tests that parse them correctly.</p>
<p>Test files for os detection should be placed in <code class="docutils literal notranslate"><span class="pre">test/os_name</span></code>.</p>
<p>Setup</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pytest</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">mock</span>
</pre></div>
</div>
<p>rosdep2 uses <a class="reference external" href="http://docs.pytest.org">pytest</a>
for testing, which is a fairly simple and straightfoward test
framework.  You just have to write a function start with the name
<code class="docutils literal notranslate"><span class="pre">test</span></code> and use normal <code class="docutils literal notranslate"><span class="pre">assert</span></code> statements for your tests.</p>
<p>rosdep2 also uses <a class="reference external" href="http://www.voidspace.org.uk/python/mock/">mock</a> to
create mocks for testing on Python versions prior to 3.3.</p>
<p>You can run the tests, including coverage, as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">rosdep2</span><span class="o">/</span><span class="n">test</span>
<span class="n">pytest</span>
</pre></div>
</div>
</div>
<div class="section" id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<p>Sphinx is used to provide API documentation for rospkg.  The documents
are stored in the <code class="docutils literal notranslate"><span class="pre">doc</span></code> subdirectory.</p>
<p>In order to build the docs, you need the ‘ros-theme’, which should be stored
in <cite>~/sphinx/ros-theme</cite>.  You can get a copy of ros-theme from:</p>
<p><a class="reference external" href="https://github.com/ros-infrastructure/catkin-sphinx/tree/master/src/catkin_sphinx/theme">https://github.com/ros-infrastructure/catkin-sphinx/tree/master/src/catkin_sphinx/theme</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="rosdep2_api.html" title="rosdep2 Python API"
             >next</a> |</li>
        <li class="right" >
          <a href="sources_list.html" title="rosdep sources list"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="contents.html">rosdep 0.22.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2011, Willow Garage.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>